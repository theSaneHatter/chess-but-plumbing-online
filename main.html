<head>
  <title>Page Title</title>
  <style>
  canvas {
      padding: 0;
      margin: auto;
      display: block;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
  }


</style>
</head>
<body style="background-color:black;">
<div align = "center" valign="middle">
</div>
<canvas id = "canvas" width = 500 height = 500> </canvas>
  <script>
    var ran = function(max) {
  return(Math.floor(Math.random() * max))
};




var rand = function(max) {
  return(Math.random() * max)
};




var ctx = document.getElementById("canvas").getContext("2d")




//relic
//var grid = []
var devMode = true;
var p1 = {
  items: [{item: "pipe", amount: 3}, {item: "generator", amount: 1}],
  t1pool: {eco: ["drill s", "smelter", "appraiser"], weapon: ["mosquito", "alpha ray", "piercer"]},
  t2pool: {eco: ["drill m"], weapon: ["artillery", "cannon", "devastator"]},
  abilities: [],
  scrap: 40,
  tilemap: {
    pipe: {
      timePlacement: [
        [1, 1, 1, 1, 0, 0, 0, 0], 
        [1, 1, 1, 1, 0, 0, 0, 0], 
        [1, 1, 1, 1, 0, 0, 0, 0], 
        [1, 1, 1, 1, 0, 0, 0, 0], 
        [1, 1, 1, 1, 0, 0, 0, 0], 
        [1, 1, 1, 1, 0, 0, 0, 0], 
        [1, 1, 1, 1, 0, 0, 0, 0], 
        [1, 1, 1, 1, 0, 0, 0, 0]
      ],
      costPlacement: [
        [12, 10, 5, 2, 0, 0, 0, 0], 
        [12, 10, 5, 2, 0, 0, 0, 0], 
        [12, 10, 5, 2, 0, 0, 0, 0], 
        [12, 10, 5, 2, 0, 0, 0, 0], 
        [12, 10, 5, 2, 0, 0, 0, 0], 
        [12, 10, 5, 2, 0, 0, 0, 0], 
        [12, 10, 5, 2, 0, 0, 0, 0], 
        [12, 10, 5, 2, 0, 0, 0, 0]
      ]
    },
    production: {
      timePlacement: [
        [2, 2, 1, 1, 1, 0, 0, 0], 
        [2, 2, 1, 1, 1, 0, 0, 0], 
        [2, 2, 1, 1, 1, 0, 0, 0], 
        [2, 2, 1, 1, 1, 0, 0, 0], 
        [2, 2, 1, 1, 1, 0, 0, 0], 
        [2, 2, 1, 1, 1, 0, 0, 0], 
        [2, 2, 1, 1, 1, 0, 0, 0], 
        [2, 2, 1, 1, 1, 0, 0, 0]
      ],
      costPlacement: [
        [20, 16, 10, 8, 5, 0, 0, 0], 
        [20, 16, 10, 8, 5, 0, 0, 0],
        [20, 16, 10, 8, 5, 0, 0, 0],
        [20, 16, 10, 8, 5, 0, 0, 0],
        [20, 16, 10, 8, 5, 0, 0, 0],
        [20, 16, 10, 8, 5, 0, 0, 0],
        [20, 16, 10, 8, 5, 0, 0, 0],
        [20, 16, 10, 8, 5, 0, 0, 0],
      ]
    }
  },
  shopPool: ["pipe", "chest", "generator", "harvester", "chipper"],
  rotationsLeft: 2
}
if (devMode) {
  p1.shopPool = ["pipe", "chest", "generator", "harvester", "chipper", "drill s", "smelter", "jumper", "appraiser", "mosquito", "alpha ray", "piercer", "drill m", "artillery", "cannon", "devastator", "firing array bp", "passive healer", "alloy healer", "woodcutter", "woodcutter saw", "woodcutter body"];
  p1.scrap = 9999;
}
var p2 = {
  items: [{item: "pipe", amount: 3}, {item: "generator", amount: 1}],
  t1pool: {eco: ["drill s", "smelter", "appraiser"], weapon: ["mosquito", "alpha ray", "piercer"]},
  t2pool: {eco: ["drill m"], weapon: ["artillery", "cannon", "devastator"]},
  abilities: [],
  scrap: 30,
  tilemap: {
    pipe: {
      timePlacement: [
        [0, 0, 0, 0, 1, 1, 1, 1], 
        [0, 0, 0, 0, 1, 1, 1, 1], 
        [0, 0, 0, 0, 1, 1, 1, 1], 
        [0, 0, 0, 0, 1, 1, 1, 1], 
        [0, 0, 0, 0, 1, 1, 1, 1], 
        [0, 0, 0, 0, 1, 1, 1, 1], 
        [0, 0, 0, 0, 1, 1, 1, 1], 
        [0, 0, 0, 0, 1, 1, 1, 1], 
      ],
      costPlacement: [
        [0, 0, 0, 0, 2, 5, 10, 12], 
        [0, 0, 0, 0, 2, 5, 10, 12],
        [0, 0, 0, 0, 2, 5, 10, 12],
        [0, 0, 0, 0, 2, 5, 10, 12],
        [0, 0, 0, 0, 2, 5, 10, 12],
        [0, 0, 0, 0, 2, 5, 10, 12],
        [0, 0, 0, 0, 2, 5, 10, 12],
        [0, 0, 0, 0, 2, 5, 10, 12],
      ]
    },
    production: {
      timePlacement: [
        [0, 0, 0, 1, 1, 1, 2, 2], 
        [0, 0, 0, 1, 1, 1, 2, 2], 
        [0, 0, 0, 1, 1, 1, 2, 2], 
        [0, 0, 0, 1, 1, 1, 2, 2], 
        [0, 0, 0, 1, 1, 1, 2, 2], 
        [0, 0, 0, 1, 1, 1, 2, 2], 
        [0, 0, 0, 1, 1, 1, 2, 2], 
        [0, 0, 0, 1, 1, 1, 2, 2], 
      ],
      costPlacement: [
        [0, 0, 0, 5, 8, 10, 16, 20], 
        [0, 0, 0, 5, 8, 10, 16, 20], 
        [0, 0, 0, 5, 8, 10, 16, 20], 
        [0, 0, 0, 5, 8, 10, 16, 20], 
        [0, 0, 0, 5, 8, 10, 16, 20], 
        [0, 0, 0, 5, 8, 10, 16, 20], 
        [0, 0, 0, 5, 8, 10, 16, 20], 
        [0, 0, 0, 5, 8, 10, 16, 20], 
      ]
    }
  },
  shopPool: ["pipe", "chest", "generator", "harvester", "chipper"],
  rotationsLeft: 2
}








var mx = 0
var my = 0
var md = false




//turn indicates how many cycles of [p1 goes] -> [p2 goes]
var turn = 1
//1 = first player, 2 = second player
var activePlayer = 1;




addEventListener("mousemove", function(e) {
	mx = e.offsetX
	my = e.offsetY
})




addEventListener("mousedown", function() {
	md = true
})




addEventListener("mouseup", function() {
	md = false
})




var tPress = false;
var directions = {
  z: false,
  x: false,
  c: false,
  s: false,
  a: false,
  shift: false
};
var rotActivated = false;
addEventListener("keydown", function(e) {
	if (e.code === "KeyR") {
  	if (mode == "placing") {
    	if (rot == "up") {
      	rot = "right"
      } else if (rot == "left") {
      	rot = "up"
      } else if (rot == "down") {
      	rot = "left"
      } else if (rot == "right") {
      	rot = "down"
      }
    } else if (mode == "scan" && bonusUi == "autooutconfig") {
      rotActivated = true;
      if (rot == "up") {
      	rot = "right"
      } else if (rot == "left") {
      	rot = "up"
      } else if (rot == "down") {
      	rot = "left"
      } else if (rot == "right") {
      	rot = "down"
      }
    } else if (mode == "deleting") {
      rotActivated = true;
    }
  } else if (e.code == "Escape" || e.code == "KeyQ") {
    mode = "none";
  } else if (e.code == "Space") {
    md = true;
  } else if (e.code === "KeyT") {
  	tPress = true;
  } else if (e.code == "KeyZ") {
    directions.z = true;
  } else if (e.code == "KeyX") {
    directions.x = true;
  } else if (e.code == "KeyC") {
    directions.c = true;
  } else if (e.code == "KeyS") {
    directions.s = true;
  } else if (e.code == "KeyA") {
    directions.a = true;
  } else if (e.code == "ShiftLeft") {
    directions.shift = true;
  }
});




addEventListener("keyup", function(e) {
	if (e.code === "KeyT") {
  	tPress = false;
  } else if (e.code == "Space") {
    md = false;
  } else if (e.code == "KeyZ") {
    directions.z = false;
  } else if (e.code == "KeyX") {
    directions.x = false;
  } else if (e.code == "KeyC") {
    directions.c = false;
  } else if (e.code == "KeyS") {
    directions.s = false;
  } else if (e.code == "KeyA") {
    directions.a = false;
  } else if (e.code == "ShiftLeft") {
    directions.shift = false;
  }
});












var mouseInside = function(x, y, w, h) {
	return(mx > x && mx < x + w && my > y && my < y + h)
}




/*
UNIVERSAL GRID GUIDELINES:
 - grid begins at 0, 0, and is in total 25*18 (rectangle 500 * 350),
 with spaces that are each 25 pixels * 25.
 - each platform aligns with this universal grid
 - pieces interact via the universal grid rather than by individual platforms. Pieces are all managed
 in one central array, but have their own indicator of which player owns them. they can otherwise 
 interact with eachother.
 - thats all for now :3:3:3:3:3
*/












var platforms = [];
var platform = function(x, y, w, h, level) {
  this.x = x;
  this.y = y;
  this.w = w;
  this.h = h;
  this.level = level;


  //creating the grid, 0 means empty space.
  this.grid = [];
  for(var i = 0; i < w; i++) {
    this.grid.push([]);
    for(var j = 0; j < h; j++) {
      this.grid[i].push(0)
    }
  }
};




//for repackage gear rotation animation
var globalRRot = 0;
platform.prototype.render = function() {
  ctx.fillStyle = "rgb(90, 30, 0)";
  var boardOffset = 12.5;
  ctx.fillRect((this.x * 25 * sf) - boardOffset * sf, (this.y * 25 * sf) - boardOffset * sf, (this.w * 25 * sf) + (boardOffset * 2) * sf, (this.h * 25) * sf + (boardOffset * 2) * sf);
  for(var ist = 0; ist < this.w; ist ++) {
    for(var jst = 0; jst < this.h; jst ++) {
      if ((this.x + ist + ((this.y + jst) % 2)) % 2 == 1) {
        ctx.fillStyle = "rgb(130, 50, 20)";
      } else {
        ctx.fillStyle = "rgb(240, 200, 140)";
      }
      ctx.fillRect(((this.x + ist) * 25) * sf, ((this.y + jst) * 25) * sf, 25 * sf, 25 * sf);
    }
  }




  for(var ist = 0; ist < this.w; ist ++) {
    for(var jst = 0; jst < this.h; jst ++) {
      if (this.grid[ist][jst]) {
        var p = this.grid[ist][jst];
        if (p.type == "pipe") {
        }
        p.draw(((this.x + ist) * 25), ((this.y + jst) * 25));
        var x = (this.x + ist) * 25;
        var y = (this.y + jst) * 25;
        if (p) {
          if (p.isRepackaging) {
            ctx.fillStyle = "rgba(170, 170, 170, 0.8)";
            ctx.beginPath();
            var a = globalRRot;
            for(var gomb = 0; gomb < 26; gomb ++) {
              var mult = 6 - (Math.round((gomb - 1) / 2) % 2) * 2;
              if (gomb == 1) {
                ctx.moveTo((x + 25 + Math.cos(a) * mult) * sf, (y + Math.sin(a) * mult) * sf);
              } else {
                ctx.lineTo((x + 25 + Math.cos(a) * mult) * sf, (y + Math.sin(a) * mult) * sf);
              }
              if (gomb % 2 == 0) {
                a += Math.PI * (-1 / 6);
              }
            }
            ctx.arc((x + 25) * sf, y * sf, 2 * sf, 0, Math.PI * 2, false);
            ctx.fill();
          }
        }
      }
    }
  }
};




var accessPoint = function(x, y, level) {
  var result = null;
  if (level) {
    for (var i = 0; i < platforms.length; i++) {
      if (platforms[i].x < x && platforms[i].x + platforms[i].w >= x && platforms[i].y < y && platforms[i].y + platforms[i].h >= y && level == platforms[i].level) {
        var ox = x - platforms[i].x;
        var oy = y - platforms[i].y;
        result = platforms[i].grid[ox - 1][oy - 1]
      }
    }
  } else {
    for (var i = 0; i < platforms.length; i++) {
      if (platforms[i].x < x && platforms[i].x + platforms[i].w >= x && platforms[i].y < y && platforms[i].y + platforms[i].h >= y) {
        var ox = x - platforms[i].x;
        var oy = y - platforms[i].y;
        result = platforms[i].grid[ox - 1][oy - 1]
      }
    }
  }
  return(result)
};




var getPlatform = function(x, y) {
  var result = null;
  for (var i = 0; i < platforms.length; i++) {
    if (platforms[i].x <= x && platforms[i].x + platforms[i].w >= x && platforms[i].y <= y && platforms[i].y + platforms[i].h >= y) {
      result = platforms[i]
    }
  }
  return(result)
};




var getCoordsOnPlatform = function(x, y) {
  var result = null;
  for (var i = 0; i < platforms.length; i++) {
    if (platforms[i].x <= x && platforms[i].x + platforms[i].w >= x && platforms[i].y <= y && platforms[i].y + platforms[i].h >= y) {
      var ox = x - platforms[i].x;
      var oy = y - platforms[i].y;
      result = {x: ox, y: oy, platform: platforms[i]}
    }
  }
  return(result)
};




var debugPrint = function(piece) {
  if (piece) {
    if (piece.inventory) {
      return("Type: " + piece.type + ", X: " + piece.x + ", Y: " + piece.y + ", inventory size:" + piece.inventory.length);
    } else {
      return("Type: " + piece.type + ", X: " + piece.x + ", Y: " + piece.y + ", inventory: No inventory")
    }
  } else {
    return("nothing here :3 *cums*");
  }
}




var particles = [];
var particle = function(x, y, size, time, properties) {
  this.x = x;
  this.y = y;
  this.size = size;
  this.t = 0;
  this.time = time;
  this.properties = properties;




  if (this.properties.color) {
    this.color = this.properties.color;
  } else {
    this.color = "rgb(0, 0, 0)";
  }
  if (this.properties.shape) {
    this.shape = this.properties.shape;
  }
  if (this.properties.velocity) {
    this.moves = true;
    this.mx = this.properties.velocity.mx;
    this.my = this.properties.velocity.my;
  } else {
    this.moves = false;
  }
  if (this.properties.text) {
    this.text = this.properties.text;
  }




  this.canDie = false;
};




particle.prototype.lol = function() {
  this.t ++;
  if (this.t >= this.time) {
    this.canDie = true;
  }
  if (this.moves) {
    this.x += this.mx;
    this.y += this.my;
  }
  if (this.shape) {
    if (this.shape == "circle") {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x * sf, this.y * sf, this.size / 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
    } else if (this.shape == "rectangle") {
      ctx.fillStyle = this.color;
      ctx.fillRect((this.x - this.size / 2) * sf, (this.y - this.size / 2) * sf, this.size * sf, this.size * sf);
    } else if (this.shape == "text") {
      ctx.fillStyle = this.color;
      ctx.textAlign = "center";
      ctx.font = (this.size * sf) + "px Courier New";
      ctx.fillText(this.text, this.x * sf, this.y * sf);
    }
  }
};




particle.prototype.die = function() {
  if (this.canDie) {
    particles.splice(particles.indexOf(this), 1);
  }
};




var piece = function(x, y, type, variant, direction, player, level) {
	this.x = x
  this.y = y
  this.type = type
  this.variant = variant
  this.direction = direction
  this.player = player;
  this.level = level;

  this.hasBeenDamaged = false;
  
  this.demolish = function() {
    this.die();
  };




  this.repackage = function() {
    this.isRepackaging = true;
  }




  this.isRepackaging = false;




  //defining special stuff




  if (this.type == "devastator") {
  	this.energy = 0;
    this.inventory = [];
    this.inventorySize = 3;
    this.hasEot = true;
    this.hasAction = true;
    this.drawingAction = false;
    this.health = 4;




    this.action = function() {
      console.log("yes")
      if (this.energy >= 5) {
        this.energy -= 5;
        this.drawingAction = true;
        if (this.direction == "up") {
          for(var dw = 0; dw < 8; dw ++) {
            var t = accessPoint(this.x, this.y - dw - 1, this.level);
            if (t) {
              if (t.health || t.isComposite) {
                t.takeDamage(3);
              }
            }
          }
        } else if (this.direction == "down") {
          for(var dw = 0; dw < 8; dw ++) {
            var t = accessPoint(this.x, this.y + dw + 1, this.level);
            if (t) {
              if (t.health || t.isComposite) {
                t.takeDamage(3);
              }
            }
          }
        } else if (this.direction == "left") {
          for(var dw = 0; dw < 8; dw ++) {
            var t = accessPoint(this.x - dw - 1, this.y, this.level);
            if (t) {
              if (t.health || t.isComposite) {
                t.takeDamage(3);
              }
            }
          }
        } else {
          for(var dw = 0; dw < 8; dw ++) {
            var t = accessPoint(this.x + dw + 1, this.y, this.level);
            if (t) {
              if (t.health || t.isComposite) {
                t.takeDamage(3);
              }
            }
          }
        }
      }
    };




    this.actionDraw = function(time, x, y) {
      if (this.drawingAction) {
        var angle;
        if (this.direction == "up") {
          angle = -Math.PI / 2;
        } else if (this.direction == "down") {
          angle = Math.PI / 2;
        } else if (this.direction == "left") {
          angle = Math.PI;
        } else {
          angle = 0;
        }
        if (time < 45) {
          var altAngle = angle + rand(Math.PI * 0.2) - Math.PI * 0.1;
          particles.push(new particle(x + 12.5 + Math.cos(angle) * 12.5 + Math.cos(altAngle) * 5 + ran(5), y + 12.5 + Math.sin(angle) * 12.5 + Math.sin(altAngle) * 5 + ran(5), 8, 45, {shape: "circle", color: "rgba(120, 220, 230, 0.3)", velocity: {mx: Math.cos(altAngle) * 4, my: Math.sin(altAngle) * 4}}));
        } else if (time < 90) {
          ctx.fillStyle = "rgba(120, 220, 230, 0.5)";
          if (this.direction == "up") {
            ctx.fillRect((x + 3 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (y - 200) * sf, (19 - Math.sin(time * Math.PI / 6) * 5) * sf, 200 * sf);
          } else if (this.direction == "down") {
            ctx.fillRect((x + 3 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (y + 25) * sf, (19 - Math.sin(time * Math.PI / 6) * 5) * sf, 200 * sf);
          } else if (this.direction == "left") {
            ctx.fillRect((x - 200) * sf, (y + 3 + Math.sin(time * Math.PI / 6) * 2.5) * sf, 200 * sf, (19 - Math.sin(time * Math.PI / 6) * 5) * sf);
          } else {
            ctx.fillRect((x + 25) * sf, (y + 3 + Math.sin(time * Math.PI / 6) * 2.5) * sf, 200 * sf, (19 - Math.sin(time * Math.PI / 6) * 5) * sf);
          }




          ctx.fillStyle = "rgba(80, 140, 155, 0.8)";
          if (this.direction == "up") {
            ctx.fillRect((x + 8 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (y - 200) * sf, (9 - Math.sin(time * Math.PI / 6) * 5) * sf, 200 * sf);
          } else if (this.direction == "down") {
            ctx.fillRect((x + 8 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (y + 25) * sf, (9 - Math.sin(time * Math.PI / 6) * 5) * sf, 200 * sf);
          } else if (this.direction == "left") {
            ctx.fillRect((x - 200) * sf, (y + 8 + Math.sin(time * Math.PI / 6) * 2.5) * sf, 200 * sf, (9 - Math.sin(time * Math.PI / 6) * 5) * sf);
          } else {
            ctx.fillRect((x + 25) * sf, (y + 8 + Math.sin(time * Math.PI / 6) * 2.5) * sf, 200 * sf, (9 - Math.sin(time * Math.PI / 6) * 5) * sf);
          }
        } else if (time < 135) {
          var alpha = (135 - time) / 90;




          ctx.fillStyle = "rgba(120, 220, 230, " + alpha + ")";
          if (this.direction == "up") {
            ctx.fillRect((x + 3 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (y - 200) * sf, (19 - Math.sin(time * Math.PI / 6) * 5) * sf, 200 * sf);
          } else if (this.direction == "down") {
            ctx.fillRect((x + 3 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (y + 25) * sf, (19 - Math.sin(time * Math.PI / 6) * 5) * sf, 200 * sf);
          } else if (this.direction == "left") {
            ctx.fillRect((x - 200) * sf, (y + 3 + Math.sin(time * Math.PI / 6) * 2.5) * sf, 200 * sf, (19 - Math.sin(time * Math.PI / 6) * 5) * sf);
          } else {
            ctx.fillRect((x + 25) * sf, (y + 3 + Math.sin(time * Math.PI / 6) * 2.5) * sf, 200 * sf, (19 - Math.sin(time * Math.PI / 6) * 5) * sf);
          }




          ctx.fillStyle = "rgba(80, 140, 155, " + (alpha * 1.6) + ")";
          if (this.direction == "up") {
            ctx.fillRect((x + 8 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (y - 200) * sf, (9 - Math.sin(time * Math.PI / 6) * 5) * sf, 200 * sf);
          } else if (this.direction == "down") {
            ctx.fillRect((x + 8 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (y + 25) * sf, (9 - Math.sin(time * Math.PI / 6) * 5) * sf, 200 * sf);
          } else if (this.direction == "left") {
            ctx.fillRect((x - 200) * sf, (y + 8 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (200, 9 - Math.sin(time * Math.PI / 6) * 5) * sf);
          } else {
            ctx.fillRect((x + 25) * sf, (y + 8 + Math.sin(time * Math.PI / 6) * 2.5) * sf, (200, 9 - Math.sin(time * Math.PI / 6) * 5) * sf);
          }
        }
      }
    }




    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      var nonEnergy = 0;
      for (var dw = 0; dw < this.inventory.length; dw ++) {
        if (this.inventory[dw] != "energy") {
          nonEnergy ++;
        }
      }
      while (this.inventory.length > nonEnergy) {
        for (var dw = 0; dw < this.inventory.length; dw ++) {
          if (this.inventory[dw] == "energy") {
            this.inventory.splice(dw, 1);
            this.energy ++;
          }
        }
      }
    };




    this.eotDraw = function(x, y) {
      particles.push(new particle(x + ran(25), y + ran(25), 5 + rand(2), 4, {shape: "circle", color:"rgb(255, 255, 0)"}));
    }




    this.draw = function(x, y) {
      if (this.direction == "up") {
        ctx.fillStyle = "rgb(70, 40, 160)";
        ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
        ctx.fillStyle = "rgb(0, 0, 0)";
        ctx.beginPath();
        ctx.moveTo((x + 3) * sf, (y + 3) * sf);
        ctx.lineTo((x + 22) * sf, (y + 3) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 3) * sf, (y + 22) * sf);
        ctx.lineTo((x + 8) * sf, (y + 22) * sf);
        ctx.lineTo((x + 8) * sf, (y + 16) * sf);
        ctx.lineTo((x + 3) * sf, (y + 10) * sf);
        ctx.fill();
        ctx.moveTo((x + 22) * sf, (y + 22) * sf);
        ctx.lineTo((x + 17) * sf, (y + 22) * sf);
        ctx.lineTo((x + 17) * sf, (y + 16) * sf);
        ctx.lineTo((x + 22) * sf, (y + 10) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(0, 0, 230)";
        ctx.beginPath();
        ctx.moveTo((x + 6) * sf, (y + 3) * sf);
        ctx.lineTo((x + 18) * sf, (y + 3) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 10) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 22) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
        ctx.stroke();
      } else if (this.direction == "down") {
        ctx.fillStyle = "rgb(70, 40, 160)";
        ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
        ctx.fillStyle = "rgb(0, 0, 0)";
        ctx.beginPath();
        ctx.moveTo((x + 3) * sf, (y + 22) * sf);
        ctx.lineTo((x + 22) * sf, (y + 22) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 3) * sf, (y + 3) * sf);
        ctx.lineTo((x + 8) * sf, (y + 3) * sf);
        ctx.lineTo((x + 8) * sf, (y + 9) * sf);
        ctx.lineTo((x + 3) * sf, (y + 15) * sf);
        ctx.fill();
        ctx.moveTo((x + 22) * sf, (y + 3) * sf);
        ctx.lineTo((x + 17) * sf, (y + 3) * sf);
        ctx.lineTo((x + 17) * sf, (y + 9) * sf);
        ctx.lineTo((x + 22) * sf, (y + 15) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(0, 0, 230)";
        ctx.beginPath();
        ctx.moveTo((x + 6) * sf, (y + 22) * sf);
        ctx.lineTo((x + 18) * sf, (y + 22) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 15) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 3) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
        ctx.stroke();
      } else if (this.direction == "left") {
        ctx.fillStyle = "rgb(70, 40, 160)";
        ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
        ctx.fillStyle = "rgb(0, 0, 0)";
        ctx.beginPath();
        ctx.moveTo((x + 3) * sf, (y + 3) * sf);
        ctx.lineTo((x + 3) * sf, (y + 22) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 22) * sf, (y + 3) * sf);
        ctx.lineTo((x + 22) * sf, (y + 8) * sf);
        ctx.lineTo((x + 16) * sf, (y + 8) * sf);
        ctx.lineTo((x + 10) * sf, (y + 3) * sf);
        ctx.fill();
        ctx.moveTo((x + 22) * sf, (y + 22) * sf);
        ctx.lineTo((x + 22) * sf, (y + 17) * sf);
        ctx.lineTo((x + 16) * sf, (y + 17) * sf);
        ctx.lineTo((x + 10) * sf, (y + 22) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(0, 0, 230)";
        ctx.beginPath();
        ctx.moveTo((x + 3) * sf, (y + 6) * sf);
        ctx.lineTo((x + 3) * sf, (y + 18) * sf);
        ctx.lineTo((x + 10) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo((x + 22) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
        ctx.stroke();
      } else if (this.direction == "right") {
        ctx.fillStyle = "rgb(70, 40, 160)";
        ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
        ctx.fillStyle = "rgb(0, 0, 0)";
        ctx.beginPath();
        ctx.moveTo((x + 22) * sf, (y + 3) * sf);
        ctx.lineTo((x + 22) * sf, (y + 22) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 3) * sf, (y + 3) * sf);
        ctx.lineTo((x + 3) * sf, (y + 8) * sf);
        ctx.lineTo((x + 9) * sf, (y + 8) * sf);
        ctx.lineTo((x + 15) * sf, (y + 3) * sf);
        ctx.fill();
        ctx.moveTo((x + 3) * sf, (y + 22) * sf);
        ctx.lineTo((x + 3) * sf, (y + 17) * sf);
        ctx.lineTo((x + 9) * sf, (y + 17) * sf);
        ctx.lineTo((x + 15) * sf, (y + 22) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(0, 0, 230)";
        ctx.beginPath();
        ctx.moveTo((x + 22) * sf, (y + 6) * sf);
        ctx.lineTo((x + 22) * sf, (y + 18) * sf);
        ctx.lineTo((x + 15) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo((x + 3) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
        ctx.stroke();
      }
    };
  } else if (this.type == "pipe") {
  	//defining
  	this.energy = 0
    this.inventory = []
    this.inventorySize = 1
    this.hasEot = true
    this.hasAction = false
    this.health = 1
    this.config = [0, 0, 0, 0];
    this.priorityInput = 0;
    this.sblocks = [];
    this.eblock = 0;
    this.eotDrawWaitTime = 0; //for the animation thingy :3




    this.hasSpecialRot = true;
    this.specialRot = function() {
      this.flashValues();
    };
    
    //resets position based values for if they are moved or rotated
    this.flashValues = function() {
    	if (this.variant == 1) {
    	if (this.direction == "up") {
  			this.config = [0, 1, 0, 2]
    	} else if (this.direction == "down") {
    		this.config = [0, 2, 0, 1]
    	} else if (this.direction == "left") {
    		this.config = [1, 0, 2, 0]
    	} else if (this.direction == "right") {
    		this.config = [2, 0, 1, 0]
    	}
  	} else if (this.variant == 2) {
    	if (this.direction == "up") {
  			this.config = [0, 1, 2, 0]
    	} else if (this.direction == "down") {
    		this.config = [2, 0, 0, 1]
    	} else if (this.direction == "left") {
    		this.config = [1, 2, 0, 0]
    	} else if (this.direction == "right") {
    		this.config = [0, 0, 1, 2]
    	}
    } else if (this.variant == 3) {
    	if (this.direction == "up") {
  			this.config = [2, 1, 0, 0]
    	} else if (this.direction == "down") {
    		this.config = [0, 0, 2, 1]
    	} else if (this.direction == "left") {
    		this.config = [1, 0, 0, 2]
    	} else if (this.direction == "right") {
    		this.config = [0, 2, 1, 0]
    	}
    } else if (this.variant == 4) {
    	if (this.direction == "up") {
  			this.config = [1, 0, 1, 2]
    	} else if (this.direction == "down") {
    		this.config = [1, 2, 1, 0]
    	} else if (this.direction == "left") {
    		this.config = [0, 1, 2, 1]
    	} else if (this.direction == "right") {
    		this.config = [2, 1, 0, 1]
    	}
    } else if (this.variant == 5) {
    	if (this.direction == "up") {
  			this.config = [0, 1, 1, 2]
    	} else if (this.direction == "down") {
    		this.config = [1, 2, 0, 1]
    	} else if (this.direction == "left") {
    		this.config = [1, 1, 2, 0]
    	} else if (this.direction == "right") {
    		this.config = [2, 0, 1, 1]
    	}
    } else if (this.variant == 6) {
    	if (this.direction == "up") {
  			this.config = [1, 1, 0, 2]
    	} else if (this.direction == "down") {
    		this.config = [0, 2, 1, 1]
    	} else if (this.direction == "left") {
    		this.config = [1, 0, 2, 1]
    	} else if (this.direction == "right") {
    		this.config = [2, 1, 1, 0]
    	}
    } else if (this.variant == 7) {
    	if (this.direction == "up") {
  			this.config = [1, 1, 1, 2]
    	} else if (this.direction == "down") {
    		this.config = [1, 2, 1, 1]
    	} else if (this.direction == "left") {
    		this.config = [1, 1, 2, 1]
    	} else if (this.direction == "right") {
    		this.config = [2, 1, 1, 1]
    	}
    } else if (this.variant == 8) {
    	if (this.direction == "up") {
  			this.config = [0, 1, 0, 0]
    	} else if (this.direction == "down") {
    		this.config = [0, 0, 0, 1]
    	} else if (this.direction == "left") {
    		this.config = [1, 0, 0, 0]
    	} else if (this.direction == "right") {
    		this.config = [0, 0, 1, 0]
    	}
    }
    	for(var exd = 0; exd < 4; exd ++) {
      	if (this.config[exd] == 1) {
        	if (exd == 0) {
          	this.sblocks.push("right")
          } else if (exd == 1) {
          	this.sblocks.push("down")
          } else if (exd == 2) {
          	this.sblocks.push("left")
          } else {
          	this.sblocks.push("up")
          }
        }
      	if (this.config[exd] == 2) {
        	if (exd == 0) {
          	this.eblock = "right"
          } else if (exd == 1) {
          	this.eblock = "down"
          } else if (exd == 2) {
          	this.eblock = "left"
          } else {
          	this.eblock = "up"
          }
        }
      }
    }
    //do that real quick
    this.flashValues();
    //this is called at the end of your turn
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      var prisblock = 0; //priority input
      var eblock = 0; //end block index
      var sblocks = []; //back ups for priority input
      var finalsblock = 0; //final selection for input
      var status = 0;
      for(var jkl = 0; jkl < this.sblocks.length; jkl++) {
        var index = 0;
        if (this.sblocks[jkl] == "right") {
          index = accessPoint(this.x + 1, this.y, this.level);
        } else if (this.sblocks[jkl] == "down") {
          index = accessPoint(this.x, this.y + 1, this.level);
        } else if (this.sblocks[jkl] == "left") {
          index = accessPoint(this.x - 1, this.y, this.level);
        } else if (this.sblocks[jkl] == "up") {
          index = accessPoint(this.x, this.y - 1, this.level);
        }
        if (this.priorityInput == jkl) {
          prisblock = index;
        } else {
          sblocks.push(index);
        }
      }
      if (this.eblock == "right") {
        eblock = accessPoint(this.x + 1, this.y, this.level);
      } else if (this.eblock == "down") {
        eblock = accessPoint(this.x, this.y + 1, this.level);
      } else if (this.eblock == "left") {
        eblock = accessPoint(this.x - 1, this.y, this.level);
      } else if (this.eblock == "up") {
        eblock = accessPoint(this.x, this.y - 1, this.level);
      }




      if (this.inventory.length > 0) {
        if (eblock) {
          if (eblock.inventory) {
            if (eblock.inventory.length < eblock.inventorySize) {
              status = "pipe to end";
              finalsblock = prisblock;
            }
          }
        }
      } else {
        //priority segment
        var complexInput = false;
        status = "cancel";
        if (prisblock) {
          if (prisblock.hasCompositeInventory) {
            if (prisblock.returnInventory().length > 0) {
              console.log("complex input")
              complexInput = true;
              status = "start to pipe";
              finalsblock = prisblock;
            }
          } else if (prisblock.inventory) {
            if (prisblock.inventory.length > 0) {
              status = "start to pipe";
              finalsblock = prisblock;
            }
          }
        }
        if (status == "start to pipe") {
          if (this.inventory.length > 0) {
            status = "cancel";
            finalsblock = 1; //not necessary but might help with debugging
          }
        }
        //eveerything else (ughhhhhh 3:<)
        if (status == "cancel" && sblocks.length) {
          for (var jkl = 0; jkl < sblocks.length; jkl ++) {
            var s = sblocks[jkl];
            
            if (s) {
              if (s.hasCompositeInventory) {
                if (s.returnInventory().length > 0) {
                  complexInput = true;
                  status = "start to pipe";
                  finalsblock = s;
                  break;
                }
              } else if (s.inventory) {
                if (s.inventory.length > 0) {
                  status = "start to pipe";
                  finalsblock = s;
                  break;
                }
              }
            }
            
          }
        }
        //checking eblock stuff :3
        if (status == "start to pipe") {
          if (eblock) {
            if (eblock.inventory) {
              if (eblock.inventory.length < eblock.inventorySize) {
                status = "start to end";
              }
            }
          }
        }
      }
      //actually doing shit now
      /*
      console.log("This: " + debugPrint(this));
      console.log("finalSblock: " + debugPrint(finalsblock));
      console.log("eblock: " + debugPrint(eblock));
      console.log("Status: " + status);
      */
      //Mark: Finish This!!!!!!!!!!!!!!!!!!!!!!!
      
      if (status == "start to pipe") {
        if (complexInput) {
          var item = finalsblock.compositeSiphon();
        } else {
          var item = finalsblock.inventory.pop();
        }
        this.inventory.push(item);
      } else if (status == "start to end") {
        if (complexInput) {
          var item = finalsblock.compositeSiphon();
        } else {
          var item = finalsblock.inventory.pop();
        }
        if (eblock.hasCompositeInventory) {
          if (!eblock.compositeInventoryPush(item)) {
            this.inventory.push(item);
          }
        } else {
          eblock.inventory.push(item);
        }
      } else if (status == "pipe to end") {
        var item = this.inventory.pop()
        if (eblock.hasCompositeInventory) {
          if (!eblock.compositeInventoryPush(item)) {
            this.inventory.push(item);
          }
        } else {
          eblock.inventory.push(item);
        }
      }
    }
    //this is a special function that is used for pipe chains as an alternative to the more expensive other method.
    this.eotDraw = function(x, y) {
      this.eotDrawWaitTime ++;
      var drawArrow = function(ox, oy, angle) {
  	    ctx.fillStyle = "rgba(220, 200, 40, 0.8)"
  	    ctx.beginPath();
        ctx.moveTo((x + 12.5 + ox + (Math.cos(angle) * 8)) * sf, (y + 12.5 + oy + (Math.sin(angle) * 8)) * sf);
   	    ctx.lineTo((x + 12.5 + ox + (Math.cos(angle + Math.PI * 2 / 3) * 8)) * sf, (y + 12.5 + oy + (Math.sin(angle + Math.PI * 2 / 3) * 8)) * sf)
        ctx.lineTo((x + 12.5 + ox + (Math.cos(angle + Math.PI * 2 / 1.5) * 8)) * sf, (y + 12.5 + oy + (Math.sin(angle + Math.PI * 2 / 1.5) * 8)) * sf);
        ctx.fill()
      };
      if (this.config[0] == 1) {
      	drawArrow(25 - Math.sin(this.eotDrawWaitTime / 60) * 15, 0, Math.PI);
      } else if (this.config[0] == 2) {
        drawArrow(25 - Math.sin(this.eotDrawWaitTime / 60) * 15, 0, 0);
      }
      if (this.config[1] == 1) {
      	drawArrow(0, 25 - Math.sin(this.eotDrawWaitTime / 60) * 15, -Math.PI / 2);
      } else if (this.config[1] == 2) {
        drawArrow(0, 25 - Math.sin(this.eotDrawWaitTime / 60) * 15, Math.PI / 2);
      }
      if (this.config[2] == 1) {
      	drawArrow(-25 + Math.sin(this.eotDrawWaitTime / 60) * 15, 0, 0);
      } else if (this.config[2] == 2) {
        drawArrow(-25 + Math.sin(this.eotDrawWaitTime / 60) * 15, 0, Math.PI);
      }
      if (this.config[3] == 1) {
      	drawArrow(0, -25 + Math.sin(this.eotDrawWaitTime / 60) * 15, Math.PI / 2);
      } else if (this.config[3] == 2) {
        drawArrow(0, -25 + Math.sin(this.eotDrawWaitTime / 60) * 15, -Math.PI / 2);
      }
    }
    //render
    this.draw = function(x, y) {
    	ctx.fillStyle = "rgb(0, 0, 0)";
    	ctx.fillRect((x + 7) * sf, (y + 7) * sf, 11 * sf, 11 * sf);
    	if (this.config[0]) {
      	ctx.fillRect((x + 18) * sf, (y + 7) * sf, 7 * sf, 11 * sf);
      }
      if (this.config[1]) {
      	ctx.fillRect((x + 7) * sf, (y + 18) * sf, 11 * sf, 7 * sf);
      }
      if (this.config[2]) {
      	ctx.fillRect(x * sf, (y + 7) * sf, 7 * sf, 11 * sf);
      }
      if (this.config[3]) {
      	ctx.fillRect((x + 7) * sf, y * sf, 11 * sf, 7 * sf);
      }
    }
  } else if (this.type == "chest") {
    this.inventory = []
    this.inventorySize = 4
    this.hasEot = false
    this.hasAction = false
    this.health = 3
    this.draw = function(x, y) {
    	ctx.fillStyle = "rgb(20, 40, 170)"
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf)
      ctx.strokeStyle = "rgb(220, 220, 220)";
      ctx.lineWidth = 2;
      ctx.strokeRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf)
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo((x + 10) * sf, (y + 11) * sf);
      ctx.lineTo((x + 16) * sf, (y + 11) * sf);
      ctx.stroke();
    }
  } else if (this.type == "generator") {
  	this.inventory = [];
    this.inventorySize = 1;




    this.canAutoOut = true;
    this.isAutoOut = false;
    this.autoOutConfig = "right";




    this.hasEot = true;
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
    	if (this.inventory.length < this.inventorySize) {
      	this.inventory.push("energy")
      }
      if (this.isAutoOut && this.inventory.length > 0) {
        var t;
        if (this.autoOutConfig == "up") {
          t = accessPoint(this.x, this.y - 1, this.level);
        } else if (this.autoOutConfig == "left") {
          t = accessPoint(this.x - 1, this.y, this.level);
        } else if (this.autoOutConfig == "down") {
          t = accessPoint(this.x, this.y + 1, this.level);
        } else {
          t = accessPoint(this.x + 1, this.y, this.level);
        }
        if (t) {
          if (t.hasCompositeInventory) {
            var l = this.inventory.pop();
            if (!t.compositeInventoryPush(l)) {
              this.inventory.push(l);
            }
          } else if (t.inventory) {
            if (t.inventory.length < t.inventorySize) {
              var l = this.inventory.pop();
              t.inventory.push(l);
            }
          }
        }
      }
    }
    this.eotDrawWaitTime = 0; //for the animation thingy :3
    this.eotDraw = function(x, y) {
      this.eotDrawWaitTime ++;
      ctx.fillStyle = "rgb(255, 255, 0)";
      ctx.fillRect((x + 6 - Math.sin(this.eotDrawWaitTime / 30) * 3) * sf, (y + 6 - Math.sin(this.eotDrawWaitTime / 30) * 3) * sf, (13 + Math.sin(this.eotDrawWaitTime / 30) * 3) * sf, (13 + Math.sin(this.eotDrawWaitTime / 30) * 3) * sf)
    }
    this.hasAction = false;
    this.health = 2;
    this.draw = function(x, y) {
    	ctx.fillStyle = "rgb(230, 170, 50)"
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf)
      ctx.strokeStyle = "rgb(70, 70, 70)"
      ctx.lineWidth = 2 * sf;
      ctx.strokeRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf)
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 22) * sf, (y + 12.5) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 9.33) * sf, (y + 3) * sf);
      ctx.lineTo((x + 9.33) * sf, (y + 22) * sf);
      ctx.moveTo((x + 15.66) * sf, (y + 3) * sf);
      ctx.lineTo((x + 15.66) * sf, (y + 22) * sf);
      ctx.stroke();
    }
  } else if (this.type == "p1 base info") {
    this.inventory = [];
    this.inventorySize = 2;
    this.isComposite = true;
    this.composite = [];
    this.isPrimaryPart = true;
    this.health = 5;
    this.hasCompositeInventory = true;
    this.hasCompositeHealth = true;
    this.isBase = true;

    this.compositeTakeDamage = function(dmg) {
      this.health -= dmg;
      if (this.health <= 0) {
        this.compositeDeath();
      }
    };
    //Mark: hehe done :3
    this.returnInventory = function() {
      if (this.composite.length > 0) {
        return(this.composite[0].inventory);
      } else {
        return(this.inventory);
      }
    };
    this.compositeSiphon = function() {
      if (this.composite.length > 0) {
        if (this.composite[0].inventory.length > 0) {
          var t = this.composite[0].inventory.pop();
          console.log(t);
          return(t);
        }
      }
      return(false);
    };
    this.compositeDeath = function() {
      if (this.composite.length) {
        var t = getCoordsOnPlatform(this.composite[0].x, this.composite[0].y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    };
    this.compositeInventoryPush = function(input) {
      if (this.composite.length > 0) {
        console.log("m1")
        if (this.composite[0].inventory.length < this.composite[0].inventorySize) {
          console.log("m2")
          this.composite[0].inventory.push(input);
          return(true)
        }
      } else {
        console.log("fcomposite not found")
      }
      return(false)
    };
    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(200, 30, 50)";
      ctx.fillRect(x * sf, (y + 3) * sf, 22 * sf, 19 * sf);
      ctx.fillStyle = "rgb(200, 240, 140)";
      ctx.fillRect((x + 3) * sf, (y + 6) * sf, 16 * sf, 13 * sf);
      ctx.strokeStyle = "rgb(100, 10, 0)";
      ctx.lineWidth = 2 * sf;
      ctx.strokeRect((x + 3) * sf, (y + 6) * sf, 16 * sf, 13 * sf);
      ctx.beginPath();
      ctx.moveTo(x * sf, (y + 2) * sf);
      ctx.lineTo((x + 23) * sf, (y + 2) * sf);
      ctx.lineTo((x + 23) * sf, (y + 23) * sf);
      ctx.lineTo(x * sf, (y + 23) * sf);
      ctx.stroke();
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.beginPath();
      ctx.moveTo((x + 7) * sf, (y + 11) * sf);
      ctx.lineTo((x + 15) * sf, (y + 11) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 7) * sf, (y + 16) * sf);
      ctx.lineTo((x + 15) * sf, (y + 16) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 11) * sf, (y + 10) * sf);
      ctx.lineTo((x + 11) * sf, (y + 16) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 10) * sf, (y + 8.5) * sf);
      ctx.lineTo((x + 12) * sf, (y + 8.5) * sf);
      ctx.stroke();
      if (this.composite.length == 0) {
        var index = accessPoint(this.x - 1, this.y, this.level);
        if (index) {
          if (index.type == "p1 base storage") {
            this.composite.push(index);
          }
        }
      }
    }
  } else if (this.type == "p1 base storage") {
    this.inventory = [];
    this.inventorySize = 5;
    this.isComposite = true;
    this.composite = [];
    this.isPrimaryPart = false;
    this.hasCompositeInventory = true;
    this.hasCompositeHealth = true;
    this.hasSell = true;
    this.isBase = true;

    this.compositeTakeDamage = function(dmg) {
      if (this.composite.length > 0) {
        this.composite[0].health -= dmg;
        if (this.composite[0].health <= 0) {
          this.composite[0].compositeDeath();
        }
      }
    };




    this.compositeDeath = function() {
      if (this.composite.length) {
        var t = getCoordsOnPlatform(this.composite[0].x, this.composite[0].y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    };




    this.compositeInventoryPush = function(input) {
      if (this.inventory.length < this.inventorySize) {
        this.inventory.push(input);
        return(true);
      } else {
        return(false);
      }
    };
    this.returnInventory = function() {
      return(this.inventory);
    };
    this.compositeSiphon = function() {
      if (this.inventory.length > 0) {
        return(this.inventory.pop());
      } else {
        return(false);
      }
    };
    if (this.composite.length == 0) {
      var index = accessPoint(this.x + 1, this.y, this.level);
      if (index) {
        if (index.type == "p1 base info") {
          this.composite.push(index);
        }
      }
    }
    this.draw = function(x, y) {
      if (this.composite.length == 0) {
        var index = accessPoint(this.x + 1, this.y, this.level);
        if (index) {
          if (index.type == "p1 base info") {
            this.composite.push(index);
          }
        }
      }
      ctx.fillStyle = "rgb(200, 30, 50)";
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 22 * sf, 19 * sf);
      ctx.fillStyle = "rgb(50, 180, 225)";
      ctx.fillRect((x + 6) * sf, (y + 6) * sf, 16 * sf, 13 * sf);
      ctx.strokeStyle = "rgb(100, 10, 0)";
      ctx.lineWidth = 2 * sf;
      ctx.strokeRect((x + 6) * sf, (y + 6) * sf, 16 * sf, 13 * sf);
      ctx.beginPath();
      ctx.moveTo((x + 25) * sf, (y + 2) * sf);
      ctx.lineTo((x + 3) * sf, (y + 2) * sf);
      ctx.lineTo((x + 3) * sf, (y + 23) * sf);
      ctx.lineTo((x + 25) * sf, (y + 23) * sf);
      ctx.stroke();
    }
  } else if (this.type == "p2 base info") {
    this.inventory = [];
    this.inventorySize = 2;
    this.isComposite = true;
    this.composite = [];
    this.isPrimaryPart = true;
    this.health = 5;
    this.hasCompositeInventory = true;
    this.hasCompositeHealth = true;
    this.isBase = true;

    this.compositeTakeDamage = function(dmg) {
      this.health -= dmg;
      if (this.health <= 0) {
        this.compositeDeath();
      }
    };
    this.returnInventory = function() {
      console.log("returned inv")
      if (this.composite.length > 0) {
        return(this.composite[0].inventory);
      } else {
        return(this.inventory);
      }
    };
    this.compositeSiphon = function() {
      console.log("siphon")
      if (this.composite.length > 0) {
        if (this.composite[0].inventory.length > 0) {
          var t = this.composite[0].inventory.pop();
          console.log(t);
          return(t);
        }
      }
      return(false);
    };
    this.compositeDeath = function() {
      if (this.composite.length) {
        var t = getCoordsOnPlatform(this.composite[0].x, this.composite[0].y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    };
    this.compositeInventoryPush = function(input) {
      if (this.composite.length > 0) {
        console.log("m1")
        if (this.composite[0].inventory.length < this.composite[0].inventorySize) {
          console.log("m2")
          this.composite[0].inventory.push(input);
          return(true)
        }
      } else {
        console.log("fcomposite not found")
      }
      return(false)
    };
    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(60, 130, 190)";
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 22 * sf, 19 * sf);
      ctx.fillStyle = "rgb(200, 240, 140)";
      ctx.fillRect((x + 6) * sf, (y + 6) * sf, 16 * sf, 13 * sf);
      ctx.strokeStyle = "rgb(30, 65, 95)";
      ctx.lineWidth = 2 * sf;
      ctx.strokeRect((x + 6) * sf, (y + 6) * sf, 16 * sf, 13 * sf);
      ctx.beginPath();
      ctx.moveTo((x + 25) * sf, (y + 2) * sf);
      ctx.lineTo((x + 3) * sf, (y + 2) * sf);
      ctx.lineTo((x + 3) * sf, (y + 23) * sf);
      ctx.lineTo((x + 25) * sf, (y + 23) * sf)
      ctx.stroke();
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.beginPath();
      ctx.moveTo((x + 10) * sf, (y + 11) * sf);
      ctx.lineTo((x + 18) * sf, (y + 11) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 10) * sf, (y + 16) * sf);
      ctx.lineTo((x + 18) * sf, (y + 16) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 14) * sf, (y + 10) * sf);
      ctx.lineTo((x + 14) * sf, (y + 16) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 13) * sf, (y + 8.5) * sf);
      ctx.lineTo((x + 15) * sf, (y + 8.5) * sf);
      ctx.stroke();
      if (this.composite.length == 0) {
        var index = accessPoint(this.x + 1, this.y, this.level);
        if (ran(15) == 0) {
        }
        if (index) {
          if (index.type == "p2 base storage") {
            this.composite.push(index);
          }
        }
      }
    }
  } else if (this.type == "p2 base storage") {
    this.inventory = [];
    this.inventorySize = 5;
    this.isComposite = true;
    this.composite = [];
    this.isPrimaryPart = false;
    this.hasCompositeInventory = true;
    this.hasCompositeHealth = true;
    this.hasSell = true;
    this.isBase = true;

    this.compositeTakeDamage = function(dmg) {
      if (this.composite.length > 0) {
        this.composite[0].health -= dmg;
        if (this.composite[0].health <= 0) {
          this.composite[0].compositeDeath();
        }
      }
    };
    this.compositeInventoryPush = function(input) {
      if (this.inventory.length < this.inventorySize) {
        this.inventory.push(input);
        return(true);
      }
      return(false);
    };
    this.returnInventory = function() {
      return(this.inventory);
    };
    this.compositeSiphon = function() {
      if (this.inventory.length > 0) {
        return(this.inventory.pop());
      }
      return(false);
    };
    this.compositeDeath = function() {
      if (this.composite.length) {
        this.composite[0].compositeDeath();
      } else {
        var t = getCoordsOnPlatform(this.x, this.y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
    };
    if (this.composite.length == 0) {
      var index = accessPoint(this.x - 1, this.y, this.level);
      if (index) {
        if (index.type == "p2 base info") {
          this.composite.push(index);
        }
      }
    }
    this.draw = function(x, y) {
      if (this.composite.length == 0) {
        var index = accessPoint(this.x - 1, this.y, this.level);
        if (index) {
          if (index.type == "p2 base info") {
            this.composite.push(index);
          }
        }
      }
      ctx.fillStyle = "rgb(60, 130, 190)";
      ctx.fillRect(x * sf, (y + 3) * sf, 22 * sf, 19 * sf);
      ctx.fillStyle = "rgb(50, 180, 225)";
      ctx.fillRect((x + 3) * sf, (y + 6) * sf, 16 * sf, 13 * sf);
      ctx.strokeStyle = "rgb(30, 65, 95)";
      ctx.lineWidth = 2 * sf;
      ctx.strokeRect((x + 3) * sf, (y + 6) * sf, 16 * sf, 13 * sf);
      ctx.beginPath();
      ctx.moveTo(x * sf, (y + 2) * sf);
      ctx.lineTo((x + 23) * sf, (y + 2) * sf);
      ctx.lineTo((x + 23) * sf, (y + 23) * sf);
      ctx.lineTo(x * sf, (y + 23) * sf);
      ctx.stroke();
    }
  } else if (this.type == "tree") {
    this.health = 4;
    this.resources = ["organic matter", "organic matter", "organic matter", "organic matter"];




    this.draw = function(x, y) {
      if (this.resources.length == 0) {
        this.die();
      }
      ctx.fillStyle = "rgb(100, 60, 0)";
      ctx.fillRect((x + 9) * sf, (y + 9) * sf, 7 * sf, 14 * sf);
      ctx.fillStyle = "rgb(30, 110, 10)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 8) * sf, 7 * sf, 0, Math.PI * 2, false);
      ctx.fill();
    };
  } else if (this.type == "rock") {
    this.health = 4;
    this.resources = ["stone", "stone", "stone", "stone"];




    this.draw = function(x, y) {
      if (this.resources.length == 0) {
        this.die();
      }
      ctx.fillStyle = "rgb(160, 160, 160)";
      ctx.fillRect((x + 8) * sf, (y + 13) * sf, 10 * sf, 5 * sf);
      ctx.beginPath();
      ctx.arc((x + 13) * sf, (y + 13) * sf, 5 * sf, 0, Math.PI, true);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 8) * sf, (y + 18) * sf);
      ctx.arc((x + 8) * sf, (y + 18) * sf, 5 * sf, -Math.PI / 2, -Math.PI, true);
      ctx.fill();
    };
  } else if (this.type == "gold") {
    this.health = 5;
    this.resources = ["gold", "gold", "gold"];




    this.draw = function(x, y) {
      if (this.resources.length == 0) {
        this.die();
      }
      ctx.fillStyle = "rgb(200, 160, 30)";
      ctx.beginPath();
      ctx.moveTo((x - 10 + 12.5) * sf, (y + 5 + 12.5) * sf);
      ctx.lineTo((x + 10 + 12.5) * sf, (y + 5 + 12.5) * sf);
      ctx.lineTo((x + 10 + 12.5) * sf, (y - 3 + 12.5) * sf);
      ctx.lineTo((x + 8 + 12.5) * sf, (y - 5 + 12.5) * sf);
      ctx.lineTo((x + 6 + 12.5) * sf, (y - 5 + 12.5) * sf);
      ctx.lineTo((x + 4 + 12.5) * sf, (y - 3 + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y - 3 + 12.5) * sf);
      ctx.lineTo((x - 3 + 12.5) * sf, (y + 12.5) * sf);
      ctx.lineTo((x - 6 + 12.5) * sf, (y + 2 + 12.5) * sf);
      ctx.fill();
    };
  } else if (this.type == "harvester") {
    this.health = 3;
    this.inventory = [];
    this.inventorySize = 3;
    this.energy = 0;
    this.maxEnergy = 3;
    this.hasEot = true;
    this.hasAction = false;




    this.canAutoOut = true;
    this.isAutoOut = false;
    this.autoOutConfig = "right";




    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      //convert inv. energy -> local energy
      if (this.energy < this.maxEnergy) {
        for (var b = 0; b < this.inventory.length; b ++) {
          if (this.inventory[b] == "energy") {
            this.inventory.splice(b, 1);
            this.energy ++;
          }
        }
      }




      //find eblock




      this.eblock;
      var t;
      if (this.direction == "up") {
        t = accessPoint(this.x, this.y - 1, this.level);
      } else if (this.direction == "right") {
        t = accessPoint(this.x + 1, this.y, this.level);
      } else if (this.direction == "down") {
        t = accessPoint(this.x, this.y + 1, this.level);
      } else {
        t = accessPoint(this.x - 1, this.y, this.level);
      }
      if (t) {
        if (t.player != undefined) {
          if (t.player == "resource") {
            this.eblock = t;
          }
        }
      }




      //get resources




      if (this.inventory.length < this.inventorySize && this.energy > 0) {
        console.log(this.eblock)
        if (this.eblock.resources) {
          if (this.eblock.resources.length > 0) {
            this.energy --;
            var i = this.eblock.resources.pop();
            this.inventory.push(i);
          }
        }
      }




      //autoout




      if (this.isAutoOut && this.inventory.length > 0) {
        var t;
        if (this.autoOutConfig == "up") {
          t = accessPoint(this.x, this.y - 1, this.level);
        } else if (this.autoOutConfig == "left") {
          t = accessPoint(this.x - 1, this.y, this.level);
        } else if (this.autoOutConfig == "down") {
          t = accessPoint(this.x, this.y + 1, this.level);
        } else {
          t = accessPoint(this.x + 1, this.y, this.level);
        }
        if (t) {
          if (t.hasCompositeInventory) {
            var l = this.inventory.pop();
            if (!t.compositeInventoryPush(l)) {
              this.inventory.push(l);
            }
          } else if (t.inventory) {
            if (t.inventory.length < t.inventorySize) {
              var l = this.inventory.pop();
              t.inventory.push(l);
            }
          }
        }
      }
    };




    this.draw = function(x, y) {
      if (this.energy < this.maxEnergy) {
        for (var b = 0; b < this.inventory.length; b ++) {
          if (this.inventory[b] == "energy") {
            this.inventory.splice(b, 1);
            this.energy ++;
          }
        }
      }
      ctx.fillStyle = "rgb(170, 40, 0)";
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
      ctx.fillStyle = "rgb(0, 0, 0)";
      if (this.direction == "up") {
        ctx.fillRect((x + 6) * sf, (y + 3) * sf, 13 * sf, 4 * sf);
      } else if (this.direction == "left") {
        ctx.fillRect((x + 3) * sf, (y + 6) * sf, 4 * sf, 13 * sf);
      } else if (this.direction == "down") {
        ctx.fillRect((x + 6) * sf, (y + 19) * sf, 13 * sf, 4 * sf);
      } else if (this.direction == "right") {
        ctx.fillRect((x + 19) * sf, (y + 6) * sf, 4 * sf, 13 * sf);
      }
      ctx.fillStyle = "rgb(200, 200, 200)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.sin(0) * 10) * sf, (y + 12.5 + Math.sin(0) * 10) * sf);
      for(var i = 0; i < 16; i++) {
        ctx.lineTo((x + 12.5 + Math.cos(i * Math.PI / 4 - Math.PI / 8) * 4) * sf, (y + 12.5 + Math.sin(i * Math.PI / 4 - Math.PI / 8) * 4) * sf);
        ctx.lineTo((x + 12.5 + Math.cos(i * Math.PI / 4) * 10) * sf, (y + 12.5 + Math.sin(i * Math.PI / 4) * 10) * sf);
      }
      ctx.fill();
      ctx.fillStyle = "rgb(80, 80, 80)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
    }




    this.eotDraw = function(x, y) {
      var angle = rand(Math.PI * 2);
      particles.push(new particle(x + 12.5, y + 12.5, 2 + ran(2), 30, {velocity: {mx: Math.cos(angle) * 1.5, my: Math.sin(angle) * 1.5}, shape: "circle", color: "rgb(100, 100, 100)"}))
    }
  } else if (this.type == "appraiser") {
    this.health = 2;
    this.inventory = [];
    this.inventorySize = 1;
    this.hasEot = true;
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      if (this.inventory.length != 0) {
        var item = this.inventory[0];
        if (item == "gold") {
          if (this.player == 1) {
            p1.scrap += 18;
          } else {
            p2.scrap += 18;
          }
        } else if (item == "alloy") {
          if (this.player == 1) {
            p1.scrap += 26;
          } else {
            p2.scrap += 26;
          }
        } else if (item == "organic matter") {
          if (this.player == 1) {
            p1.scrap += 10;
          } else {
            p2.scrap += 10;
          }
        } else if (item == "stone") {
          if (this.player == 1) {
            p1.scrap += 12;
          } else {
            p2.scrap += 12;
          }
        }
      }
    };
    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.fillRect((x + 3) * sf, (y + 16) * sf, 19 * sf, 9 * sf);
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 2 * sf;
      ctx.strokeRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 12 * sf);
      if (this.inventory.length > 0) {
        if (this.inventory[0] == "alloy") {
          ctx.fillStyle = "rgb(200, 200, 200)";
          ctx.beginPath();
          ctx.moveTo((x + 8) * sf, (y + 14) * sf);
          ctx.lineTo((x + 18) * sf, (y + 15) * sf);
          ctx.lineTo((x + 20) * sf, (y + 9) * sf);
          ctx.lineTo((x + 17) * sf, (y + 4) * sf);
          ctx.lineTo((x + 14) * sf, (y + 7) * sf);
          ctx.fill();
        } else if (this.inventory[0] == "gold") {
          ctx.fillStyle = "rgb(200, 140, 0)";
          ctx.beginPath();
          ctx.moveTo((x + 8) * sf, (y + 14) * sf);
          ctx.lineTo((x + 18) * sf, (y + 15) * sf);
          ctx.lineTo((x + 20) * sf, (y + 9) * sf);
          ctx.lineTo((x + 17) * sf, (y + 4) * sf);
          ctx.lineTo((x + 14) * sf, (y + 7) * sf);
          ctx.fill();
        } else if (this.inventory[0] == "organic matter") {
          ctx.fillStyle = "rgb(0, 120, 0)";
          ctx.beginPath();
          ctx.moveTo((x + 8) * sf, (y + 14) * sf);
          ctx.lineTo((x + 18) * sf, (y + 15) * sf);
          ctx.lineTo((x + 20) * sf, (y + 9) * sf);
          ctx.lineTo((x + 17) * sf, (y + 4) * sf);
          ctx.lineTo((x + 14) * sf, (y + 7) * sf);
          ctx.fill();
        } else if (this.inventory[0] == "stone") {
          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.beginPath();
          ctx.moveTo((x + 8) * sf, (y + 14) * sf);
          ctx.lineTo((x + 18) * sf, (y + 15) * sf);
          ctx.lineTo((x + 20) * sf, (y + 9) * sf);
          ctx.lineTo((x + 17) * sf, (y + 4) * sf);
          ctx.lineTo((x + 14) * sf, (y + 7) * sf);
          ctx.fill();
        }
      }
      ctx.fillStyle = "rgba(120, 200, 230, 0.4)";
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 12 * sf);
    };
    this.eotTime = 0;
    this.eotDraw = function(x, y) {
      this.eotTime ++;
      var dist = Math.sin(this.eotTime * Math.PI / 12) + 3;
      var angle = this.eotTime * Math.PI / 24;
      for(var exd = 0; exd < 12; exd ++) {
        ctx.fillStyle = "rgb(230, 230, 230)";
        ctx.beginPath();
        ctx.arc((x + 12.5 + Math.cos(angle + exd * (Math.PI / 6)) * (dist * 3)) * sf, (y + 12.5 + Math.sin(angle + exd * (Math.PI / 6)) * (dist * 3)) * sf, (dist / 3 + 0.5) * sf, 0, Math.PI * 2, false);
        ctx.fill();
      }
    }
  } else if (this.type == "chipper") {
    this.health = 2;




    this.inventory = [];
    this.inventorySize = 2;




    this.hasEot = true;




    this.energy = 0;
    this.hasAction = true;




    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      var nonEnergy = 0;
      for(var g = 0; g < this.inventory.length; g++) {
        if (this.inventory[g] != "energy") {
          nonEnergy ++;
        }
      }
      while(this.inventory.length > nonEnergy) {
        for(var g = 0; g < this.inventory.length; g++) {
          if (this.inventory[g] == "energy") {
            this.inventory.splice(g, 1);
            this.energy ++;
          }
        }
      }
    };




    this.eotDraw = function(x, y) {
      particles.push(new particle(x + ran(25), y + ran(25), 5 + rand(2), 2, {shape: "circle", color:"rgb(255, 255, 0)"}));
    };




    this.draw = function(x, y) {
      if (this.direction == "up") {
        ctx.fillStyle = "rgb(150, 150, 150)";
        ctx.fillRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgb(255, 40, 30)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 8) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(60, 60, 60)";
        ctx.strokeRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 9) * sf, (y - 1) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 16) * sf, (y - 1) * sf);
        ctx.stroke();
      } else if (this.direction == "down") {
        ctx.fillStyle = "rgb(150, 150, 150)";
        ctx.fillRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgb(255, 40, 30)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 8) * sf);
        ctx.lineTo((x + 17) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 8) * sf);
        ctx.lineTo((x + 8) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(60, 60, 60)";
        ctx.strokeRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 21) * sf);
        ctx.lineTo((x + 16) * sf, (y + 26) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 21) * sf);
        ctx.lineTo((x + 9) * sf, (y + 26) * sf);
        ctx.stroke();
      } else if (this.direction == "left") {
        ctx.fillStyle = "rgb(150, 150, 150)";
        ctx.fillRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgb(255, 40, 30)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 8) * sf);
        ctx.lineTo((x + 17) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(60, 60, 60)";
        ctx.strokeRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x - 1) * sf, (y + 9) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 21) * sf);
        ctx.lineTo((x - 1) * sf, (y + 16) * sf);
        ctx.stroke();
      } else if (this.direction == "right") {
        ctx.fillStyle = "rgb(150, 150, 150)";
        ctx.fillRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgb(255, 40, 30)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 8) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 8) * sf);
        ctx.lineTo((x + 8) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(60, 60, 60)";
        ctx.strokeRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 26) * sf, (y + 9) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 21) * sf);
        ctx.lineTo((x + 26) * sf, (y + 16) * sf);
        ctx.stroke();
      }
    };




    this.lastEndRange = false;




    this.action = function() {
      var range = 5;
      if (this.energy > 0) {
        var hasFound = false;
        if (this.direction == "up") {
          for(var g = 1; g < range; g ++) {
            var t = accessPoint(this.x, this.y - g, this.level);
            console.log(g);
            if (t) {
              if (t.health) {
                t.takeDamage(1);
                this.lastEndRange = g;
                hasFound = true;
                break;
              } else if (t.hasCompositeHealth) {
                t.compositeTakeDamage(1);
                this.lastEndRange = g;
                hasFound = true;
                break;
              }
            }
          }
          if (!hasFound) {
            this.lastEndRange = range - 1;
          }
        } else if (this.direction == "down") {
          for(var g = 1; g < range; g ++) {
          var t = accessPoint(this.x, this.y + g, this.level);
            if (t) {
              if (t.health) {
                t.takeDamage(1);
                this.lastEndRange = g;
                hasFound = true;
                break;
              } else if (t.hasCompositeHealth) {
                t.compositeTakeDamage(1);
                this.lastEndRange = g;
                hasFound = true;
                break;
              }
            }
          }
          if (!hasFound) {
            this.lastEndRange = range - 1;
          }
        } else if (this.direction == "left") {
          for(var g = 1; g < range; g ++) {
            var t = accessPoint(this.x - g, this.y, this.level);
            if (t) {
              if (t.health) {
                t.takeDamage(1);
                this.lastEndRange = g;
                hasFound = true;
                break;
              } else if (t.hasCompositeHealth) {
                t.compositeTakeDamage(1);
                this.lastEndRange = g;
                hasFound = true;
                break;
              }
            }
          }
          if (!hasFound) {
            this.lastEndRange = range - 1;
          }
        } else if (this.direction == "right") {
          for(var g = 1; g < range; g ++) {
            var t = accessPoint(this.x + g, this.y, this.level);
            if (t) {
              if (t.health) {
                t.takeDamage(1);
                this.lastEndRange = g;
                hasFound = true;
                break;
              } else if (t.hasCompositeHealth) {
                t.compositeTakeDamage(1);
                this.lastEndRange = g;
                hasFound = true;
                break;
              }
            }
          }
          if (!hasFound) {
            this.lastEndRange = range - 1;
          }
        }
        this.energy --;
      }
    };
    this.actionDraw = function(time, x, y) {
      if (time < 25) {
        if (this.direction == "up") {
          ctx.fillStyle = "rgba(255, 40, 30, " + (0.4) + ")";
          ctx.fillRect((x + 5) * sf, (y - (10 + (this.lastEndRange - 1) * 25)) * sf, 15, ((10 + (this.lastEndRange - 1) * 25)) * sf);
        } else if (this.direction == "down") {
          ctx.fillStyle = "rgba(255, 40, 30, " + (0.4) + ")";
          ctx.fillRect((x + 5) * sf, (y + 25) * sf, 15 * sf, (10 + (this.lastEndRange - 1) * 25) * sf);
        } else if (this.direction == "left") {
          ctx.fillStyle = "rgba(255, 40, 30, " + (0.4) + ")";
          ctx.fillRect((x - (10 + (this.lastEndRange - 1) * 25)) * sf, (y + 5) * sf, (10 + (this.lastEndRange - 1) * 25) * sf, 15 * sf);
        } else if (this.direction == "right") {
          ctx.fillStyle = "rgba(255, 40, 30, " + (0.4) + ")";
          ctx.fillRect((x + 25) * sf, (y + 5) * sf, (10 + (this.lastEndRange - 1) * 25) * sf, 15 * sf);
        }
      } else {
        if (this.direction == "up") {
          ctx.fillStyle = "rgba(255, 40, 30, " + (0.4 * (25 - (time - 25)) / 25) + ")";
          ctx.fillRect((x + 5) * sf, (y - (10 + (this.lastEndRange - 1) * 25)) * sf, 15 * sf, (10 + (this.lastEndRange - 1) * 25) * sf);
        } else if (this.direction == "down") {
          ctx.fillStyle = "rgba(255, 40, 30, " + (0.4 * (25 - (time - 25)) / 25) + ")";
          ctx.fillRect((x + 5) * sf, y + 25 * sf, 15 * sf, ((10 + (this.lastEndRange - 1) * 25) * sf));
        } else if (this.direction == "left") {
          ctx.fillStyle = "rgba(255, 40, 30, " + (0.4 * (25 - (time - 25)) / 25) + ")";
          ctx.fillRect((x - (10 + (this.lastEndRange - 1) * 25)) * sf, (y + 5) * sf, (10 + (this.lastEndRange - 1) * 25) * sf, 15 * sf);
        } else if (this.direction == "right") {
          ctx.fillStyle = "rgba(255, 40, 30, " + (0.4 * (25 - (time - 25)) / 25) + ")";
          ctx.fillRect((x + 25) * sf, (y + 5) * sf, (10 + (this.lastEndRange - 1) * 25) * sf, 15 * sf);
        }
      }
    }
  } else if (this.type == "cannon") {
    this.health = 3;
    this.inventory = [];
    this.inventorySize = 3;
    this.hasAction = true;
    this.range = 5;
    this.mode = 1;
    this.modeList = ["stone", "gold"];




    this.action = function() {
      if (this.inventory.length > 0) {
        var f = false;
        var t = "stone"
        if (this.mode == 2) {
          t = "gold"
        }
        for(var arbory = 0; arbory < this.inventory.length; arbory ++) {
          if (this.inventory[arbory] == t && !f) {
            f = true;
            this.inventory.splice(arbory, 1);
          }
        }
        if (f) {
          var dmg = 2;
          if (this.mode == 2) {
            dmg = 3;
          }
          var t = false;
          var c = false;
          if (this.direction == "up") {
            for(var rang = 1; rang < this.range + 1; rang ++) {
              var a = accessPoint(this.x - rang, this.y - rang, this.level);
              if (a) {
                if (a.health != undefined) {
                  t = a;
                  break;
                } else if (a.hasCompositeHealth) {
                  t = a;
                  c = true;
                }
              }
            }
          } else if (this.direction == "right") {
            for(var rang = 1; rang < this.range + 1; rang ++) {
              var a = accessPoint(this.x + rang, this.y - rang, this.level);
              if (a) {
                if (a.health != undefined) {
                  t = a;
                  break;
                } else if (a.hasCompositeHealth) {
                  t = a;
                  c = true;
                }
              }
            }
          } else if (this.direction == "down") {
            for(var rang = 1; rang < this.range + 1; rang ++) {
              var a = accessPoint(this.x + rang, this.y + rang, this.level);
              if (a) {
                if (a.health != undefined) {
                  t = a;
                  break;
                } else if (a.hasCompositeHealth) {
                  t = a;
                  c = true;
                }
              }
            }
          } else {
            for(var rang = 1; rang < this.range + 1; rang ++) {
              var a = accessPoint(this.x - rang, this.y + rang, this.level);
              if (a) {
                if (a.health != undefined) {
                  t = a;
                  break;
                } else if (a.hasCompositeHealth) {
                  t = a;
                  c = true;
                }
              }
            }
          }
          if (t != false) {
            if (c) {
              t.compositeTakeDamage(dmg);
            } else {
              t.takeDamage(dmg);
            }
          }
        }
      }
    };




    this.actionDraw = function(t, x, y) {
      if (t == 1) {
        var angle;
        if (this.direction == "up") {
          angle = Math.PI * -0.75;
        } else if (this.direction == "right") {
          angle = Math.PI * -0.25;
        } else if (this.direction == "down") {
          angle = Math.PI * 0.25;
        } else {
          angle = Math.PI * 0.75;
        }
        for(var partida = 0; partida < 15; partida ++) {
          var o = angle - Math.PI * 0.1 + rand(Math.PI * 0.2);
          var c;
          if (ran(3) == 0) {
            var p = ran(50);
            var s = 20 + ran(10);
            c = "rgba(" + p + ", " + p + ", " + p + ", 0.7)";
          } else {
            var s = 8 + ran(5);
            c = "rgb(255, " + ran(255) + ", 0)";
          }
          particles.push(new particle(x + 12.5 + Math.cos(o) * 14, y + 12.5 + Math.sin(o) * 14, s, 40, {color: c, shape: "circle", velocity: {mx: Math.cos(o) * (1 + rand(0.5)), my: Math.sin(o) * (1 + rand(0.5))}}));
        }
        for(var partida = 0; partida < 15; partida ++) {
          var o = angle - Math.PI * 0.1 + rand(Math.PI * 0.2);
          particles.push(new particle(x + 12.5 + Math.cos(o) * 14, y + 12.5 + Math.sin(o) * 14, 2 + rand(3), 40, {color: "rgb(255, " + ran(255) + ", 0)", shape: "circle", velocity: {mx: Math.cos(o) * rand(4), my: Math.sin(o) * rand(4)}}));
        }
      }
    }
    
    this.draw = function(x, y) {
      ctx.strokeStyle = "rgb(60, 60, 60)";
      ctx.lineWidth = 9 * sf;
      var angle;
      if (this.direction == "up") {
        angle = Math.PI * -0.75;
      } else if (this.direction == "right") {
        angle = Math.PI * -0.25;
      } else if (this.direction == "down") {
        angle = Math.PI * 0.25;
      } else {
        angle = Math.PI * 0.75;
      }
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(angle) * 14) * sf, (y + 12.5 + Math.sin(angle) * 14) * sf);
      ctx.stroke();
      
      ctx.fillStyle = "rgb(100, 100, 100)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 8 * sf, 0, Math.PI * 2, false);
      ctx.fill();




    }
  } else if (this.type == "jumper") {
    this.health = 1;
    this.inventory = [];
    this.inventorySize = 1;
    this.hasEot = true;
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      if (this.inventory.length > 0) {
        var t = 0;
        if (this.direction == "up") {
          t = accessPoint(this.x, this.y - 2, this.level);
        } else if (this.direction == "down") {
          t = accessPoint(this.x, this.y + 2, this.level);
        } else if (this.direction == "left") {
          t = accessPoint(this.x - 2, this.y, this.level);
        } else {
          t = accessPoint(this.x + 2, this.y, this.level);
        }




        if (t) {
          if (t.inventory != undefined) {
            if (t.hasCompositeInventory) {
              if (this.inventory.length > 0) {
                var thingy = this.inventory.pop();
                var nitem = t.compositeInventoryPush(thingy);
                if (!nitem) {
                  this.inventory.push(thingy);
                }
              }
            } else if (t.inventory.length < t.inventorySize) {
              t.inventory.push(this.inventory.pop());
            }
          }
        }
      }
    }
    this.eotDrawWaitTime = 0;
    this.eotDraw = function(x, y) {
      this.eotDrawWaitTime ++;
      var angle = 0;
      if (this.direction == "up") {
        angle = Math.PI * -0.5;
      } else if (this.direction == "down") {
        angle = Math.PI * 0.5;
      } else if (this.direction == "left") {
        angle = Math.PI;
      } else {
        angle = 0;
      }




      ctx.strokeStyle = "rgba(220, 125, 0, 0.75)";
      ctx.lineWidth = 3 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + (Math.cos(angle + Math.PI / 2) * 8) + Math.cos(angle) * 12) * sf, (y + 12.5 + (Math.sin(angle + Math.PI / 2) * 8) + Math.sin(angle) * 12) * sf);
      ctx.lineTo((x + 12.5 + (Math.cos(angle + Math.PI / 2) * 8) + Math.cos(angle) * 38) * sf, (y + 12.5 + (Math.sin(angle + Math.PI / 2) * 8) + Math.sin(angle) * 38) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + (Math.cos(angle - Math.PI / 2) * 8) + Math.cos(angle) * 12) * sf, (y + 12.5 + (Math.sin(angle - Math.PI / 2) * 8) + Math.sin(angle) * 12) * sf);
      ctx.lineTo((x + 12.5 + (Math.cos(angle - Math.PI / 2) * 8) + Math.cos(angle) * 38) * sf, (y + 12.5 + (Math.sin(angle - Math.PI / 2) * 8) + Math.sin(angle) * 38) * sf);
      ctx.stroke();
      for (var dorn = 0; dorn < 5; dorn ++) {
        ctx.fillStyle = "rgba(255, 80, 0, 0.85)";
        var offset = 12 + ((this.eotDrawWaitTime / 4) % 5) + dorn * 5
        ctx.beginPath();
        ctx.moveTo(((x + 12.5 + Math.cos(angle) * offset) + Math.cos(angle) * 2) * sf, ((y + 12.5 + Math.sin(angle) * offset) + Math.sin(angle) * 2) * sf);
        ctx.lineTo(((x + 12.5 + Math.cos(angle) * offset) + Math.cos(angle) * -2 + Math.cos(angle + Math.PI / 2) * 5) * sf, ((y + 12.5 + Math.sin(angle) * offset) +  + Math.sin(angle) * -2 + Math.sin(angle + Math.PI / 2) * 5) * sf);
        ctx.lineTo(((x + 12.5 + Math.cos(angle) * offset) + Math.cos(angle) * -2 + Math.cos(angle - Math.PI / 2) * 5) * sf, ((y + 12.5 + Math.sin(angle) * offset) +  + Math.sin(angle) * -2 + Math.sin(angle - Math.PI / 2) * 5) * sf);
        ctx.fill();
      }












      




    };




    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(220, 120, 0)";
      var a = 0;
      if (this.direction == "up") {
        a = Math.PI * -0.5;
      } else if (this.direction == "down") {
        a = Math.PI * 0.5;
      } else if (this.direction == "left") {
        a = Math.PI;
      } else {
        a = 0;
      }
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 10) * sf, (y + 12.5 + Math.sin(a) * 10) * sf);
      a += Math.PI / 1.5;
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10) * sf, (y + 12.5 + Math.sin(a) * 10) * sf);
      a += Math.PI / 1.5;
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10) * sf, (y + 12.5 + Math.sin(a) * 10) * sf);
      ctx.fill();
    }
  } else if (this.type == "drill s head") {
    this.health = 3;
    this.isComposite = true;
    this.hasCompositeHealth = true;
    this.hasCompositeInventory = true;
    this.inventory = [];
    this.inventorySize = 2;
    this.energy = 0;
    this.hasEot = true;
    this.composite = [];
    this.rotOffset = 0;
    this.nextDrop = "stone";
    this.turnProgress = 0;




    this.compositeInventoryPush = function(input) {
      if (this.composite.length > 0) {
        if (this.composite[0].inventory.length < this.composite[0].inventorySize) {
          this.composite[0].inventory.push(input);
          return(true);
        }
      }
      return(false);
    };
    this.returnInventory = function() {
      if (this.composite.length > 0) {
        return(this.composite[0].inventory);
      } else {
        return(this.inventory);
      }
    };
    this.compositeSiphon = function() {
      if (this.composite) {
        if (this.composite[0].inventory.length > 0) {
          return(this.composite[0].inventory.pop());
        }
      } else if (this.inventory.length > 0) {
        return(this.inventory.pop());
      }
      return(false);
    };
    this.compositeTakeDamage = function(dmg) {
      this.health -= dmg;
      if (this.health <= 0) {
        this.compositeDeath();
      }
    };
    this.compositeDeath = function() {
      if (this.composite.length) {
        var t = getCoordsOnPlatform(this.composite[0].x, this.composite[0].y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    };
    
    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(0, 80, 0)";
      ctx.beginPath();
      ctx.moveTo(x * sf, y * sf);
      ctx.lineTo((x + 25) * sf, y * sf);
      ctx.lineTo((x + 25) * sf, (y + 25) * sf);
      ctx.lineTo(x * sf, (y + 25) * sf);
      ctx.lineTo(x * sf, y * sf);
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      
      ctx.fillStyle = "rgb(130, 130, 130)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.fill();




      ctx.strokeStyle = "rgb(30, 30, 30)";
      ctx.lineWidth = 1.5 * sf;
      var a = this.rotOffset;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 9) * sf, (y + 12.5 + Math.sin(a) * 9) * sf);
      for(var going = 0; going < 16; going ++) {
        a += Math.PI / 4;
        ctx.lineTo((x + 12.5 + Math.cos(a) * (9 - going / 2)) * sf, (y + 12.5 + Math.sin(a) * (9 - going / 2)) * sf);
      }
      ctx.stroke();




      //check for composite




      if (this.composite.length < 1) {
        var t;
        if (this.direction == "up") {
          t = accessPoint(this.x, this.y + 1, this.level);
        } else if (this.direction == "down") {
          t = accessPoint(this.x, this.y - 1, this.level);
        } else if (this.direction == "left") {
          t = accessPoint(this.x + 1, this.y, this.level);
        } else {
          t = accessPoint(this.x - 1, this.y, this.level);
        }
        if (t) {
          if (t.type == "drill s body") {
            this.composite.push(t);
          }
        }
      }
    };




    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      var t = 0;
      if (this.composite.length == 0) {
        for(var going = 0; going < this.inventory.length; going ++) {
          if (this.inventory[going] == "energy") {
            this.energy ++;
            this.inventory.splice(going, 1);
            going --;
          }
        }
      } else {
        for(var going = 0; going < this.composite[0].inventory.length; going ++) {
          if (this.composite[0].inventory[going] == "energy") {
            this.energy ++;
            this.composite[0].inventory.splice(going, 1);
            going --;
          }
        }
      }
      if (this.energy > 0) {
        if (this.composite.length > 0) {
          if (this.composite[0].inventory.length < this.composite[0].inventorySize) {
            var drop = this.nextDrop;
            this.composite[0].inventory.push(drop);
          } else {
            this.inventory.push(drop);
          }
        } else {
          this.inventory.push(drop);
        }
        this.energy --;
      }
      this.turnProgress ++;
      if (this.turnProgress % 4 == 1) {
        this.nextDrop = "gold";
      } else {
        this.nextDrop = "stone";
      }
    };




    this.eotDraw = function(time, x, y) {
      this.rotOffset += Math.PI / 20;
      var angle = rand(Math.PI * 2);
      var hue = 50 + ran(125);
      particles.push(new particle(x + 12.5, y + 12.5, 2 + rand(2), 25 + ran(10), {velocity: {mx: Math.cos(angle) * 2, my: Math.sin(angle) * 2}, color: "rgb(" + hue + ", " + hue + ", " + hue + ")", shape: "circle"}));
    };




  } else if (this.type == "drill s body") {
    this.isComposite = true;
    this.hasCompositeHealth = true;
    this.composite = [];
    this.inventory = [];
    this.inventorySize = 3;
    this.hasCompositeInventory = true;




    this.compositeInventoryPush = function(input) {
      if (this.inventory.length < this.inventorySize) {
        this.inventory.push(input);
        return true;
      }
      return false;
    };
    this.returnInventory = function() {
      return(this.inventory);
    };
    this.compositeSiphon = function() {
      if (this.inventory.length > 0) {
        return(this.inventory.pop());
      }
      return(false);
    };
    this.compositeTakeDamage = function(dmg) {
      if (this.composite.length > 0) {
        this.composite[0].compositeTakeDamage(dmg);
      }
    };
    this.compositeDeath = function() {
      if (this.composite.length > 0) {
        var t = getCoordsOnPlatform(this.composite[0].x, this.composite[0].y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    };




    this.draw = function(x, y) {
      ctx.strokeStyle = "rgb(70, 140, 70)";
      ctx.lineWidth = 4 * sf;
      ctx.strokeRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.fillStyle = "rgb(35, 70, 35)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.fillStyle = "rgb(125, 125, 125)";
      ctx.beginPath();
      ctx.arc((x + 10) * sf, (y + 8) * sf, 4 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 16) * sf, (y + 6) * sf, 2.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 6) * sf, (y + 16) * sf, 3.25 * sf, 0, Math.PI * 2, false);
      ctx.fill();




      if (this.composite.length < 1) {
        var t;
        if (this.direction == "up") {
          t = accessPoint(this.x, this.y - 1, this.level);
        } else if (this.direction == "down") {
          t = accessPoint(this.x, this.y + 1, this.level);
        } else if (this.direction == "left") {
          t = accessPoint(this.x - 1, this.y, this.level);
        } else {
          t = accessPoint(this.x + 1, this.y, this.level);
        }
        if (t) {
          if (t.type == "drill s head") {
            this.composite.push(t);
          }
        }
      }
    };
  } else if (this.type == "smelter info") {
    this.health = 5;
    this.hasCompositeHealth = true;
    this.inventory = [];
    this.inventorySize = 6;
    this.hasEot = true;
    this.isComposite = true;
    this.hasCompositeInventory = false;
    this.composite = [];
    this.compositeIndex = {
      input: null,
      output: null
    };
    this.compositeTakeDamage = function(dmg) {
      this.health -= dmg;
      if (this.health <= 0) {
        this.compositeDeath();
      }
    }




    this.compositeDeath = function() {
      if (this.compositeIndex.input) {
        for(var gong = 0; gong < this.compositeIndex.input.length; gong ++) {
          var r = getCoordsOnPlatform(this.compositeIndex.input[gong].x, this.compositeIndex.input[gong].y);
          r.platform.grid[r.x - 1][r.y - 1] = 0;
        }
      }
      if (this.compositeIndex.output) {
        var r = getCoordsOnPlatform(this.compositeIndex.output.x, this.compositeIndex.output.y);
        r.platform.grid[r.x - 1][r.y - 1] = 0;
      }
      var r = getCoordsOnPlatform(this.x, this.y);
      r.platform.grid[r.x - 1][r.y - 1] = 0;
    }




    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(220, 150, 80)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.strokeStyle = "rgb(110, 75, 40)";
      ctx.lineWidth = 2 * sf;
      if (this.direction == "up") {
        ctx.beginPath();
        ctx.moveTo((x + 25) * sf, y * sf);
        ctx.lineTo((x + 25) * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, (y + 25) * sf);
        ctx.stroke();




        //composite locating
        if (this.compositeIndex.input == null) {
          var found = false;
          var t = accessPoint(this.x - 1, this.y, this.level);
          
          if (t) {
            if (t.type == "smelter input") {
              found = true;
              this.compositeIndex.input = [t];
            }
          }
          var t = accessPoint(this.x, this.y - 1, this.level);
          if (t) {
            if (t.type == "smelter input") {
              if (found) {
                this.compositeIndex.input.push(t);
              } else {
                this.compositeIndex.input = [t];
              }
            }
          }
        } else if (this.compositeIndex.input.length < 2) {
          if (this.compositeIndex.input.x == this.x - 1) {
            var t = accessPoint(this.x, this.y - 1, this.level);
          } else {
            var t = accessPoint(this.x - 1, this.y, this.level);
          }
          if (t) {
            if (t.type == "smelter input") {
              this.compositeIndex.input.push(t);
            }
          }
        }
        if (this.compositeIndex.output == null) {
          var t = accessPoint(this.x - 1, this.y - 1, this.level);
          if (t) {
            if (t.type == "smelter output") {
              this.compositeIndex.output = t;
            }
          }
        }
      } else if (this.direction == "down") {
        ctx.beginPath();
        ctx.moveTo(x * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, y * sf);
        ctx.lineTo((x + 25) * sf, y * sf);
        ctx.stroke();




        //composite locating
        if (this.compositeIndex.input == null) {
          var found = false;
          var t = accessPoint(this.x + 1, this.y, this.level);
          if (t) {
            if (t.type == "smelter input") {
              found = true;
              this.compositeIndex.input = [t];
            }
          }
          var t = accessPoint(this.x, this.y + 1, this.level);
          if (t) {
            if (t.type == "smelter input") {
              if (found) {
                this.compositeIndex.input.push(t);
              } else {
                this.compositeIndex.input = [t];
              }
            }
          }
        } else if (this.compositeIndex.input.length < 2) {
          if (this.compositeIndex.input.x == this.x + 1) {
            var t = accessPoint(this.x, this.y + 1, this.level);
          } else {
            var t = accessPoint(this.x + 1, this.y, this.level);
          }
          if (t) {
            if (t.type == "smelter input") {
              this.compositeIndex.input.push(t);
            }
          }
        }
        if (this.compositeIndex.output == null) {
          var t = accessPoint(this.x + 1, this.y + 1, this.level);
          if (t) {
            if (t.type == "smelter output") {
              this.compositeIndex.output = t;
            }
          }
        }
      } else if (this.direction == "left") {
        ctx.beginPath();
        ctx.moveTo(x * sf, y * sf);
        ctx.lineTo((x + 25) * sf, y * sf);
        ctx.lineTo((x + 25) * sf, (y + 25) * sf);
        ctx.stroke();




        //composite locating
        if (this.compositeIndex.input == null) {
          var found = false;
          var t = accessPoint(this.x - 1, this.y, this.level);
          if (t) {
            if (t.type == "smelter input") {
              found = true;
              this.compositeIndex.input = [t];
            }
          }
          var t = accessPoint(this.x, this.y + 1, this.level);
          if (t) {
            if (t.type == "smelter input") {
              if (found) {
                this.compositeIndex.input.push(t);
              } else {
                this.compositeIndex.input = [t];
              }
            }
          }
        } else if (this.compositeIndex.input.length < 2) {
          if (this.compositeIndex.input.x == this.x - 1) {
            var t = accessPoint(this.x, this.y + 1, this.level);
          } else {
            var t = accessPoint(this.x - 1, this.y, this.level);
          }
          if (t) {
            if (t.type == "smelter input") {
              this.compositeIndex.input.push(t);
            }
          }
        }
        if (this.compositeIndex.output == null) {
          var t = accessPoint(this.x - 1, this.y + 1, this.level);
          if (t) {
            if (t.type == "smelter output") {
              this.compositeIndex.output = t;
            }
          }
        }
      } else {
        ctx.beginPath();
        ctx.moveTo((x + 25) * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, y * sf);
        ctx.stroke();




        //composite locating
        if (this.compositeIndex.input == null) {
          var found = false;
          var t = accessPoint(this.x + 1, this.y, this.level);
          if (t) {
            if (t.type == "smelter input") {
              found = true;
              this.compositeIndex.input = [t];
            }
          }
          var t = accessPoint(this.x, this.y - 1, this.level);
          if (t) {
            if (t.type == "smelter input") {
              if (found) {
                this.compositeIndex.input.push(t);
              } else {
                this.compositeIndex.input = [t];
              }
            }
          }
        } else if (this.compositeIndex.input.length < 2) {
          if (this.compositeIndex.input.x == this.x + 1) {
            var t = accessPoint(this.x, this.y - 1, this.level);
          } else {
            var t = accessPoint(this.x + 1, this.y, this.level);
          }
          if (t) {
            if (t.type == "smelter input") {
              this.compositeIndex.input.push(t);
            }
          }
        }
        if (this.compositeIndex.output == null) {
          var t = accessPoint(this.x + 1, this.y - 1, this.level);
          if (t) {
            if (t.type == "smelter output") {
              this.compositeIndex.output = t;
            }
          }
        }
      }
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.fillRect((x + 4) * sf, (y + 7) * sf, 17 * sf, 12 * sf);
      ctx.strokeStyle = "rgb(30, 170, 30)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 6) * sf, (y + 10) * sf);
      ctx.lineTo((x + 19) * sf, (y + 10) * sf);
      ctx.moveTo((x + 6) * sf, (y + 13) * sf);
      ctx.lineTo((x + 19) * sf, (y + 13) * sf);
      ctx.moveTo((x + 6) * sf, (y + 16) * sf);
      ctx.lineTo((x + 12) * sf, (y + 16) * sf);
      ctx.stroke();
    };




    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      if (this.compositeIndex.input != null) {
        for(var shaker = 0; shaker < this.compositeIndex.input.length; shaker ++) {
          if (this.compositeIndex.input[shaker] != 0) {
            for(var blaker = 0; blaker < this.compositeIndex.input[shaker].inventory.length; blaker ++) {
              if (this.compositeIndex.input[shaker].inventory.length > 0 && this.inventory.length < this.inventorySize) {
                this.inventory.push(this.compositeIndex.input[shaker].inventory.pop());
                blaker --;
              }
            }
          }
        }
        var can = true;
        while(can) {
          invCount = {
            stone: 0,
            org: 0,
            gold: 0
          };
          for (var shaker = 0; shaker < this.inventory.length; shaker ++) {
            if (this.inventory[shaker] == "gold") {
              invCount.gold ++;
            } else if (this.inventory[shaker] == "organic matter") {
              invCount.org ++;
            } else if (this.inventory[shaker] == "stone") {
              invCount.stone ++;
            }
          }




          if (invCount.gold > 0) {
            if (this.compositeIndex.output) {
              if (this.compositeIndex.output.inventory.length < this.compositeIndex.output.inventorySize) {
                this.compositeIndex.output.inventory.push("alloy");
              } else {
                this.inventory.push("alloy");
              }
            } else {
              this.inventory.push("alloy");
            }
            invCount.gold = 1;
            for (var shaker = 0; shaker < this.inventory.length; shaker ++) {
              if (this.inventory[shaker] == "gold") {
                if (invCount.gold > 0) {
                  invCount.gold --;
                  this.inventory.splice(shaker, 1);
                  shaker --;
                }
              } else if (this.inventory[shaker] == "organic matter" || this.inventory[shaker] == "stone") {
                if (invCount.org > 0) {
                  invCount.org --;
                  this.inventory.splice(shaker, 1);
                  shaker --;
                }
              }
            }
          } else {
            can = false;
          }
        }
      }
    };
    this.eotDraw = function(time, x, y) {};
  } else if (this.type == "smelter input") {
    this.hasCompositeHealth = true;
    this.inventory = [];
    this.inventorySize = 2;
    this.isComposite = true;
    this.composite = [];
    this.mainComposite = 0;




    this.compositeTakeDamage = function(dmg) {
      if (this.mainComposite) {
        this.mainComposite.takeDamage(dmg);
      }
    };
    
    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(220, 150, 80)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.strokeStyle = "rgb(110, 75, 40)";
      ctx.lineWidth = 2 * sf;
      if (this.direction == "up") {
        ctx.beginPath();
        ctx.moveTo((x + 25) * sf, y * sf);
        ctx.lineTo((x + 25) * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, (y + 25) * sf);
        ctx.stroke();




        ctx.fillStyle = "rgb(70, 5, 20)";
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 21) * sf);
        ctx.lineTo((x + 19) * sf, (y + 21) * sf);
        ctx.lineTo((x + 11.5) * sf, (y + 13) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 19) * sf);
        ctx.lineTo((x + 13) * sf, (y + 11.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 13) * sf);
        ctx.lineTo((x + 13) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 4) * sf);
        ctx.fill();
        if (this.mainComposite == 0) {
          var t = accessPoint(this.x - 1, this.y, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
          var t = accessPoint(this.x, this.y - 1, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
        }
      } else if (this.direction == "down") {
        ctx.beginPath();
        ctx.moveTo(x * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, y * sf);
        ctx.lineTo((x + 25) * sf, y * sf);
        ctx.stroke();




        ctx.fillStyle = "rgb(70, 5, 20)";
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 6) * sf, (y + 4) * sf);
        ctx.lineTo((x + 13.5) * sf, (y + 12) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 21) * sf);
        ctx.lineTo((x + 4) * sf, (y + 6) * sf);
        ctx.lineTo((x + 12) * sf, (y + 13.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12) * sf, (y + 21) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.fill();
        if (this.mainComposite == 0) {
          var t = accessPoint(this.x + 1, this.y, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
          var t = accessPoint(this.x, this.y + 1, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
        }
      } else if (this.direction == "left") {
        ctx.beginPath();
        ctx.moveTo(x * sf, y * sf);
        ctx.lineTo((x + 25) * sf, y * sf);
        ctx.lineTo((x + 25) * sf, (y + 25) * sf);
        ctx.stroke();




        ctx.fillStyle = "rgb(70, 5, 20)";
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 19) * sf, (y + 4) * sf);
        ctx.lineTo((x + 11.5) * sf, (y + 12) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 21) * sf);
        ctx.lineTo((x + 21) * sf, (y + 6) * sf);
        ctx.lineTo((x + 13) * sf, (y + 13.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 12) * sf);
        ctx.lineTo((x + 13) * sf, (y + 21) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.fill();
        if (this.mainComposite == 0) {
          var t = accessPoint(this.x - 1, this.y, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
          var t = accessPoint(this.x, this.y + 1, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
        }
      } else {
        ctx.beginPath();
        ctx.moveTo((x + 25) * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, y * sf);
        ctx.stroke();




        ctx.fillStyle = "rgb(70, 5, 20)";
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 21) * sf);
        ctx.lineTo((x + 6) * sf, (y + 21) * sf);
        ctx.lineTo((x + 13.5) * sf, (y + 13) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 19) * sf);
        ctx.lineTo((x + 12) * sf, (y + 11.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 4) * sf);
        ctx.fill();
        if (this.mainComposite == 0) {
          var t = accessPoint(this.x + 1, this.y, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
          var t = accessPoint(this.x, this.y - 1, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
        }
      }
    };
  } else if (this.type == "smelter output") {
    this.hasCompositeHealth = true;
    this.inventory = [];
    this.inventorySize = 2;
    this.isComposite = true;
    this.composite = [];
    this.mainComposite = 0;




    this.compositeTakeDamage = function(dmg) {
      if (this.mainComposite) {
        this.mainComposite.takeDamage(dmg);
      }
    };
    
    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(220, 150, 80)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.strokeStyle = "rgb(110, 75, 40)";
      ctx.lineWidth = 2 * sf;
      if (this.direction == "up") {
        ctx.beginPath();
        ctx.moveTo((x + 25) * sf, y * sf);
        ctx.lineTo((x + 25) * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, (y + 25) * sf);
        ctx.stroke();
        if (this.mainComposite == 0) {
          var t = accessPoint(this.x - 1, this.y - 1, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
        }
      } else if (this.direction == "down") {
        ctx.beginPath();
        ctx.moveTo(x * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, y * sf);
        ctx.lineTo((x + 25) * sf, y * sf);
        ctx.stroke();
        if (this.mainComposite == 0) {
          var t = accessPoint(this.x + 1, this.y + 1, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
        }
      } else if (this.direction == "left") {
        ctx.beginPath();
        ctx.moveTo(x * sf, y * sf);
        ctx.lineTo((x + 25) * sf, y * sf);
        ctx.lineTo((x + 25) * sf, (y + 25) * sf);
        ctx.stroke();
        if (this.mainComposite == 0) {
          var t = accessPoint(this.x - 1, this.y + 1, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
        }
      } else {
        ctx.beginPath();
        ctx.moveTo((x + 25) * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, y * sf);
        ctx.stroke();
        if (this.mainComposite == 0) {
          var t = accessPoint(this.x + 1, this.y - 1, this.level);
          if (t) {
            if (t.type == "smelter info") {
              this.mainComposite = t;
            }
          }
        }
      }
      ctx.fillStyle = "rgb(120, 120, 120)";
      ctx.beginPath();
      ctx.moveTo((x + 5) * sf, (y + 16) * sf);
      ctx.lineTo((x + 8) * sf, (y - 10) * sf);
      ctx.lineTo((x + 17) * sf, (y - 10) * sf);
      ctx.lineTo((x + 20) * sf, (y + 16) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(60, 35, 20)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 5) * sf, (y + 16) * sf);
      ctx.lineTo((x + 8) * sf, (y - 10) * sf);
      ctx.lineTo((x + 17) * sf, (y - 10) * sf);
      ctx.lineTo((x + 20) * sf, (y + 16) * sf);
      ctx.stroke();




      ctx.fillStyle = "rgb(20, 20, 20)";
      ctx.beginPath();
      ctx.ellipse((x + 12.5) * sf, (y - 10) * sf, 4.5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.ellipse((x + 12.5) * sf, (y - 10) * sf, 4.5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
      ctx.stroke();
    }
  } else if (this.type == "piercer") {
    this.health = 2;
    this.energy = 0;
    this.range = 6;
    this.inventory = [];
    this.inventorySize = 2;
    this.hasAction = true;
    this.hasEot = true;
    this.drawingAction = false;




    this.draw = function(x, y) {
      if (this.direction == "up") {
        ctx.fillStyle = "rgb(180, 180, 180)";
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 23) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 23) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(20, 30, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 8.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 16.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(200, 200, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 4) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 2) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 4) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 23) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(130, 230, 255)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 2) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 2) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(100, 130, 230)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.stroke();
      } else if (this.direction == "down") {
        ctx.fillStyle = "rgb(180, 180, 180)";
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 2) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 2) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(20, 30, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 8.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 20) * sf);
        ctx.lineTo((x + 2) * sf, (y + 17) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 16.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 20) * sf);
        ctx.lineTo((x + 23) * sf, (y + 17) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(200, 200, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 21) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.lineTo((x + 2) * sf, (y + 17) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 21) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.lineTo((x + 23) * sf, (y + 17) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(130, 230, 255)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 23) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 23) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(100, 130, 230)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.stroke();
      } else if (this.direction == "left") {
        ctx.fillStyle = "rgb(180, 180, 180)";
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 13) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 13) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(20, 30, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 8.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 5) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 16.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 5) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(200, 200, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(130, 230, 255)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 12) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 12) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(100, 130, 230)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.stroke();
      } else {
        ctx.fillStyle = "rgb(180, 180, 180)";
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 12) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 12) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(20, 30, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 8.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 20) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 16.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 20) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(200, 200, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(130, 230, 255)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 13) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 13) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(100, 130, 230)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.stroke();
      }
    };
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      for(var gong = 0; gong < this.inventory.length; gong ++) {
        if (this.inventory[gong] == "energy") {
          this.inventory.splice(gong, 1);
          this.energy ++;
          gong --;
        }
      }
    };
    this.eotDraw = function(x, y) {
      particles.push(new particle(x + ran(25), y + ran(25), 1 + ran(7), 3, {color: "rgba(255, 255, 0, " + (rand(1)) + ")", shape: "circle"}));
    };
    this.action = function() {
      if (this.energy >= 2) {
        this.energy -= 2;
        this.drawingAction = true;




        var hits = [];
        var chits = [];
        var ox = 0;
        var oy = 0;
        if (this.direction == "up") {
          oy = -1;
        } else if (this.direction == "down") {
          oy = 1;
        } else if (this.direction == "left") {
          ox = -1;
        } else {
          ox = 1;
        }
        for(var gong = 0; gong < this.range; gong ++) {
          var t = accessPoint(this.x + (ox * (gong + 1)), this.y + (oy * (gong + 1)), this.level);
          if (t) {
            if (t.hasCompositeHealth) {
              chits.push(t);
            } else if (t.health) {
              hits.push(t);
            }
          }
        }
        for(var gong = 0; gong < chits.length; gong ++) {
          chits[gong].compositeTakeDamage(1);
        }
        for(var gong = 0; gong < hits.length; gong ++) {
          hits[gong].takeDamage(1);
        }
      }
    };
    this.actionDraw = function(t, x, y) {
      if (this.drawingAction) {
        var a = 0;
        if (this.direction == "up") {
          a = Math.PI * -0.5;
        } else if (this.direction == "down") {
          a = Math.PI * 0.5;
        } else if (this.direction == "left") {
          a = Math.PI;
        }
        if (t < 30) {
          ctx.strokeStyle = "rgba(100, 160, 255, 0.7)";
          ctx.lineWidth = 2 * sf;
        } else {
          ctx.strokeStyle = "rgba(100, 160, 255, " + ((60 - t) / 30 * 0.7) + ")";
          ctx.lineWidth = ((60 - t) / 30 * 2) * sf;
        }
        if (t > 60) {
          this.drawingAction = false;
        }
        ctx.beginPath();
        ctx.moveTo((x + 12.5 + Math.cos(a) * 12.5) * sf, (y + 12.5 + Math.sin(a) * 12.5) * sf);
        ctx.lineTo((x + 12.5 + Math.cos(a) * (12.5 + 25 * this.range)) * sf, (y + 12.5 + Math.sin(a) * (12.5 + 25 * this.range)) * sf);
        ctx.stroke();
      }
    }
  } else if (this.type == "alpha ray") {
    this.health = 2;
    this.energy = 0;
    this.inventory = [];
    this.inventorySize = 2;
    this.hasEot = true;
    this.hasAction = true;
    this.drawingAction = false;
    this.range = 20;
    this.dist = 0;
    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(150, 0, 0)";
      var a = 0;
      if (this.direction == "up") {
        a = Math.PI * -0.5;
      } else if (this.direction == "down") {
        a = Math.PI * 0.5;
      } else if (this.direction == "left") {
        a = Math.PI;
      }
      ctx.beginPath();
      ctx.arc((x + 12.5 - Math.cos(a) * 1.5) * sf, (y + 12.5 - Math.sin(a) * 1.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(255, 50, 20)";
      ctx.font = (20 * sf) + "px Georgia";
      ctx.textAlign = "center";
      ctx.fillText("", (x + 12.5 - Math.cos(a) * 1.5) * sf, (y + 16.5 - Math.sin(a) * 1.5) * sf);




      ctx.fillStyle = "rgb(120, 120, 120)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 8 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 8 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 8 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 8 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 9.5 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 9.5 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 12 + Math.cos(a + Math.PI * -0.5) * 4) * sf, (y + 12.5 + Math.sin(a) * 12 + Math.sin(a + Math.PI * -0.5) * 4) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 13.5 + Math.cos(a + Math.PI * -0.5) * 1.5) * sf, (y + 12.5 + Math.sin(a) * 13.5 + Math.sin(a + Math.PI * -0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 11.5 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 11.5 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10 + Math.cos(a + Math.PI * -0.5) * 1) * sf, (y + 12.5 + Math.sin(a) * 10 + Math.sin(a + Math.PI * -0.5) * 1) * sf);
      ////////////////////////////////////////////////////////////////////
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10 + Math.cos(a + Math.PI * 0.5) * 1) * sf, (y + 12.5 + Math.sin(a) * 10 + Math.sin(a + Math.PI * 0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 11.5 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 11.5 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 13.5 + Math.cos(a + Math.PI * 0.5) * 1.5) * sf, (y + 12.5 + Math.sin(a) * 13.5 + Math.sin(a + Math.PI * 0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 12 + Math.cos(a + Math.PI * 0.5) * 4) * sf, (y + 12.5 + Math.sin(a) * 12 + Math.sin(a + Math.PI * 0.5) * 4) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 9.5 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 9.5 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.fill();
      ctx.fillStyle = "rgb(200, 0, 0)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 12) * sf, (y + 12.5 + Math.sin(a) * 12) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(250, 0, 0)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 14) * sf, (y + 12.5 + Math.sin(a) * 14) * sf, 1.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(255, 90, 50)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 16) * sf, (y + 12.5 + Math.sin(a) * 16) * sf, 1 * sf, 0, Math.PI * 2, false);
      ctx.fill();
    };
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      for(var gong = 0; gong < this.inventory.length; gong ++) {
        if (this.inventory[gong] == "energy") {
          this.inventory.splice(gong, 1);
          gong --;
          this.energy ++;
        }
      }
    }
    this.action = function() {
      if (this.energy >= 2) {
        this.energy -= 2;
        this.drawingAction = true;
        var ox = 0;
        var oy = 0;
        if (this.direction == "up") {
          oy = -1;
        } else if (this.direction == "down") {
          oy = 1;
        } else if (this.direction == "left") {
          ox = -1;
        } else {
          ox = 1;
        }
        this.dist = 0;
        for(var gong = 0; gong < this.range; gong ++) {
          var t = accessPoint(this.x + ((gong + 2) * ox), this.y + ((gong + 2) * oy), this.level);
          if (t) {
            t.takeDamage(2);
            break;
          }
        }
        this.dist = gong + 1;
      }
    };
    this.actionDraw = function(t, x, y, special) {
      if (this.drawingAction || special) {
        if (!this.dist) {
          var ox = 0;
          var oy = 0;
          if (this.direction == "up") {
            oy = -1;
          } else if (this.direction == "down") {
            oy = 1;
          } else if (this.direction == "left") {
            ox = -1;
          } else {
            ox = 1;
          }
          this.dist = this.range;
          for(var gong = 0; gong < this.range; gong ++) {
            var t = accessPoint(this.x + ((gong + 2) * ox), this.y + ((gong + 2) * oy), this.level);
            if (t) {
              this.dist = gong + 1;
              break;
            }
          }
        }
        if (ran(10) == 0) {
          console.log("t: " + t + ", x: " + x + ", y: " + y + ", special: " + special + ", this.dist: " + this.dist);
        }
        var a = 0;
        if (this.direction == "up") {
          a = Math.PI * -0.5;
        } else if (this.direction == "down") {
          a = Math.PI * 0.5;
        } else if (this.direction == "left") {
          a = Math.PI;
        }
        var alpha = 1;
        if (t > 60) {
          alpha = (120 - t) / 60;
        }
        console.log("alpha: " + alpha);
        if (t >= 120) {
          this.drawingAction = false;
        }
        ctx.strokeStyle = "rgba(255, 0, 0, " + alpha + ")";
        ctx.lineWidth = 2 * alpha * sf;
        ctx.beginPath();
        ctx.moveTo((x + 12.5 + Math.cos(a) * 12.5) * sf, (y + 12.5 + Math.sin(a) * 12.5) * sf);
        ctx.lineTo((x + 12.5 + Math.cos(a) * (12.5 + this.dist * 25)) * sf, (y + 12.5 + Math.sin(a) * (12.5 + this.dist * 25)) * sf);
        ctx.stroke();
        var points = this.dist * 8;
        console.log("points: " + points);
        ctx.strokeStyle = "rgba(255, 100, 0, " + alpha + ")";
        ctx.beginPath();
        for(var gong = 0; gong < points; gong ++) {
          var ao = gong * Math.PI * 0.25 - (t * Math.PI * 0.08);
          if (gong == 0) {
            ctx.moveTo((x + 12.5 + Math.cos(a) * (12.5 + gong * (25 / 8)) + Math.cos(a + Math.PI * 0.5) * Math.sin(ao) * 4) * sf, (y + 12.5 + Math.sin(a) * (12.5 + gong * (25 / 8)) + Math.sin(a + Math.PI * 0.5) * Math.sin(ao) * 4) * sf);
          } else {
            ctx.lineTo((x + 12.5 + Math.cos(a) * (12.5 + gong * (25 / 8)) + Math.cos(a + Math.PI * 0.5) * Math.sin(ao) * 4) * sf, (y + 12.5 + Math.sin(a) * (12.5 + gong * (25 / 8)) + Math.sin(a + Math.PI * 0.5) * Math.sin(ao) * 4) * sf);
          }
        }
        ctx.stroke();
        ctx.strokeStyle = "rgba(255, 255, 0, " + alpha + ")";
        ctx.beginPath();
        for(var gong = 0; gong < points; gong ++) {
          var ao = gong * Math.PI * 0.25 - (t * Math.PI * 0.08);
          if (gong == 0) {
            ctx.moveTo((x + 12.5 + Math.cos(a) * (12.5 + gong * (25 / 8)) + Math.cos(a + Math.PI * -0.5) * Math.sin(ao) * 4) * sf, (y + 12.5 + Math.sin(a) * (12.5 + gong * (25 / 8)) + Math.sin(a + Math.PI * -0.5) * Math.sin(ao) * 4) * sf);
          } else {
            ctx.lineTo((x + 12.5 + Math.cos(a) * (12.5 + gong * (25 / 8)) + Math.cos(a + Math.PI * -0.5) * Math.sin(ao) * 4) * sf, (y + 12.5 + Math.sin(a) * (12.5 + gong * (25 / 8)) + Math.sin(a + Math.PI * -0.5) * Math.sin(ao) * 4) * sf);
          }
        }
        ctx.stroke();
      }
    };
    this.eotDraw = function(x, y) {
      particles.push(new particle(x + ran(25), y + ran(25), 1 + ran(7), 3, {color: "rgba(255, 255, 0, " + (rand(1)) + ")", shape: "circle"}));
    }
  } else if (this.type == "mosquito") {
    this.health = 1;
    this.armed = false;
    this.inventory = [];
    this.inventorySize = 2;
    this.autoOutConfig = "right";
    this.canAutoOut = true;
    this.isAutoOut = false;
    this.hasEot = true;
    this.hasAction = true;
    this.offset = 0;
    this.offsetTimer = 0;
    this.flying = false;
    this.range = 12;
    this.flyDistance = 0;
    this.target = false;

    this.draw = function(x, y) {
      var a = 0;
      if (this.direction == "up") {
        a = Math.PI * -0.5;
      } else if (this.direction == "down") {
        a = Math.PI * 0.5;
      } else if (this.direction == "left") {
        a = Math.PI;
      }
      x += Math.cos(a) * this.offset;
      y += Math.sin(a) * this.offset;
      ctx.fillStyle = "rgb(200, 0, 0)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * -0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * -0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * 0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.5) * 8) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -10) * sf, (y + 12.5 + Math.sin(a) * -10) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(50, 50, 50)";
      ctx.lineWidth = 1 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * -0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * -0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * 0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.stroke();
      ctx.strokeStyle = "rgb(255, 255, 255)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -10) * sf, (y + 12.5 + Math.sin(a) * -10) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.stroke();




      ctx.fillStyle = "rgb(180, 180, 180)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(80, 80, 80)";
      ctx.lineWidth = 1.6 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.stroke();
      ctx.fillStyle = "rgb(80, 80, 80)";
      if (this.armed) {
        ctx.fillStyle = "rgb(200, 0, 0)";
      }
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10.5) * sf, (y + 12.5 + Math.sin(a) * 10.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10.5) * sf, (y + 12.5 + Math.sin(a) * 10.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.stroke();




      //flying!
      if (this.flying) {
        this.offsetTimer ++;
        if (this.offsetTimer <= 90) {
          this.offset = rand(4.9) - 2.5;
        } else {
          this.offset += Math.pow(2.5, (-90 + this.offsetTimer) / 30);
        }
        if (this.offset >= this.flyDistance) {
          if (this.target) {
            this.target.takeDamage(2);
          }
          this.die();
          for(var gong = 0; gong < 30; gong ++) {
            var na = rand(Math.PI * 2);
            var speed = 1 + rand(1.5);
            particles.push(new particle(x + 12.5 + Math.cos(na) * 12.5, y + 12.5 + Math.sin(na) * 12.5, 10 + ran(8), 30 + ran(15), {color: "rgba(0, 0, 0, " + (rand(0.4) + 0.25) + ")", shape: "circle", velocity: {mx: Math.cos(na) * speed, my: Math.sin(na) * speed}}));
            var na = rand(Math.PI * 2);
            var speed = 3 + rand(2.5);
            particles.push(new particle(x + 12.5 + Math.cos(na) * 12.5, y + 12.5 + Math.sin(na) * 12.5, 4 + ran(5), 20 + ran(10), {color: "rgba(255, " + ran(255) + ", 0, " + (rand(0.25) + 0.75) + ")", shape: "circle", velocity: {mx: Math.cos(na) * speed, my: Math.sin(na) * speed}}));
          }
        }
        var na = a + Math.PI * 0.65 + rand(Math.PI * 0.7);
        var speed = 1 + rand(1.5);
        particles.push(new particle(x + 12.5 + Math.cos(na) * 12.5, y + 12.5 + Math.sin(na) * 12.5, 10 + ran(8), 30 + ran(15), {color: "rgba(0, 0, 0, " + (rand(0.4) + 0.25) + ")", shape: "circle", velocity: {mx: Math.cos(na) * speed, my: Math.sin(na) * speed}}));
        var na = a + Math.PI * 0.75 + rand(Math.PI * 0.5);
        var speed = 3 + rand(2.5);
        particles.push(new particle(x + 12.5 + Math.cos(na) * 12.5, y + 12.5 + Math.sin(na) * 12.5, 4 + ran(5), 20 + ran(10), {color: "rgba(255, " + ran(255) + ", 0, " + (rand(0.25) + 0.75) + ")", shape: "circle", velocity: {mx: Math.cos(na) * speed, my: Math.sin(na) * speed}}));
      }
    };
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      for(var gong = 0; gong < this.inventory.length; gong++) {
        if (this.inventory[gong] == "energy") {
          this.armed = true;
          this.inventory.splice(gong, 1);
          break;
        }
      }
      if (this.isAutoOut && this.inventory.length > 0) {
        var t;
        if (this.autoOutConfig == "up") {
          t = accessPoint(this.x, this.y - 1, this.level);
        } else if (this.autoOutConfig == "left") {
          t = accessPoint(this.x - 1, this.y, this.level);
        } else if (this.autoOutConfig == "down") {
          t = accessPoint(this.x, this.y + 1, this.level);
        } else {
          t = accessPoint(this.x + 1, this.y, this.level);
        }
        if (t) {
          if (t.hasCompositeInventory) {
            var l = this.inventory.pop();
            if (!t.compositeInventoryPush(l)) {
              this.inventory.push(l);
            }
          } else if (t.inventory) {
            if (t.inventory.length < t.inventorySize) {
              var l = this.inventory.pop();
              t.inventory.push(l);
            }
          }
        }
      }
    };
    this.eotDraw = function(x, y) {
      particles.push(new particle(x + ran(25), y + ran(25), 1 + ran(7), 3, {color: "rgba(255, " + ran(255) + ", 0, " + (rand(1)) + ")", shape: "circle"}));
    };
    this.action = function() {
      if (this.armed) {
        this.flying = true;
        var ox = 0;
        var oy = 0;
        if (this.direction == "up") {
          oy = -1;
        } else if (this.direction == "down") {
          oy = 1;
        } else if (this.direction == "left") {
          ox = -1;
        } else {
          ox = 1;
        }
        for(var gong = 0; gong < this.range; gong ++) {
          var t = accessPoint(this.x + (ox * (gong + 1)), this.y + (oy * (gong + 1)), this.level);
          if (t) {
            console.log(gong);
            this.target = t;
            break;
          }
        }
        this.flyDistance = gong * 25 + 5;
      }
    }
    this.actionDraw = function(t, x, y) {
      //doing in draw function!!
    }
  } else if (this.type == "drill m battery") {
    this.isComposite = true;
    this.health = 1;
    this.inventory = [];
    this.inventorySize = 2;
    this.composite = [];
    this.compositeDeath = function() {
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    }

    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(220, 220, 170)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(20, 20, 20)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 3 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(80, 20, 20)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 1.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(80, 20, 20)";
      ctx.lineWidth = 3 * sf;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.stroke();
      var a = 0;
      if (this.direction == "up") {
        a = Math.PI * -0.5;
      } else if (this.direction == "down") {
        a = Math.PI * 0.5;
      } else if (this.direction == "left") {
        a = Math.PI;
      }
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 13) * sf, (y + 12.5 + Math.sin(a) * 13) * sf);
      ctx.stroke();
    };
  } else if (this.type == "drill m body") {
    this.health = 3;
    this.isComposite = true;
    this.inventory = [];
    this.inventorySize = 4;
    this.composite = [];
    this.compositeIndex = {
      c1: null,
      c2: null
    };
    this.drillAngleOffset = 0;
    this.energy = 0;
    this.hasEot = true;
    this.mode = 1;
    this.modeList = ["1 stone 1 gold", "3 stone", "1 alloy"];
    this.compositeDeath = function() {
      if (this.compositeIndex.c1) {
        this.compositeIndex.c1.die();
      }
      if (this.compositeIndex.c2) {
        this.compositeIndex.c2.die();
      }
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    }




    this.draw = function(x, y) {
      if (this.compositeIndex.c1 == null) {
        if (this.direction == "up") {
          var t = accessPoint(this.x, this.y - 1, this.level);
          if (t) {
            console.log(t.direction);
          }
        } else if (this.direction == "down") {
          var t = accessPoint(this.x, this.y + 1, this.level);
        } else if (this.direction == "left") {
          var t = accessPoint(this.x - 1, this.y, this.level);
        } else {
          var t = accessPoint(this.x + 1, this.y, this.level);
        }
        if (t) {
          if (t.type == "drill m battery") {
            this.compositeIndex.c1 = t;
          }
        }
      }
      if (this.compositeIndex.c2 == null) {
        if (this.direction == "up") {
          var t = accessPoint(this.x + 1, this.y, this.level);
          if (t) {
            console.log(t.direction);
          }
        } else if (this.direction == "down") {
          var t = accessPoint(this.x - 1, this.y, this.level);
        } else if (this.direction == "left") {
          var t = accessPoint(this.x, this.y - 1, this.level);
        } else {
          var t = accessPoint(this.x, this.y + 1, this.level);
        }
        if (t) {
          if (t.type == "drill m battery") {
            this.compositeIndex.c2 = t;
          }
        }
      }
      ctx.fillStyle = "rgb(190, 195, 175)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.fillStyle = "rgb(160, 170, 140)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(40, 40, 40)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.stroke();




      ctx.lineWidth = 1 * sf;
      ctx.strokeStyle = "rgb(20, 20, 20)";
      ctx.beginPath();
      var a = this.drillAngleOffset;
      for(var gong = 0; gong < 16; gong ++) {
        var interior = 10 + gong * -0.625;
        if (gong == 0) {
          ctx.moveTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        }
        ctx.lineTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        a += Math.PI * 0.25;
      }
      ctx.stroke();
      ctx.beginPath();
      var a = this.drillAngleOffset + Math.PI;
      for(var gong = 0; gong < 16; gong ++) {
        var interior = 10 + gong * -0.625;
        if (gong == 0) {
          ctx.moveTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        }
        ctx.lineTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        a += Math.PI * 0.25;
      }
      ctx.stroke();
    };




    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      if (this.compositeIndex.c1) {
        if (this.compositeIndex.c1.inventory.length > 0) {
          for(var gong = 0; gong < this.compositeIndex.c1.inventory.length; gong++) {
            if (this.compositeIndex.c1.inventory[gong] == "energy") {
              this.energy ++;
              this.compositeIndex.c1.inventory.splice(gong, 1);
              gong --;
            }
          }
        }
      }
      if (this.compositeIndex.c2) {
        if (this.compositeIndex.c2.inventory.length > 0) {
          for(var gong = 0; gong < this.compositeIndex.c2.inventory.length; gong++) {
            if (this.compositeIndex.c2.inventory[gong] == "energy") {
              this.energy ++;
              this.compositeIndex.c2.inventory.splice(gong, 1);
              gong --;
            }
          }
        }
      }
      if (this.energy >= 2) {
        this.energy -= 2;
        if (this.mode == 1) {
          if (this.inventory.length < this.inventorySize) {
            this.inventory.push("stone");
          }
          if (this.inventory.length < this.inventorySize) {
            this.inventory.push("gold");
          }
        } else if (this.mode == 2) {
          for(var gong = 0; gong < 3; gong ++) {
            if (this.inventory.length < this.inventorySize) {
              this.inventory.push("stone");
            }
          }
        } else {
          if (this.inventory.length < this.inventorySize) {
            this.inventory.push("alloy");
          }
        }
      }
    };
    this.eotDraw = function(x, y) {
      this.drillAngleOffset += Math.PI * rand(0.02) + Math.PI * 0.05;
    };
  } else if (this.type == "artillery") {
    this.health = 6; // 6
    this.inventory = ["alloy", "alloy", "alloy", "alloy"];
    this.inventorySize = 4;
    this.isComposite = true;
    this.hasAction = true;
    this.hasTargeting = true;
    this.targets = [];
    this.maxTargets = 0;
    this.shooting = false;
    this.shootWait = 0;
    this.compositeTakeDamage = function(dmg) {
      this.health -= dmg;
      if (this.health <= 0) {
        this.compositeDeath();
      }
    }
    this.compositeInventoryPush = function(item) {
      if (this.inventory.length < this.inventorySize) {
        this.inventory.push(item);
        return(true);
      }
      return(false);
    }
    this.compositeSiphon = function() {
      if (this.inventory.length > 0) {
        return(this.inventory.pop());
      }
      return(false);
    }
    this.compositeDeath = function() {
      var things = [accessPoint(this.x + 1, this.y, this.level), accessPoint(this.x + 1, this.y + 1, this.level), accessPoint(this.x, this.y + 1, this.level)];
      for(var gong = 0; gong < things.length; gong ++) {
        console.log(things[gong]);
        if (things[gong] != 0) {
          if (things[gong].type == "artillery pointer cardinal" || things[gong].type == "artillery pointer diagonal") {
            var t = getCoordsOnPlatform(things[gong].x, things[gong].y);
            t.platform.grid[t.x - 1][t.y - 1] = 0;
          }
        }
        var t = getCoordsOnPlatform(this.x, this.y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
    }
    this.draw = function(x, y) {
      this.maxTargets = 0;
      for(var gong = 0; gong < this.inventory.length; gong ++) {
        if (this.inventory[gong] == "alloy") {
          this.maxTargets ++;
        }
      }
      var sum = 0;
      for(var gong = 0; gong < this.targets.length; gong ++) {
        sum += this.targets[gong].a;
      }
      while(this.maxTargets < sum) {
        this.targets[this.targets.length - 1].a --;
        if (this.targets[this.targets.length - 1].a <= 0) {
          this.targets.pop();
        }
        sum --;
      }
      var sum = 0;
      for(var gong = 0; gong < this.targets.length; gong ++) {
        sum += this.targets[gong].a;
      }
      if (this.shooting) {
        if (this.maxTargets > 0 && this.targets.length > 0) {
          if (this.shootWait <= 0) {
            this.shootWait = 35;
            for(var gong = 0; gong < 30; gong ++) {
              var angle = Math.PI * -0.65 + rand(Math.PI * 0.3);
              var speed = 1.5 + rand(6);
              particles.push(new particle(x + 25, y - 10, 5 + rand(3), 10 + ran(30), {color: "rgb(255, " + ran(255) + ", 0)", shape: "circle", velocity: {mx: Math.cos(angle) * speed, my: Math.sin(angle) * speed}}));
            }
            console.log(this.targets[0])
            projs.push(new proj(0, 0, 2, "artillery shell", this.level, {finalX: this.targets[0].x + 1, finalY: this.targets[0].y + 1, height: -600, secondaryDmg: 1}));
            if (this.targets[0].a > 1) {
              this.targets[0].a --;
            } else {
              this.targets.splice(0, 1);
            }
            for(var gong = 0; gong < this.inventory.length; gong ++) {
              if (this.inventory[gong] == "alloy") {
                this.inventory.splice(gong, 1);
                break;
              }
            }
          }
          this.shootWait --;
        } else {
          this.shooting = false;
          console.log("yes very good");
          this.shootWait = 0;
        }
      }
      ctx.strokeStyle = "rgb(80, 80, 80)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 5) * sf);
      ctx.lineTo((x + 25) * sf, (y + 2) * sf);
      ctx.lineTo((x + 47) * sf, (y + 5) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 8) * sf, (y + 37) * sf);
      ctx.lineTo((x + 25) * sf, (y + 30) * sf);
      ctx.lineTo((x + 42) * sf, (y + 37) * sf);
      ctx.stroke();
      ctx.fillStyle = "rgb(100, 100, 100)";
      ctx.beginPath();
      ctx.moveTo((x + 13) * sf, (y + 25) * sf);
      ctx.lineTo((x + 20) * sf, (y + 37) * sf);
      ctx.lineTo((x + 20) * sf, (y + 45) * sf);
      ctx.lineTo((x + 30) * sf, (y + 45) * sf);
      ctx.lineTo((x + 30) * sf, (y + 37) * sf);
      ctx.lineTo((x + 37) * sf, (y + 25) * sf);
      ctx.lineTo((x + 30) * sf, (y - 10) * sf);
      ctx.lineTo((x + 20) * sf, (y - 10) * sf);
      ctx.fill();
      ctx.fillStyle = "rgb(60, 60, 60)";
      ctx.beginPath();
      ctx.moveTo((x + 20) * sf, (y - 10) * sf);
      ctx.lineTo((x + 25) * sf, (y - 10) * sf);
      ctx.lineTo((x + 13) * sf, (y + 25) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 30) * sf, (y - 10) * sf);
      ctx.lineTo((x + 25) * sf, (y - 10) * sf);
      ctx.lineTo((x + 37) * sf, (y + 25) * sf);
      ctx.fill();
      ctx.fillStyle = "rgb(40, 40, 40)";
      ctx.beginPath();
      ctx.ellipse((x + 25) * sf, (y - 10) * sf, 5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(60, 60, 60)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.ellipse((x + 25) * sf, (y - 10) * sf, 4.5 * sf, 2.5 * sf, 0, 0, Math.PI * 2, false);
      ctx.stroke();
      ctx.fillStyle = "rgb(75, 75, 75)";
      ctx.beginPath();
      ctx.moveTo((x + 18) * sf, (y + 25) * sf);
      ctx.lineTo((x + 32) * sf, (y + 25) * sf);
      ctx.lineTo((x + 27) * sf, (y + 8) * sf);
      ctx.lineTo((x + 23) * sf, (y + 8) * sf);
      ctx.fill();
      //wheels
      ctx.fillStyle = "rgb(130, 50, 0)";
      ctx.fillRect((x + 11) * sf, (y + 13) * sf, 4 * sf, 16 * sf);
      ctx.fillRect((x + 35) * sf, (y + 13) * sf, 4 * sf, 16 * sf);
      ctx.beginPath();
      ctx.arc((x + 13) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 13) * sf, (y + 29) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 37) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 37) * sf, (y + 29) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(60, 20, 0)";
      ctx.lineWidth = 1 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 11) * sf, (y + 13) * sf);
      ctx.lineTo((x + 11) * sf, (y + 29) * sf);
      ctx.arc((x + 13) * sf, (y + 29) * sf, 2 * sf, Math.PI, 0, true);
      ctx.lineTo((x + 15) * sf, (y + 13) * sf);
      ctx.arc((x + 13) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI, true);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 35) * sf, (y + 13) * sf);
      ctx.lineTo((x + 35) * sf, (y + 29) * sf);
      ctx.arc((x + 37) * sf, (y + 29) * sf, 2 * sf, Math.PI, 0, true);
      ctx.lineTo((x + 39) * sf, (y + 13) * sf);
      ctx.arc((x + 37) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI, true);
      ctx.stroke();
    };

    this.action = function() {
      this.shooting = true;
    }
    this.actionDraw = function(t, x, y) {

    };









  } else if (this.type == "artillery pointer cardinal") {
    this.isPointer = true;
    this.pointer = 0;
    this.isComposite = true;
    this.hasCompositeInventory = true;
    this.hasCompositeHealth = true;
    this.inventory = [];
    this.inventorySize = 3;
    this.compositeTakeDamage = function(dmg) {
      if (this.pointer) {
        this.pointer.compositeTakeDamage(dmg);
      }
    }
    this.compositeInventoryPush = function(item) {
      console.log("somethings happening")
      if (this.pointer) {
        console.log("somethings working")
        if (this.pointer.inventory.length < this.pointer.inventorySize) {
          console.log("should be good")
          this.pointer.inventory.push(item);
          return(true);
        }
      }
      return(false);
    }
    this.compositeSiphon = function() {
      if (this.pointer) {
        if (this.pointer.inventory.length > 0) {
          return(this.pointer.inventory.pop());
        }
      }
      return(false);
    }
    this.compositeDeath = function() {
      if (this.pointer) {
        this.pointer.compositeDeath();
      }
    }
    this.returnInventory = function() {
      if (this.pointer) {
        return(this.pointer.inventory);
      }
      return(false);
    }
    this.draw = function(x, y) {
      if (this.pointer == 0) {
        var t = accessPoint(this.x + 1, this.y, this.level);
        if (this.direction == "up") {
          var t = accessPoint(this.x, this.y - 1, this.level);
        } else if (this.direction == "down") {
          var t = accessPoint(this.x, this.y + 1, this.level);
        } else if (this.direction == "left") {
          var t = accessPoint(this.x - 1, this.y, this.level);
        }
        if (t) {
          if (t.type == "artillery") {
            this.pointer = t;
          }
        }
      }
    }
  } else if (this.type == "artillery pointer diagonal") {
    this.isPointer = true;
    this.pointer = 0;
    this.hasCompositeInventory = true;
    this.hasCompositeHealth = true;
    this.isComposite = true;
    this.inventory = [];
    this.inventorySize = 3;
    this.compositeTakeDamage = function(dmg) {
      if (this.pointer) {
        this.pointer.compositeTakeDamage(dmg);
      }
    }
    this.compositeInventoryPush = function(item) {
      if (this.pointer) {
        if (this.pointer.inventory.length < this.pointer.inventorySize) {
          this.pointer.inventory.push(item);
          return(true);
        }
      }
      return(false);
    }
    this.compositeSiphon = function() {
      if (this.pointer) {
        if (this.pointer.inventory.length > 0) {
          return(this.pointer.inventory.pop());
        }
      }
      return(false);
    }
    this.compositeDeath = function() {
      if (this.pointer) {
        this.pointer.compositeDeath();
      }
    }
    this.draw = function(x, y) {
      if (this.pointer == 0) {
        var t = accessPoint(this.x + 1, this.y - 1, this.level);
        if (this.direction == "up") {
          var t = accessPoint(this.x - 1, this.y - 1, this.level);
        } else if (this.direction == "down") {
          var t = accessPoint(this.x + 1, this.y + 1, this.level);
        } else if (this.direction == "left") {
          var t = accessPoint(this.x - 1, this.y + 1, this.level);
        }
        if (t) {
          if (t.type == "artillery") {
            this.pointer = t;
          }
        }
      }
    }
  } else if (this.type == "firing array bp") {
    this.health = 2;
    this.inventory = [];
    this.inventorySize = 4;
    this.hasAction = true;
    
    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(140, 230, 255)";
      ctx.fillRect((x + 2) * sf, (y + 2) * sf, 21 * sf, 21 * sf);
    }

    this.action = function() {
      console.log("x: " + this.x + ", y: " + this.y);
      var stone = 0;
      for(var gong = 0; gong < this.inventory.length; gong ++) {
        if (this.inventory[gong] == "stone") {
          stone ++;
        }
      }
      if (stone >= 4) {
        var xo = 0;
        var yo = 0;
        var axo = 0;
        var ayo = 0;
        if (this.direction == "up") {
          yo = -1;
          axo = 1;
        } else if (this.direction == "down") {
          yo = 1;
          axo = -1;
        } else if (this.direction == "left") {
          xo = -1;
          ayo = 1;
        } else {
          xo = 1;
          ayo = -1;
        }
        for(var gong = 0; gong < 5; gong ++) {
          if (gong == 0 || gong == 2 || gong == 4) {
            var type = "alpha ray";
          } else if (gong == 1 || gong == 3) {
            var type = "chipper";
          }
          var x = this.x - (2 * axo) + xo + (gong * axo);
          var y = this.y - (2 * ayo) + yo + (gong * ayo);
          console.log("x: " + x + ", y: " + y);
          var selectedPlatform = getPlatform(x, y)
          var px = getCoordsOnPlatform(x, y).x;
          var py = getCoordsOnPlatform(x, y).y;
          if (accessPoint(x, y) == 0) {
            var p = new piece(x, y, type, 1, this.direction, this.player, "main");
            p.energy += 2;
            selectedPlatform.grid[px - 1][py - 1] = p;
            for(var song = 0; song < this.inventory.length; song ++) {
              if (this.inventory[song] == "stone") {
                this.inventory.splice(song, 1);
                break;
              }
            }
          }
        }
      }
    }
    
    this.actionDraw = function() {

    };
  } else if (this.type == "passive healer") {
    this.health = 2;
    this.hasAction = true;
    this.hasEot = true;
    this.eotcycle = 1;

    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(200, 200, 200)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.stroke();
      ctx.strokeStyle = "rgb(255, 0, 0)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 7) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 18) * sf);
      ctx.moveTo((x + 7) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 18) * sf, (y + 12.5) * sf);
      ctx.stroke();
    };

    this.action = function() {
      if (this.eotcycle == 0) {
        var targets = [accessPoint(this.x - 1, this.y - 1), accessPoint(this.x - 1, this.y), accessPoint(this.x - 1, this.y + 1), accessPoint(this.x, this.y + 1), accessPoint(this.x + 1, this.y + 1), accessPoint(this.x + 1, this.y), accessPoint(this.x + 1, this.y - 1), accessPoint(this.x, this.y - 1)];
        for(var gong = 0; gong < targets.length; gong ++) {
          if (targets[gong]) {
            targets[gong].takeDamage(-1);
          }
        }
        this.eotcycle = 2;
      }
    }
    this.actionDraw = function(t, x, y) {
      if (t < 45) {
        var alpha = t / 67.5;
      } else if (t < 90) {
        var alpha = 0.666;
      } else {
        var alpha = (135 - t) / 67.5;
      }
      var g = ctx.createRadialGradient((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, (x + 12.5) * sf, (y + 12.5) * sf, 50 * sf);
      g.addColorStop(0, "rgba(0, 200, 0, 0)");
      g.addColorStop(0.5, "rgba(0, 200, 0," + alpha + ")");
      g.addColorStop(1, "rgba(0, 200, 0, 0)");
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 50 * sf, 0, Math.PI * 2, false);
      ctx.fill();
    };
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      if (this.eotcycle > 0) {
        this.eotcycle --;
      }
    };
    this.eotDraw = function(x, y) {

    };
  } else if (this.type == "alloy healer") {
    this.health = 1;
    this.hasEot = true;
    this.autoOutConfig = "right";
    this.isAutoOut = false;
    this.canAutoOut = true;
    this.inventory = [];
    this.inventorySize = 2;

    this.draw = function(x, y) {
      ctx.fillStyle = "rgb(130, 130, 130)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 22) * sf);
      ctx.lineTo((x + 3) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 22) * sf);
      ctx.lineTo((x + 3) * sf, (y + 12.5) * sf);
      ctx.stroke();
      ctx.strokeStyle = "rgb(255, 0, 0)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 7) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 18) * sf);
      ctx.moveTo((x + 7) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 18) * sf, (y + 12.5) * sf);
      ctx.stroke();
    };
    this.hasDoneEot = false;
    this.eot = function() {
      this.hasDoneEot = true;
      if (this.isAutoOut && this.inventory.length > 0) {
        var t;
        if (this.autoOutConfig == "up") {
          t = accessPoint(this.x, this.y - 1, this.level);
        } else if (this.autoOutConfig == "left") {
          t = accessPoint(this.x - 1, this.y, this.level);
        } else if (this.autoOutConfig == "down") {
          t = accessPoint(this.x, this.y + 1, this.level);
        } else {
          t = accessPoint(this.x + 1, this.y, this.level);
        }
        if (t) {
          if (t.hasCompositeInventory) {
            var l = this.inventory.pop();
            if (l == "alloy") {
              this.healAll();
            }
            if (!t.compositeInventoryPush(l)) {
              this.inventory.push(l);
            }
          } else if (t.inventory) {
            if (t.inventory.length < t.inventorySize) {
              var l = this.inventory.pop();
              if (l == "alloy") {
                this.healAll();
              }
              t.inventory.push(l);
            }
          }
        }
      }
    };
    this.healAll = function() {
      var targets = [accessPoint(this.x - 1, this.y - 1), accessPoint(this.x - 1, this.y), accessPoint(this.x - 1, this.y + 1), accessPoint(this.x, this.y + 1), accessPoint(this.x + 1, this.y + 1), accessPoint(this.x + 1, this.y), accessPoint(this.x + 1, this.y - 1), accessPoint(this.x, this.y - 1)];
      for(var gong = 0; gong < targets.length; gong ++) {
        if (targets[gong]) {
          targets[gong].takeDamage(-1);
        }
      }
    };
    this.eotDraw = function(x, y) {

    };
  } else if (this.type == "woodcutter body") {
    this.isComposite = true;
    this.hasCompositeHealth = true;
    this.hasCompositeInventory = false;
    this.composite = [];
    this.inventory = [];
    this.inventorySize = 2;

    this.compositeTakeDamage = function(dmg) {
      if (this.composite.length > 0) {
        this.composite[0].takeDamage(dmg);
      }
    };
    //Mark: hehe done :3
    this.returnInventory = function() {
      return(this.inventory)
    };
    this.compositeSiphon = function() {
      if (this.inventory.length > 0) {
        return(this.inventory.pop());
      }
      if (this.composite.length > 0) {
        if (this.composite[0].inventory.length > 0) {
          return(this.composite[0].inventory.pop());
        }
      }
      return(false);
    };
    this.compositeDeath = function() {
      if (this.composite.length) {
        var t = getCoordsOnPlatform(this.composite[0].x, this.composite[0].y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    };

    this.draw = function(x, y) {
      if (this.composite.length == 0) {
        var t = accessPoint(this.x - 1, this.y);
        if (this.direction == "up") {
          t = accessPoint(this.x, this.y + 1);
        } else if (this.direction == "down") {
          t = accessPoint(this.x, this.y - 1);
        } else if (this.direction == "left") {
          t = accessPoint(this.x - 1, this.y);
        }

        if (t) {
          if (t.type == "woodcutter saw") {
            this.composite.push(t);
          }
        }
      }
      ctx.fillStyle = "rgb(200, 10, 5)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.strokeStyle = "rgb(100, 5, 2.5)";
      ctx.lineWidth = 1.5 * sf;
      var a = 0;
      if (this.direction == "up") {
        a = Math.PI * -0.5;
      } else if (this.direction == "down") {
        a = Math.PI * 0.5;
      } else if (this.direction == "left") {
        a = Math.PI;
      }
      var val = Math.sqrt(2);
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a + Math.PI * 0.25) * 12.5 * val) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.25) * 12.5 * val) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * 0.75) * 12.5 * val) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.75) * 12.5 * val) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * -0.75) * 12.5 * val) * sf, (y + 12.5 + Math.sin(a + Math.PI * -0.75) * 12.5 * val) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * -0.25) * 12.5 * val) * sf, (y + 12.5 + Math.sin(a + Math.PI * -0.25) * 12.5 * val) * sf);
      ctx.stroke();

      ctx.fillStyle = "rgb(160, 160, 160)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 7 + Math.cos(a + Math.PI * 0.5) * 7) * sf, (y + 12.5 + Math.sin(a) * 7 + Math.sin(a + Math.PI * 0.5) * 7) * sf, 3 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a + Math.PI * 0.5) * 7) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.5) * 7) * sf, 3 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * -7 + Math.cos(a + Math.PI * 0.5) * 7) * sf, (y + 12.5 + Math.sin(a) * -7 + Math.sin(a + Math.PI * 0.5) * 7) * sf, 3 * sf, 0, Math.PI * 2, false);
      ctx.fill();

      ctx.fillStyle = "rgb(255, 40, 40)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 7 + Math.cos(a + Math.PI * 0.5) * 7) * sf, (y + 12.5 + Math.sin(a) * 7 + Math.sin(a + Math.PI * 0.5) * 7) * sf, 1.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(40, 255, 40)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a + Math.PI * 0.5) * 7) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.5) * 7) * sf, 1.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(40, 255, 40)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * -7 + Math.cos(a + Math.PI * 0.5) * 7) * sf, (y + 12.5 + Math.sin(a) * -7 + Math.sin(a + Math.PI * 0.5) * 7) * sf, 1.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();

    };


  } else if (this.type == "woodcutter saw") {
    this.health = 4;
    this.isComposite = true;
    this.hasCompositeHealth = true;
    this.hasCompositeInventory = false;
    this.composite = [];
    this.inventory = [];
    this.inventorySize = 4;
    this.energy = 0;
    this.hasAction = true;
    this.animOffset = 0;



    this.compositeTakeDamage = function(dmg) {
      this.health -= dmg;
      if (this.health <= 0) {
        this.compositeDeath();
      }
    };
    //Mark: hehe done :3
    this.returnInventory = function() {
      return(this.inventory)
    };
    this.compositeSiphon = function() {
      if (this.inventory.length > 0) {
        return(this.inventory.pop());
      }
      if (this.composite.length > 0) {
        if (this.composite[0].inventory.length > 0) {
          return(this.composite[0].inventory.pop());
        }
      }
      return(false);
    };
    this.compositeDeath = function() {
      if (this.composite.length) {
        var t = getCoordsOnPlatform(this.composite[0].x, this.composite[0].y);
        t.platform.grid[t.x - 1][t.y - 1] = 0;
      }
      var t = getCoordsOnPlatform(this.x, this.y);
      t.platform.grid[t.x - 1][t.y - 1] = 0;
    };

    this.draw = function(x, y) {
      this.animOffset += 0.2;
      if (this.animOffset >= 5) {
        this.animOffset = 0;
      }
      if (this.composite.length == 0) {
        var t = accessPoint(this.x - 1, this.y);
        if (this.direction == "up") {
          t = accessPoint(this.x, this.y + 1);
        } else if (this.direction == "down") {
          t = accessPoint(this.x, this.y - 1);
        } else if (this.direction == "left") {
          t = accessPoint(this.x - 1, this.y);
        }

        if (t) {
          if (t.type == "woodcutter body") {
            this.composite.push(t);
          }
        }
      }
      var xo = 0;
      var yo = 0;
      var xm = 0;
      var ym = 0;
      if (this.direction == "up") {
        yo = 4;
        xm = 7.5;
      } else if (this.direction == "down") {
        yo = -4;
        xm = 7.5;
      } else if (this.direction == "left") {
        xo = 4;
        ym = 7.5;
      } else {
        xo = -4;
        ym = 7.5;
      }
      var r = 10;
      var a = 0;
      if (this.direction == "up") {
        a = Math.PI * -0.5;
      } else if (this.direction == "down") {
        a = Math.PI * 0.5;
      } else if (this.direction == "left") {
        a = Math.PI;
      }

      ctx.strokeStyle = "rgb(140, 140, 140)";
      ctx.lineWidth = r * 2 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -12.5) * sf, (y + 12.5 + Math.sin(a) * -12.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333)) * sf, (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333)) * sf);
      ctx.stroke();

      ctx.fillStyle = "rgb(140, 140, 140)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333)) * sf, (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333)) * sf, r * sf, 0, Math.PI * 2, false);
      ctx.fill();

      ctx.strokeStyle = "rgb(80, 80, 80)";
      ctx.lineWidth = r / 6 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -12.5 + Math.cos(a + Math.PI * 0.5) * r) * sf, (y + 12.5 + Math.sin(a) * -12.5 + Math.sin(a + Math.PI * 0.5) * r) * sf);
      ctx.arc((x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333)) * sf, (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333)) * sf, r * sf, Math.PI * 0.5 + a, Math.PI * 1.5 + a, true);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -12.5 + Math.cos(a + Math.PI * -0.5) * r) * sf, (y + 12.5 + Math.sin(a) * -12.5 + Math.sin(a + Math.PI * -0.5) * r) * sf);
      ctx.stroke();

      ctx.strokeStyle = "rgb(190, 190, 190)";
      ctx.lineWidth = r * 0.21 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -12.5 + Math.cos(a + Math.PI * 0.5) * (r * 0.72)) * sf, (y + 12.5 + Math.sin(a) * -12.5 + Math.sin(a + Math.PI * 0.5) * (r * 0.72)) * sf);
      ctx.arc((x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333)) * sf, (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333)) * sf, r * 0.72 * sf, Math.PI * 0.5 + a, Math.PI * 1.5 + a, true);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -12.5 + Math.cos(a + Math.PI * -0.5) * (r * 0.72)) * sf, (y + 12.5 + Math.sin(a) * -12.5 + Math.sin(a + Math.PI * -0.5) * (r * 0.72)) * sf);
      ctx.stroke();

      ctx.fillStyle = "rgb(80, 80, 80)";
      ctx.beginPath();
      var an = this.animOffset / 5 * Math.PI;
      for(var gong = 0; gong < 6; gong ++) {
        if (gong == 0) {
          ctx.moveTo((x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333) + Math.cos(an) * (r * 0.25)) * sf, (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333) + Math.sin(an) * (r * 0.25)) * sf);
        }
        ctx.lineTo((x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333) + Math.cos(an) * (r * 0.25)) * sf, (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333) + Math.sin(an) * (r * 0.25)) * sf);
        an += Math.PI * 0.3333;
      }
      ctx.fill();

      ctx.beginPath();
      var an = this.animOffset / 5 * Math.PI;
      for(var gong = 0; gong < 8; gong ++) {
        if (gong == 0) {
          ctx.moveTo((x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333) + Math.cos(an) * (r * 0.25)) * sf, (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333) + Math.sin(an) * (r * 0.25)) * sf);
        }
        ctx.lineTo((x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333) + Math.cos(an) * (r * 0.25)) * sf, (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333) + Math.sin(an) * (r * 0.25)) * sf);
        an += Math.PI * 0.3333;
      }
      ctx.stroke();

      var spikes = [{x: (x + 12.5 + Math.cos(a + Math.PI * 0.5) * r + Math.cos(a) * (-12.5 + (Math.PI * r * 0.333) * this.animOffset / 5)), y: (y + 12.5 + Math.sin(a + Math.PI * 0.5) * r + Math.sin(a) * (-12.5 + (Math.PI * r * 0.333) * this.animOffset / 5)), a: a + Math.PI * 0.5},
      {x: (x + 12.5 + Math.cos(a - Math.PI * 0.5) * r + Math.cos(a) * (-12.5 + (Math.PI * r * 0.333) * (5 - this.animOffset) / 5)), y: (y + 12.5 + Math.sin(a - Math.PI * 0.5) * r + Math.sin(a) * (-12.5 + (Math.PI * r * 0.333) * (5 - this.animOffset) / 5)), a: a - Math.PI * 0.5},
      {x: (x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333) + Math.cos(Math.PI / -15 * this.animOffset + a + Math.PI * 0.5) * r), y: (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333) + Math.sin(Math.PI / -15 * this.animOffset + a + Math.PI * 0.5) * r), a: Math.PI / -15 * this.animOffset + a + Math.PI * 0.5},
      {x: (x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333) + Math.cos(Math.PI / -15 * (this.animOffset + 5) + a + Math.PI * 0.5) * r), y: (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333) + Math.sin(Math.PI / -15 * (this.animOffset + 5) + a + Math.PI * 0.5) * r), a: Math.PI / -15 * (this.animOffset + 5) + a + Math.PI * 0.5},
      {x: (x + 12.5 + Math.cos(a) * (-12.5 + Math.PI * r * 0.333) + Math.cos(Math.PI / -15 * (this.animOffset + 10) + a + Math.PI * 0.5) * r), y: (y + 12.5 + Math.sin(a) * (-12.5 + Math.PI * r * 0.333) + Math.sin(Math.PI / -15 * (this.animOffset + 10) + a + Math.PI * 0.5) * r), a: Math.PI / -15 * (this.animOffset + 10) + a + Math.PI * 0.5}
      ];

      /*ctx.fillStyle = "rgb(255, 200, 200)";
      ctx.beginPath();
      ctx.arc(spikes[2].x * sf, spikes[2].y * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((spikes[2].x + Math.cos(spikes[2].a) * 30) * sf, (spikes[2].y + Math.sin(spikes[2].a) * 30) * sf, 50 * sf, 0, Math.PI * 2, false);
      ctx.fill();*/
      
      for(var gong = 0; gong < spikes.length; gong ++) {
        ctx.fillStyle = "rgb(130, 130, 130)";
        ctx.beginPath();
        ctx.moveTo((spikes[gong].x + Math.cos(spikes[gong].a + Math.PI * 0.5) * (r / 4)) * sf, (spikes[gong].y + Math.sin(spikes[gong].a + Math.PI * 0.5) * (r / 4)) * sf);
        ctx.lineTo((spikes[gong].x + Math.cos(spikes[gong].a) * (r / 3)) * sf, (spikes[gong].y + Math.sin(spikes[gong].a) * (r / 3)) * sf);
        ctx.lineTo((spikes[gong].x + Math.cos(spikes[gong].a - Math.PI * 0.5) * (r / 4)) * sf, (spikes[gong].y + Math.sin(spikes[gong].a - Math.PI * 0.5) * (r / 4)) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(80, 80, 80)";
        ctx.lineWidth = r / 6 * sf;
        ctx.beginPath();
        ctx.moveTo((spikes[gong].x + Math.cos(spikes[gong].a + Math.PI * 0.5) * (r / 4)) * sf, (spikes[gong].y + Math.sin(spikes[gong].a + Math.PI * 0.5) * (r / 4)) * sf);
        ctx.lineTo((spikes[gong].x + Math.cos(spikes[gong].a) * (r / 3)) * sf, (spikes[gong].y + Math.sin(spikes[gong].a) * (r / 3)) * sf);
        ctx.lineTo((spikes[gong].x + Math.cos(spikes[gong].a - Math.PI * 0.5) * (r / 4)) * sf, (spikes[gong].y + Math.sin(spikes[gong].a - Math.PI * 0.5) * (r / 4)) * sf);
        ctx.stroke();
      }
    }
  }
















};




piece.prototype.takeDamage = function(dmg) {
  console.log("this.type: " + this.type)
  this.hasBeenDamaged = true;
  if (this.hasCompositeHealth) {
    console.log("holy fuck");
    this.compositeTakeDamage(dmg);
  } else if (this.health) {
    this.health -= dmg;
    if (this.health <= 0) {
      console.log("death!")
      this.die();
    }
  }
};




piece.prototype.die = function() {
  if (this.isComposite) {
    this.compositeDeath();
  } else {
    var r = getCoordsOnPlatform(this.x, this.y);
    // console.log("x: " + r.x + ", y: " + r.y);
    // console.log("this.x: " + this.x + ", this.y: " + this.y);
    // console.log(r.platform.grid[r.x][r.y])
    r.platform.grid[r.x - 1][r.y - 1] = 0;
  }
};

var projs = [];
var proj = function(x, y, dmg, type, level, other) {
  this.x = x;
  this.y = y;
  this.dmg = dmg;
  this.type = type;
  this.level = level;
  if (other.height != undefined) {
    this.height = other.height;
  }
  if (other.secondaryDmg != undefined) {
    this.secondaryDmg = other.secondaryDmg;
  }
  if (other.finalX != undefined) {
    this.finalX = other.finalX;
  }
  if (other.finalY != undefined) {
    this.finalY = other.finalY;
  }

  if (this.type == "artillery shell") {
    this.draw = function() {
      this.height += 8;
      ctx.fillStyle = "rgb(50, 50, 50)";
      ctx.beginPath();
      ctx.arc((this.finalX * 25 - 12.5) * sf, (this.finalY * 25 - 12.5 + this.height) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.fill();

      if (this.height >= 0) {
        this.impact();
      }
    }
    this.impact = function() {
      //damaging
      var t = accessPoint(this.finalX, this.finalY, this.level);
      var ts = [accessPoint(this.finalX - 1, this.finalY, this.level), accessPoint(this.finalX, this.finalY - 1, this.level), accessPoint(this.finalX + 1, this.finalY, this.level), accessPoint(this.finalX, this.finalY + 1, this.level)];
      var hasHitBase = false;
      if (t) {
        if (t.isBase) {
          hasHitBase = true;
          t.takeDamage(1);
        } else {
          t.takeDamage(this.dmg);
        }
      }
      for (var gilb = 0; gilb < ts.length; gilb ++) {
        if (ts[gilb]) {
          if (ts[gilb].isBase) {
            if (!hasHitBase) {
              hasHitBase = true;
              ts[gilb].takeDamage(1);
            }
          } else {
            ts[gilb].takeDamage(this.secondaryDmg);
          }
        }
      }
      //drawing
      for(var gilb = 0; gilb < 30; gilb ++) {
        var angle = rand(Math.PI * 2);
        var speed = 2 + rand(2);
        var color = "rgba(0, 0, 0, " + (0.25 + rand(0.65)) + ")";
        particles.push(new particle(this.finalX * 25 - 12.5, this.finalY * 25 - 12.5, 8 + rand(8), 45 + ran(10), {velocity: {mx: Math.cos(angle) * speed, my: Math.sin(angle) * speed}, color: color, shape: "circle"}));
        //particles.push(new particle(this.finalX * 25 + 12.5 + Math.cos(angle) * 6, this.finalY * 25 + 12.5 + Math.cos(angle) * 6, 8, 45, {shape: "circle", color: color, velocity: {mx: Math.cos(altAngle) * 4, my: Math.sin(altAngle) * 4}}))
      }
      for(var gilb = 0; gilb < 30; gilb ++) {
        var angle = rand(Math.PI * 2);
        var speed = 3 + rand(4);
        var color = "rgb(255, " + ran(255) + ", 0)";
        particles.push(new particle(this.finalX * 25 - 12.5, this.finalY * 25 - 12.5, 6 + rand(5), 45 + ran(10), {velocity: {mx: Math.cos(angle) * speed, my: Math.sin(angle) * speed}, color: color, shape: "circle"}));
      }
      this.die();
    }
  }
};

proj.prototype.die = function() {
  projs.splice(projs.indexOf(this), 1);
};




//Mark: end turn




//var timeBetweenActions = 30;
var currentAction = 0;




var isPicking = false;
var pickOptions = [];
var pickOptionsPointer = 0;




var pickRandomInArray = function(array, amount) {
  var newArr = [];
  var track = 0;
  while (track < amount) {
    var a = array[ran(array.length)];
    var same = false;
    for(var dingus = 0; dingus < newArr.length; dingus++) {
      if (newArr[dingus] == a) {
        same = true;
      }
    }
    if (!same) {
      track ++;
      newArr.push(a);
    }
  }
  return(newArr);
};




var removeAllFromArray = function(array, thing) {
  var newArray = array;
  for(var splorgus = 0; splorgus < newArray.length; splorgus ++) {
    if (newArray[splorgus] == thing) {
      newArray.splice(splorgus, 1);
      splorgus --;
    }
  }
  return newArray;
};
var drawSequence = function() {
  if (eotSequence.length > 0) {
    var index = eotSequence[currentAction]
	  index.eotDraw((index.x - 1) * 25, (index.y - 1) * 25);
    if (md) {
      md = false;
      index.eot();
      if (currentAction + 1 < eotSequence.length) {
        currentAction ++;
      } else {
        mode = "none";
      }
    }
  } else {
    mode = "sequencing";
  }
}
var endTurn = function() {
  itemSelected = 1;
  rotPieces = [];
  if (activePlayer == 1) {
    activePlayer = 2;
    p2.scrap += 30;
    if (p2.rotationsLeft != undefined) {
      p2.rotationsLeft = 2;
    }
  } else {
    activePlayer = 1;
    p1.scrap += 30;
    turn ++;




    if (p1.rotationsLeft != undefined) {
      p1.rotationsLeft = 2;
    }




        //do all start of turn checks here!
        if (turn == 2) {
          p1.abilities.push("rotate");
          p1.rotations = 2;
          p2.abilities.push("rotate");
          p2.rotations = 2;
        }
        if (turn == 3) {
          if (ran(2) == 0) {
            platforms[0].grid[0][3] = new piece(9, 7, "gold", 1, "up", "resource", "main");
            platforms[0].grid[7][4] = new piece(16, 8, "gold", 1, "up", "resource", "main");
          } else {
            platforms[0].grid[0][4] = new piece(9, 8, "gold", 1, "up", "resource", "main");
            platforms[0].grid[7][3] = new piece(16, 7, "gold", 1, "up", "resource", "main");
          }
        }
        if (turn == 4) {
          p1.abilities.push("move");
          p2.abilities.push("move");
        }
        if (turn == 6) {
          p1.abilities.push("demolish");
          p2.abilities.push("demolish");
        }
      }
      if (activePlayer == 1) {
        var p = p1;
      } else {
        var p = p2;
      }
      if (turn == 3) {
        pickOptions = pickRandomInArray(p.t1pool.eco, 2);
        pickOptionsPointer = p.t1pool.eco;
        p.shopPool.push("jumper");
        isPicking = true;
      }
      if (turn == 4) {
        pickOptions = pickRandomInArray(p.t1pool.weapon, 2);
        pickOptionsPointer = p.t1pool.weapon;
        isPicking = true;
      }
      if (turn == 5) {
        pickOptions = pickRandomInArray(p.t1pool.eco, 2);
        pickOptionsPointer = p.t1pool.eco;
        p.shopPool.push("passive healer");
        p.shopPool.push("alloy healer");
        isPicking = true;
      }
      if (turn == 6) {
        pickOptions = pickRandomInArray(p.t1pool.weapon, 2);
        pickOptionsPointer = p.t1pool.weapon;
        p.shopPool.push("firing array bp");
        isPicking = true;
      }
      if (turn == 7) {
        pickOptions = pickRandomInArray(p.t2pool.weapon, 3);
        pickOptionsPointer = p.t2pool.weapon;
        isPicking = true;
      }
      if (turn == 8) {
        pickOptions = pickRandomInArray(p.t2pool.eco, 1);
        pickOptionsPointer = p.t2pool.eco;
        isPicking = true;
      }
      if (turn == 9) {
        pickOptions = pickRandomInArray(p.t2pool.weapon, 2);
        pickOptionsPointer = p.t2pool.weapon;
        isPicking = true;
      }
      eotSequence = [];
      currentSequence = [];
      mode = "none";
      for(var i = 0; i < platforms.length; i++) {
        for(var j = 0; j < platforms[i].grid.length; j++) {
          for(var k = 0; k < platforms[i].grid[0].length; k++) {
            if (platforms[i].grid[j][k]) {
              if (platforms[i].grid[j][k].hasEot) {
                platforms[i].grid[j][k].hasDoneEot = false;
              }
              if (platforms[i].grid[j][k].player == activePlayer && platforms[i].grid[j][k].isRepackaging) {
                var found = false;
                for(var l = 0; l < p.items.length; l++) {
                  if (p.items[l].item == platforms[i].grid[j][k].type) {
                    found = true;
                    p.items[l].amount ++;
                    break;
                  }
                }
                if (!found) {
                  p.items.push({item: platforms[i].grid[j][k].type, amount: 1});
                }
                platforms[i].grid[j][k] = 0;
              }
            }
          }
        }
      }
}




var ghost = function(x, y, type, variant, rotation) {
	var drawArrow = function(ox, oy, angle) {
  	ctx.fillStyle = "rgba(255, 255, 0, 0.4)"
  	ctx.beginPath();
    ctx.moveTo((x + 12.5 + ox + (Math.cos(angle) * 8)) * sf, (y + 12.5 + oy + (Math.sin(angle) * 8)) * sf)
   	ctx.lineTo((x + 12.5 + ox + (Math.cos(angle + Math.PI * 2 / 3) * 8)) * sf, (y + 12.5 + oy + (Math.sin(angle + Math.PI * 2 / 3) * 8)) * sf)
    ctx.lineTo((x + 12.5 + ox + (Math.cos(angle + Math.PI * 2 / 1.5) * 8)) * sf, (y + 12.5 + oy + (Math.sin(angle + Math.PI * 2 / 1.5) * 8)) * sf);
    ctx.fill()
  };
	if (type == "pipe") {
  	// right, down, left, up. 1 = input, 2 = output, 0 = nothing.
  	var pipeConfig = [0, 0, 0, 0]
  	if (variant == 1) {
    	if (rotation == "up") {
  			pipeConfig = [0, 1, 0, 2]
    	} else if (rotation == "down") {
    		pipeConfig = [0, 2, 0, 1]
    	} else if (rotation == "left") {
    		pipeConfig = [1, 0, 2, 0]
    	} else if (rotation == "right") {
    		pipeConfig = [2, 0, 1, 0]
    	}
  	} else if (variant == 2) {
    	if (rotation == "up") {
  			pipeConfig = [0, 1, 2, 0]
    	} else if (rotation == "down") {
    		pipeConfig = [2, 0, 0, 1]
    	} else if (rotation == "left") {
    		pipeConfig = [1, 2, 0, 0]
    	} else if (rotation == "right") {
    		pipeConfig = [0, 0, 1, 2]
    	}
    } else if (variant == 3) {
    	if (rotation == "up") {
  			pipeConfig = [2, 1, 0, 0]
    	} else if (rotation == "down") {
    		pipeConfig = [0, 0, 2, 1]
    	} else if (rotation == "left") {
    		pipeConfig = [1, 0, 0, 2]
    	} else if (rotation == "right") {
    		pipeConfig = [0, 2, 1, 0]
    	}
    } else if (variant == 4) {
    	if (rotation == "up") {
  			pipeConfig = [1, 0, 1, 2]
    	} else if (rotation == "down") {
    		pipeConfig = [1, 2, 1, 0]
    	} else if (rotation == "left") {
    		pipeConfig = [0, 1, 2, 1]
    	} else if (rotation == "right") {
    		pipeConfig = [2, 1, 0, 1]
    	}
    } else if (variant == 5) {
    	if (rotation == "up") {
  			pipeConfig = [0, 1, 1, 2]
    	} else if (rotation == "down") {
    		pipeConfig = [1, 2, 0, 1]
    	} else if (rotation == "left") {
    		pipeConfig = [1, 1, 2, 0]
    	} else if (rotation == "right") {
    		pipeConfig = [2, 0, 1, 1]
    	}
    } else if (variant == 6) {
    	if (rotation == "up") {
  			pipeConfig = [1, 1, 0, 2]
    	} else if (rotation == "down") {
    		pipeConfig = [0, 2, 1, 1]
    	} else if (rotation == "left") {
    		pipeConfig = [1, 0, 2, 1]
    	} else if (rotation == "right") {
    		pipeConfig = [2, 1, 1, 0]
    	}
    } else if (variant == 7) {
    	if (rotation == "up") {
  			pipeConfig = [1, 1, 1, 2]
    	} else if (rotation == "down") {
    		pipeConfig = [1, 2, 1, 1]
    	} else if (rotation == "left") {
    		pipeConfig = [1, 1, 2, 1]
    	} else if (rotation == "right") {
    		pipeConfig = [2, 1, 1, 1]
    	}
    } else if (variant == 8) {
    	if (rotation == "up") {
  			pipeConfig = [0, 1, 0, 0]
    	} else if (rotation == "down") {
    		pipeConfig = [0, 0, 0, 1]
    	} else if (rotation == "left") {
    		pipeConfig = [1, 0, 0, 0]
    	} else if (rotation == "right") {
    		pipeConfig = [0, 0, 1, 0]
    	}
    }
    ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
    ctx.fillRect((x + 7) * sf, (y + 7) * sf, 11 * sf, 11 * sf);
    if (pipeConfig[0]) {
     	ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
    	ctx.fillRect((x + 18) * sf, (y + 7) * sf, 7 * sf, 11 * sf);
      if (pipeConfig[0] == 1) {
      	drawArrow(25, 0, Math.PI)
      } else {
      	drawArrow(25, 0, 0)
      }
    }
    if (pipeConfig[1]) {
    	ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
    	ctx.fillRect((x + 7) * sf, (y + 18) * sf, 11 * sf, 7 * sf);
      if (pipeConfig[1] == 1) {
      	drawArrow(0, 25, -Math.PI / 2)
      } else {
      	drawArrow(0, 25, Math.PI / 2)
      }
    }
    if (pipeConfig[2]) {
    	ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
    	ctx.fillRect((x) * sf, (y + 7) * sf, 7 * sf, 11 * sf);
      if (pipeConfig[2] == 1) {
      	drawArrow(-25, 0, 0)
      } else {
      	drawArrow(-25, 0, Math.PI)
      }
    }
    if (pipeConfig[3]) {
    	ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
    	ctx.fillRect((x + 7) * sf, (y) * sf, 11 * sf, 7 * sf);
      if (pipeConfig[3] == 1) {
      	drawArrow(0, -25, Math.PI / 2)
      } else {
      	drawArrow(0, -25, -Math.PI / 2)
      }
    }
  } else if (type == "chest") {
  	ctx.fillStyle = "rgba(20, 40, 170, 0.4)"
    ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf)
    ctx.strokeStyle = "rgba(220, 220, 220, 0.6)";
    ctx.lineWidth = 2;
    ctx.strokeRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf)
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo((x + 10) * sf, (y + 11) * sf);
    ctx.lineTo((x + 16) * sf, (y + 11) * sf);
    ctx.stroke();
  } else if (type == "generator") {
  	ctx.fillStyle = "rgba(230, 170, 50, 0.6)"
    ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf)
    ctx.strokeStyle = "rgb(70, 70, 70, 0.6)"
    ctx.lineWidth = 2;
    ctx.strokeRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf)
    ctx.beginPath();
    ctx.moveTo((x + 3) * sf, (y + 12.5) * sf);
    ctx.lineTo((x + 22) * sf, (y + 12.5) * sf);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo((x + 9.33) * sf, (y + 3) * sf);
    ctx.lineTo((x + 9.33) * sf, (y + 22) * sf);
    ctx.moveTo((x + 15.66) * sf, (y + 3) * sf);
    ctx.lineTo((x + 15.66) * sf, (y + 22) * sf);
    ctx.stroke();
  } else if (type == "harvester") {
    ctx.fillStyle = "rgba(170, 40, 0, 0.5)";
    ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
    ctx.fillStyle = "rgb(0, 0, 0, 0.5)";
    if (rotation == "up") {
      ctx.fillRect((x + 6) * sf, (y + 3) * sf, 13 * sf, 4 * sf);
    } else if (rotation == "left") {
      ctx.fillRect((x + 3) * sf, (y + 6) * sf, 4 * sf, 13 * sf);
    } else if (rotation == "down") {
      ctx.fillRect((x + 6) * sf, (y + 19) * sf, 13 * sf, 4 * sf);
    } else if (rotation == "right") {
      ctx.fillRect((x + 19) * sf, (y + 6) * sf, 4 * sf, 13 * sf);
    } 
    ctx.fillStyle = "rgb(200, 200, 200, 0.4)";
    ctx.beginPath();
    ctx.moveTo((x + 12.5 + Math.sin(0) * 10) * sf, (y + 12.5 + Math.sin(0) * 10) * sf);
    for(var i = 0; i < 16; i++) {
      ctx.lineTo((x + 12.5 + Math.cos(i * Math.PI / 4 - Math.PI / 8) * 4) * sf, (y + 12.5 + Math.sin(i * Math.PI / 4 - Math.PI / 8) * 4) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(i * Math.PI / 4) * 10) * sf, (y + 12.5 + Math.sin(i * Math.PI / 4) * 10) * sf);
    }
    ctx.fill();
    ctx.fillStyle = "rgb(80, 80, 80, 0.3)";
    ctx.beginPath();
    ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 2 * sf, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (type == "devastator") {
    if (rotation == "up") {
      ctx.fillStyle = "rgba(70, 40, 160, 0.5)";
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
      ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 3) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 22) * sf);
      ctx.lineTo((x + 8) * sf, (y + 22) * sf);
      ctx.lineTo((x + 8) * sf, (y + 16) * sf);
      ctx.lineTo((x + 3) * sf, (y + 10) * sf);
      ctx.fill();
      ctx.moveTo((x + 22) * sf, (y + 22) * sf);
      ctx.lineTo((x + 17) * sf, (y + 22) * sf);
      ctx.lineTo((x + 17) * sf, (y + 16) * sf);
      ctx.lineTo((x + 22) * sf, (y + 10) * sf);
      ctx.fill();
      ctx.fillStyle = "rgba(0, 0, 230, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 6) * sf, (y + 3) * sf);
      ctx.lineTo((x + 18) * sf, (y + 3) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 10) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
      ctx.lineWidth = 3 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 22) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.stroke();
    } else if (rotation == "down") {
      ctx.fillStyle = "rgba(70, 40, 160, 0.5)";
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
      ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 22) * sf);
      ctx.lineTo((x + 22) * sf, (y + 22) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 3) * sf);
      ctx.lineTo((x + 8) * sf, (y + 3) * sf);
      ctx.lineTo((x + 8) * sf, (y + 9) * sf);
      ctx.lineTo((x + 3) * sf, (y + 15) * sf);
      ctx.fill();
      ctx.moveTo((x + 22) * sf, (y + 3) * sf);
      ctx.lineTo((x + 17) * sf, (y + 3) * sf);
      ctx.lineTo((x + 17) * sf, (y + 9) * sf);
      ctx.lineTo((x + 22) * sf, (y + 15) * sf);
      ctx.fill();
      ctx.fillStyle = "rgba(0, 0, 230, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 6) * sf, (y + 22) * sf);
      ctx.lineTo((x + 18) * sf, (y + 22) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 15) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
      ctx.lineWidth = 3 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 3) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.stroke();
    } else if (rotation == "left") {
      ctx.fillStyle = "rgba(70, 40, 160, 0.5)";
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
      ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 3) * sf);
      ctx.lineTo((x + 3) * sf, (y + 22) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 22) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 8) * sf);
      ctx.lineTo((x + 16) * sf, (y + 8) * sf);
      ctx.lineTo((x + 10) * sf, (y + 3) * sf);
      ctx.fill();
      ctx.moveTo((x + 22) * sf, (y + 22) * sf);
      ctx.lineTo((x + 22) * sf, (y + 17) * sf);
      ctx.lineTo((x + 16) * sf, (y + 17) * sf);
      ctx.lineTo((x + 10) * sf, (y + 22) * sf);
      ctx.fill();
      ctx.fillStyle = "rgba(0, 0, 230, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 6) * sf);
      ctx.lineTo((x + 3) * sf, (y + 18) * sf);
      ctx.lineTo((x + 10) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
      ctx.lineWidth = 3 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 22) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.stroke();
    } else if (rotation == "right") {
      ctx.fillStyle = "rgba(70, 40, 160, 0.5)";
      ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 19 * sf);
      ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 22) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 22) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 3) * sf);
      ctx.lineTo((x + 3) * sf, (y + 8) * sf);
      ctx.lineTo((x + 9) * sf, (y + 8) * sf);
      ctx.lineTo((x + 15) * sf, (y + 3) * sf);
      ctx.fill();
      ctx.moveTo((x + 3) * sf, (y + 22) * sf);
      ctx.lineTo((x + 3) * sf, (y + 17) * sf);
      ctx.lineTo((x + 9) * sf, (y + 17) * sf);
      ctx.lineTo((x + 15) * sf, (y + 22) * sf);
      ctx.fill();
      ctx.fillStyle = "rgba(0, 0, 230, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 22) * sf, (y + 6) * sf);
      ctx.lineTo((x + 22) * sf, (y + 18) * sf);
      ctx.lineTo((x + 15) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
      ctx.lineWidth = 3 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.stroke();
    }
  } else if (type == "appraiser") {
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.fillRect((x + 3) * sf, (y + 16) * sf, 19 * sf, 9 * sf);
    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.lineWidth = 2 * sf;
    ctx.strokeRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 12 * sf);
    ctx.fillStyle = "rgba(120, 200, 230, 0.4)";
    ctx.fillRect((x + 3) * sf, (y + 3) * sf, 19 * sf, 12 * sf);
  } else if (type == "chipper") {
    if (rotation == "up") {
        ctx.fillStyle = "rgba(150, 150, 150, 0.5)";
        ctx.fillRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgba(255, 40, 30, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 8) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgba(60, 60, 60, 0.5)";
        ctx.strokeRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 9) * sf, (y - 1) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 16) * sf, (y - 1) * sf);
        ctx.stroke();
      } else if (rotation == "down") {
        ctx.fillStyle = "rgba(150, 150, 150, 0.5)";
        ctx.fillRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgba(255, 40, 30, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 8) * sf);
        ctx.lineTo((x + 17) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 8) * sf);
        ctx.lineTo((x + 8) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgba(60, 60, 60, 0.5)";
        ctx.strokeRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 21) * sf);
        ctx.lineTo((x + 16) * sf, (y + 26) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 21) * sf);
        ctx.lineTo((x + 9) * sf, (y + 26) * sf);
        ctx.stroke();
      } else if (rotation == "left") {
        ctx.fillStyle = "rgba(150, 150, 150, 0.5)";
        ctx.fillRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgba(255, 40, 30, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 8) * sf);
        ctx.lineTo((x + 17) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgba(60, 60, 60, 0.5)";
        ctx.strokeRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x - 1) * sf, (y + 9) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 21) * sf);
        ctx.lineTo((x - 1) * sf, (y + 16) * sf);
        ctx.stroke();
      } else if (rotation == "right") {
        ctx.fillStyle = "rgba(150, 150, 150, 0.5)";
        ctx.fillRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgba(255, 40, 30, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 8) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 8) * sf);
        ctx.lineTo((x + 8) * sf, (y + 21) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgba(60, 60, 60, 0.5)";
        ctx.strokeRect((x + 4) * sf, (y + 4) * sf, 17 * sf, 17 * sf);
        ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 26) * sf, (y + 9) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 21) * sf);
        ctx.lineTo((x + 26) * sf, (y + 16) * sf);
        ctx.stroke();
      }
  } else if (type == "cannon") {
    ctx.strokeStyle = "rgba(60, 60, 60, 0.5)";
    ctx.lineWidth = 9 * sf;
    var angle;
    if (rotation == "up") {
      angle = Math.PI * -0.75;
    } else if (rotation == "right") {
      angle = Math.PI * -0.25;
    } else if (rotation == "down") {
      angle = Math.PI * 0.25;
    } else {
      angle = Math.PI * 0.75;
    }
    ctx.beginPath();
    ctx.moveTo((x + 12.5) * sf, (y + 12.5) * sf);
    ctx.lineTo((x + 12.5 + Math.cos(angle) * 14) * sf, (y + 12.5 + Math.sin(angle) * 14) * sf);
    ctx.stroke();
    
    ctx.fillStyle = "rgba(100, 100, 100, 0.5)";
    ctx.beginPath();
    ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 8 * sf, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (type == "jumper") {
    ctx.fillStyle = "rgba(220, 120, 0, 0.5)";
    var a = 0;
    if (rotation == "up") {
      a = Math.PI * -0.5;
    } else if (rotation == "down") {
      a = Math.PI * 0.5;
    } else if (rotation == "left") {
      a = Math.PI;
    } else {
      a = 0;
    }
    ctx.beginPath();
    ctx.moveTo((x + 12.5 + Math.cos(a) * 10) * sf, (y + 12.5 + Math.sin(a) * 10) * sf);
    a += Math.PI / 1.5;
    ctx.lineTo((x + 12.5 + Math.cos(a) * 10) * sf, (y + 12.5 + Math.sin(a) * 10) * sf);
    a += Math.PI / 1.5;
    ctx.lineTo((x + 12.5 + Math.cos(a) * 10) * sf, (y + 12.5 + Math.sin(a) * 10) * sf);
    ctx.fill();
  } else if (type == "drill s head") {
    ctx.fillStyle = "rgba(0, 80, 0, 0.5)";
    ctx.beginPath();
    ctx.moveTo(x * sf, y * sf);
    ctx.lineTo((x + 25) * sf, y * sf);
    ctx.lineTo((x + 25) * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, y * sf);
    ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 9 * sf, 0, Math.PI * 2, false);
    ctx.fill();
      
    ctx.fillStyle = "rgba(130, 130, 130, 0.5)";
    ctx.beginPath();
    ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 9 * sf, 0, Math.PI * 2, false);
    ctx.fill();




    ctx.strokeStyle = "rgba(30, 30, 30, 0.5)";
    ctx.lineWidth = 1.5 * sf;
    var a = 0;
    ctx.beginPath();
    ctx.moveTo((x + 12.5 + Math.cos(a) * 9) * sf, (y + 12.5 + Math.sin(a) * 9) * sf);
    for(var going = 0; going < 16; going ++) {
      a += Math.PI / 4;
      ctx.lineTo((x + 12.5 + Math.cos(a) * (9 - going / 2)) * sf, (y + 12.5 + Math.sin(a) * (9 - going / 2)) * sf);
    }
    ctx.stroke();
  } else if (type == "drill s body") {
    ctx.strokeStyle = "rgba(70, 140, 70, 0.5)";
    ctx.lineWidth = 4 * sf;
    ctx.strokeRect(x * sf, y * sf, 25 * sf, 25 * sf);
    ctx.fillStyle = "rgba(35, 70, 35, 0.5)";
    ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
    ctx.fillStyle = "rgba(125, 125, 125, 0.5)";
    ctx.beginPath();
    ctx.arc((x + 10) * sf, (y + 8) * sf, 4 * sf, 0, Math.PI * 2, false);
    ctx.fill();
    ctx.beginPath();
    ctx.arc((x + 16) * sf, (y + 6) * sf, 2.5 * sf, 0, Math.PI * 2, false);
    ctx.fill();
    ctx.beginPath();
    ctx.arc((x + 6) * sf, (y + 16) * sf, 3.25 * sf, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (type == "smelter info") {
    ctx.fillStyle = "rgba(220, 150, 80, 0.5)";
    ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
    ctx.strokeStyle = "rgba(110, 75, 40, 0.5)";
    ctx.lineWidth = 2 * sf;
    ctx.beginPath();
    ctx.moveTo(x * sf, y * sf);
    ctx.lineTo((x + 25) * sf, y * sf);
    ctx.lineTo((x + 25) * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, y * sf);
    ctx.stroke();
    ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
    ctx.fillRect((x + 4) * sf, (y + 7) * sf, 17 * sf, 12 * sf);
    ctx.strokeStyle = "rgba(30, 170, 30, 0.5)";
    ctx.lineWidth = 1.5 * sf;
    ctx.beginPath();
    ctx.moveTo((x + 6) * sf, (y + 10) * sf);
    ctx.lineTo((x + 19) * sf, (y + 10) * sf);
    ctx.moveTo((x + 6) * sf, (y + 13) * sf);
    ctx.lineTo((x + 19) * sf, (y + 13) * sf);
    ctx.moveTo((x + 6) * sf, (y + 16) * sf);
    ctx.lineTo((x + 12) * sf, (y + 16) * sf);
    ctx.stroke();
  } else if (type == "smelter input") {
    //dont mind the awful indenting :P
    ctx.fillStyle = "rgba(220, 150, 80, 0.5)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.strokeStyle = "rgba(110, 75, 40, 0.5)";
    ctx.lineWidth = 2 * sf;
    ctx.beginPath();
    ctx.moveTo(x * sf, y * sf);
    ctx.lineTo((x + 25) * sf, y * sf);
    ctx.lineTo((x + 25) * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, y * sf);
    ctx.stroke();
      if (rotation == "up") {
        ctx.beginPath();
        ctx.moveTo((x + 25) * sf, y * sf);
        ctx.lineTo((x + 25) * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, (y + 25) * sf);
        ctx.stroke();




        ctx.fillStyle = "rgba(70, 5, 20, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 21) * sf);
        ctx.lineTo((x + 19) * sf, (y + 21) * sf);
        ctx.lineTo((x + 11.5) * sf, (y + 13) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 21) * sf, (y + 19) * sf);
        ctx.lineTo((x + 13) * sf, (y + 11.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 13) * sf);
        ctx.lineTo((x + 13) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 4) * sf);
        ctx.fill();
      } else if (rotation == "down") {
        ctx.beginPath();
        ctx.moveTo(x * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, y * sf);
        ctx.lineTo((x + 25) * sf, y * sf);
        ctx.stroke();




        ctx.fillStyle = "rgba(70, 5, 20, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 4) * sf);
        ctx.lineTo((x + 6) * sf, (y + 4) * sf);
        ctx.lineTo((x + 13.5) * sf, (y + 12) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 21) * sf);
        ctx.lineTo((x + 4) * sf, (y + 6) * sf);
        ctx.lineTo((x + 12) * sf, (y + 13.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12) * sf, (y + 21) * sf);
        ctx.lineTo((x + 21) * sf, (y + 21) * sf);
        ctx.fill();
      } else if (rotation == "left") {
        ctx.beginPath();
        ctx.moveTo(x * sf, y * sf);
        ctx.lineTo((x + 25) * sf, y * sf);
        ctx.lineTo((x + 25) * sf, (y + 25) * sf);
        ctx.stroke();




        ctx.fillStyle = "rgba(70, 5, 20, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 19) * sf, (y + 4) * sf);
        ctx.lineTo((x + 11.5) * sf, (y + 12) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 21) * sf);
        ctx.lineTo((x + 21) * sf, (y + 6) * sf);
        ctx.lineTo((x + 13) * sf, (y + 13.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 12) * sf);
        ctx.lineTo((x + 13) * sf, (y + 21) * sf);
        ctx.lineTo((x + 4) * sf, (y + 21) * sf);
        ctx.fill();
      } else {
        ctx.beginPath();
        ctx.moveTo((x + 25) * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, (y + 25) * sf);
        ctx.lineTo(x * sf, y * sf);
        ctx.stroke();




        ctx.fillStyle = "rgba(70, 5, 20, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 21) * sf);
        ctx.lineTo((x + 6) * sf, (y + 21) * sf);
        ctx.lineTo((x + 13.5) * sf, (y + 13) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 4) * sf);
        ctx.lineTo((x + 4) * sf, (y + 19) * sf);
        ctx.lineTo((x + 12) * sf, (y + 11.5) * sf);
        ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 21) * sf, (y + 13) * sf);
      ctx.lineTo((x + 12) * sf, (y + 4) * sf);
      ctx.lineTo((x + 21) * sf, (y + 4) * sf);
      ctx.fill();
    }
  } else if (type == "smelter output") {
    ctx.fillStyle = "rgba(220, 150, 80, 0.5)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.strokeStyle = "rgba(110, 75, 40, 0.5)";
    ctx.lineWidth = 2 * sf;
    ctx.beginPath();
    ctx.moveTo(x * sf, y * sf);
    ctx.lineTo((x + 25) * sf, y * sf);
    ctx.lineTo((x + 25) * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, y * sf);
    ctx.stroke();
      ctx.fillStyle = "rgba(120, 120, 120, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 5) * sf, (y + 16) * sf);
      ctx.lineTo((x + 8) * sf, (y - 10) * sf);
      ctx.lineTo((x + 17) * sf, (y - 10) * sf);
      ctx.lineTo((x + 20) * sf, (y + 16) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(60, 35, 20, 0.5)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 5) * sf, (y + 16) * sf);
      ctx.lineTo((x + 8) * sf, (y - 10) * sf);
      ctx.lineTo((x + 17) * sf, (y - 10) * sf);
      ctx.lineTo((x + 20) * sf, (y + 16) * sf);
      ctx.stroke();




      ctx.fillStyle = "rgba(20, 20, 20, 0.5)";
      ctx.beginPath();
      ctx.ellipse((x + 12.5) * sf, (y - 10) * sf, 4.5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.ellipse((x + 12.5) * sf, (y - 10) * sf, 4.5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
      ctx.stroke();
  } else if (type == "piercer") {
    if (rotation == "up") {
        ctx.fillStyle = "rgba(180, 180, 180, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 23) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 23) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.fillStyle = "rgba(20, 30, 255, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 8.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 16.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.fillStyle = "rgba(200, 200, 255, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 4) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 2) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 4) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 23) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgba(130, 230, 255, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 2) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 2) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgba(100, 130, 230, 0.5)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.stroke();
      } else if (rotation == "down") {
        ctx.fillStyle = "rgba(180, 180, 180, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 2) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 2) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.fillStyle = "rgba(20, 30, 255, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 8.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 20) * sf);
        ctx.lineTo((x + 2) * sf, (y + 17) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 16.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 20) * sf);
        ctx.lineTo((x + 23) * sf, (y + 17) * sf);
        ctx.fill();
        ctx.fillStyle = "rgba(200, 200, 255, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 21) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.lineTo((x + 2) * sf, (y + 17) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 21) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.lineTo((x + 23) * sf, (y + 17) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgba(130, 230, 255, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 23) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 23) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgba(100, 130, 230, 0.5)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.stroke();
      } else if (rotation == "left") {
        ctx.fillStyle = "rgba(180, 180, 180, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 13) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 13) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.fillStyle = "rgba(20, 30, 255, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 8.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 5) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 16.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 5) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.fillStyle = "rgba(200, 200, 255, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 4) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 8) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgba(130, 230, 255, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 12) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 12) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgba(100, 130, 230, 0.5)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.stroke();
      } else {
        ctx.fillStyle = "rgba(180, 180, 180, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 12) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 12) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.fill();
        ctx.fillStyle = "rgba(20, 30, 255, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 8.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 20) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 16.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 20) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.fillStyle = "rgba(200, 200, 255, 0.5)";
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 2) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 21) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 17) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgba(130, 230, 255, 0.5)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 13) * sf, (y + 7.25) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 23) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 13) * sf, (y + 17.75) * sf);
        ctx.lineTo((x + 8) * sf, (y + 12.5) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgba(100, 130, 230, 0.5)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 2) * sf, (y + 12.5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 12.5) * sf);
        ctx.stroke();
      }
  } else if (type == "alpha ray") {
    ctx.fillStyle = "rgba(150, 0, 0, 0.5)";
      var a = 0;
      if (rotation == "up") {
        a = Math.PI * -0.5;
      } else if (rotation == "down") {
        a = Math.PI * 0.5;
      } else if (rotation == "left") {
        a = Math.PI;
      }
      ctx.beginPath();
      ctx.arc((x + 12.5 - Math.cos(a) * 1.5) * sf, (y + 12.5 - Math.sin(a) * 1.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgba(255, 50, 20, 0.5)";
      ctx.font = (20 * sf) + "px Georgia";
      ctx.textAlign = "center";
      ctx.fillText("", (x + 12.5 - Math.cos(a) * 1.5) * sf, (y + 16.5 - Math.sin(a) * 1.5) * sf);




      ctx.fillStyle = "rgba(120, 120, 120, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 8 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 8 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 8 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 8 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 9.5 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 9.5 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 12 + Math.cos(a + Math.PI * -0.5) * 4) * sf, (y + 12.5 + Math.sin(a) * 12 + Math.sin(a + Math.PI * -0.5) * 4) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 13.5 + Math.cos(a + Math.PI * -0.5) * 1.5) * sf, (y + 12.5 + Math.sin(a) * 13.5 + Math.sin(a + Math.PI * -0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 11.5 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 11.5 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10 + Math.cos(a + Math.PI * -0.5) * 1) * sf, (y + 12.5 + Math.sin(a) * 10 + Math.sin(a + Math.PI * -0.5) * 1) * sf);
      ////////////////////////////////////////////////////////////////////
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10 + Math.cos(a + Math.PI * 0.5) * 1) * sf, (y + 12.5 + Math.sin(a) * 10 + Math.sin(a + Math.PI * 0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 11.5 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 11.5 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 13.5 + Math.cos(a + Math.PI * 0.5) * 1.5) * sf, (y + 12.5 + Math.sin(a) * 13.5 + Math.sin(a + Math.PI * 0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 12 + Math.cos(a + Math.PI * 0.5) * 4) * sf, (y + 12.5 + Math.sin(a) * 12 + Math.sin(a + Math.PI * 0.5) * 4) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 9.5 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 9.5 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.fill();
      ctx.fillStyle = "rgba(200, 0, 0, 0.5)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 12) * sf, (y + 12.5 + Math.sin(a) * 12) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgba(250, 0, 0, 0.5)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 14) * sf, (y + 12.5 + Math.sin(a) * 14) * sf, 1.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgba(255, 90, 50, 0.5)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 16) * sf, (y + 12.5 + Math.sin(a) * 16) * sf, 1 * sf, 0, Math.PI * 2, false);
      ctx.fill();
  } else if (type == "mosquito") {
      if (rotation == "up") {
        var a = -Math.PI * 0.5;
      } else if (rotation == "down") {
        var a = Math.PI * 0.5;
      } else if (rotation == "left") {
        var a = Math.PI;
      } else {
        var a = 0;
      }
      ctx.fillStyle = "rgba(200, 0, 0, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * -0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * -0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * 0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.5) * 8) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -10) * sf, (y + 12.5 + Math.sin(a) * -10) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(50, 50, 50, 0.5)";
      ctx.lineWidth = 1 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * -0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * -0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * 0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.stroke();
      ctx.strokeStyle = "rgba(255, 255, 255, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -10) * sf, (y + 12.5 + Math.sin(a) * -10) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.stroke();




      ctx.fillStyle = "rgba(180, 180, 180, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(80, 80, 80, 0.5)";
      ctx.lineWidth = 1.6 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.stroke();
      ctx.fillStyle = "rgba(80, 80, 80, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10.5) * sf, (y + 12.5 + Math.sin(a) * 10.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10.5) * sf, (y + 12.5 + Math.sin(a) * 10.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.stroke();
  } else if (type == "artillery") {
    ctx.strokeStyle = "rgba(80, 80, 80, 0.5)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 5) * sf);
      ctx.lineTo((x + 25) * sf, (y + 2) * sf);
      ctx.lineTo((x + 47) * sf, (y + 5) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 8) * sf, (y + 37) * sf);
      ctx.lineTo((x + 25) * sf, (y + 30) * sf);
      ctx.lineTo((x + 42) * sf, (y + 37) * sf);
      ctx.stroke();
      ctx.fillStyle = "rgba(100, 100, 100, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 13) * sf, (y + 25) * sf);
      ctx.lineTo((x + 20) * sf, (y + 37) * sf);
      ctx.lineTo((x + 20) * sf, (y + 45) * sf);
      ctx.lineTo((x + 30) * sf, (y + 45) * sf);
      ctx.lineTo((x + 30) * sf, (y + 37) * sf);
      ctx.lineTo((x + 37) * sf, (y + 25) * sf);
      ctx.lineTo((x + 30) * sf, (y - 10) * sf);
      ctx.lineTo((x + 20) * sf, (y - 10) * sf);
      ctx.fill();
      ctx.fillStyle = "rgba(60, 60, 60, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 20) * sf, (y - 10) * sf);
      ctx.lineTo((x + 25) * sf, (y - 10) * sf);
      ctx.lineTo((x + 13) * sf, (y + 25) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 30) * sf, (y - 10) * sf);
      ctx.lineTo((x + 25) * sf, (y - 10) * sf);
      ctx.lineTo((x + 37) * sf, (y + 25) * sf);
      ctx.fill();
      ctx.fillStyle = "rgba(40, 40, 40, 0.5)";
      ctx.beginPath();
      ctx.ellipse((x + 25) * sf, (y - 10) * sf, 5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgba(60, 60, 60, 0.5)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.ellipse((x + 25) * sf, (y - 10) * sf, 4.5 * sf, 2.5 * sf, 0, 0, Math.PI * 2, false);
      ctx.stroke();
      ctx.fillStyle = "rgba(75, 75, 75, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 18) * sf, (y + 25) * sf);
      ctx.lineTo((x + 32) * sf, (y + 25) * sf);
      ctx.lineTo((x + 27) * sf, (y + 8) * sf);
      ctx.lineTo((x + 23) * sf, (y + 8) * sf);
      ctx.fill();
      //wheels
      ctx.fillStyle = "rgba(130, 50, 0, 0.5)";
      ctx.fillRect((x + 11) * sf, (y + 13) * sf, 4 * sf, 16 * sf);
      ctx.fillRect((x + 35) * sf, (y + 13) * sf, 4 * sf, 16 * sf);
      ctx.beginPath();
      ctx.arc((x + 13) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 13) * sf, (y + 29) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 37) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 37) * sf, (y + 29) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgba(60, 20, 0, 0.5)";
      ctx.lineWidth = 1 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 11) * sf, (y + 13) * sf);
      ctx.lineTo((x + 11) * sf, (y + 29) * sf);
      ctx.arc((x + 13) * sf, (y + 29) * sf, 2 * sf, Math.PI, 0, true);
      ctx.lineTo((x + 15) * sf, (y + 13) * sf);
      ctx.arc((x + 13) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI, true);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 35) * sf, (y + 13) * sf);
      ctx.lineTo((x + 35) * sf, (y + 29) * sf);
      ctx.arc((x + 37) * sf, (y + 29) * sf, 2 * sf, Math.PI, 0, true);
      ctx.lineTo((x + 39) * sf, (y + 13) * sf);
      ctx.arc((x + 37) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI, true);
      ctx.stroke();
  } else if (type == "drill m body") {
    ctx.fillStyle = "rgba(190, 195, 175, 0.5)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.fillStyle = "rgba(160, 170, 140, 0.5)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgba(40, 40, 40, 0.5)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.stroke();




      ctx.lineWidth = 1 * sf;
      ctx.strokeStyle = "rgba(20, 20, 20, 0.5)";
      ctx.beginPath();
      var a = 0;
      for(var gong = 0; gong < 16; gong ++) {
        var interior = 10 + gong * -0.625;
        if (gong == 0) {
          ctx.moveTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        }
        ctx.lineTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        a += Math.PI * 0.25;
      }
      ctx.stroke();
      ctx.beginPath();
      var a = Math.PI;
      for(var gong = 0; gong < 16; gong ++) {
        var interior = 10 + gong * -0.625;
        if (gong == 0) {
          ctx.moveTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        }
        ctx.lineTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        a += Math.PI * 0.25;
      }
      ctx.stroke();
  } else if (type == "drill m battery") {
    ctx.fillStyle = "rgba(220, 220, 170, 0.5)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgba(20, 20, 20, 0.5)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 3 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgba(80, 20, 20, 0.5)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 1.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgba(80, 20, 20, 0.5)";
      ctx.lineWidth = 3 * sf;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.stroke();
      var a = 0;
      if (rotation == "up") {
        a = Math.PI * -0.5;
      } else if (rotation == "down") {
        a = Math.PI * 0.5;
      } else if (rotation == "left") {
        a = Math.PI;
      }
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 13) * sf, (y + 12.5 + Math.sin(a) * 13) * sf);
      ctx.stroke();
  } else if (type == "passive healer") {
    ctx.fillStyle = "rgba(200, 200, 200, 0.5)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.stroke();
      ctx.strokeStyle = "rgba(255, 0, 0, 0.5)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 7) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 18) * sf);
      ctx.moveTo((x + 7) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 18) * sf, (y + 12.5) * sf);
      ctx.stroke();
  } else if (type == "alloy healer") {
    ctx.fillStyle = "rgba(130, 130, 130, 0.5)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 22) * sf);
      ctx.lineTo((x + 3) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 22) * sf);
      ctx.lineTo((x + 3) * sf, (y + 12.5) * sf);
      ctx.stroke();
      ctx.strokeStyle = "rgba(255, 0, 0, 0.5)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 7) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 18) * sf);
      ctx.moveTo((x + 7) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 18) * sf, (y + 12.5) * sf);
      ctx.stroke();
  }
}




var initialize = function() {
  var base = new platform(8, 3, 8, 8, "main")
  var grid = base.grid
  platforms.push(base);
  //p1 base
  grid[4][7] = new piece(13, 11, "p1 base info", 1, "up", 1, "main");
  grid[3][7] = new piece(12, 11, "p1 base storage", 1, "up", 1, "main");
  //p2 base
  grid[3][0] = new piece(12, 4, "p2 base info", 1, "up", 2, "main");
  grid[4][0] = new piece(13, 4, "p2 base storage", 1, "up", 2, "main");
  //grid[3][7].inventory = ["organic matter", "stone", "gold", "alloy", "energy"]




  for(var i = 0; i < 5; i++) {
    var x = ran(7);
    var y = ran(4) + 2;
    console.log(platforms[0].grid[x][y])
    if (!platforms[0].grid[x][y]) {
      if (i % 2 == 1) {
        grid[x][y] = new piece(x + 9, y + 4, "tree", 1, "up", "resource", "main");
        console.log("x: " + x + ", y: " + y + ", cx: " + (x + 9) + ", cy: " + (y + 4));
      } else {
        grid[x][y] = new piece(x + 9, y + 4, "rock", 1, "up", "resource", "main");
      }
    }
  }
};
initialize();




var getCostAtPoint = function(item, x, y, player) {
  var temp = {cost: 0, time: 0}
  var sheet = 0;
  if (player == 1) {
    sheet = p1.tilemap;
  } else {
    sheet = p2.tilemap;
  }
  if (item == "pipe") {
    temp.cost = sheet.pipe.costPlacement[x][y];
    temp.time = sheet.pipe.timePlacement[x][y];
    return(temp)
  } else if (item == "chest") {
    temp.cost += sheet.production.costPlacement[x][y];
    temp.time += sheet.production.timePlacement[x][y];
    return(temp);
  } else if (item == "generator") {
    temp.cost += sheet.production.costPlacement[x][y];
    temp.time += sheet.production.timePlacement[x][y];
    return(temp);
  } else if (item == "harvester") {
    temp.cost += sheet.production.costPlacement[x][y];
    temp.time += sheet.production.timePlacement[x][y];
    return(temp);
  } else if (item == "devastator") {
    temp.cost += sheet.production.costPlacement[x][y];
    temp.time += sheet.production.timePlacement[x][y];
    return(temp);
  } else if (item == "appraiser") {
    temp.cost += sheet.production.costPlacement[x][y];
    temp.time += sheet.production.timePlacement[x][y];
    return(temp);
  } else if (item == "chipper") {
    temp.cost += sheet.production.costPlacement[x][y];
    temp.time += sheet.production.timePlacement[x][y];
    return(temp);
  } else if (item == "cannon") {
    temp.cost += sheet.pipe.costPlacement[x][y];
    temp.time += sheet.pipe.timePlacement[x][y];
    return(temp);
  } else {
    return({cost: 0, time: 0});
  }
};




var mode = "none";
var page = 1;
var itemSelected = 1;
var rot = "up";




var variants = [
	{name: "pipe", contents: ["straight", "lturn", "rturn", "2meetcenter", "2meetl", "2meetr", "3meet", "end"]}
];
var returnVariant = function(name) {
  for(var dp = 0; dp < variants.length; dp ++) {
    if (variants[dp].name == name) {
      return(variants[dp].contents);
    }
  }
  return(false);
};




var compositeSets = [
  {name: "drill s", tiles: {
    up: [{name: "drill s head", position: {x: 0, y: 0}, rotation: "up"}, {name: "drill s body", position: {x: 0, y: 1}, rotation: "up"}],
    down: [{name: "drill s head", position: {x: 0, y: 0}, rotation: "down"}, {name: "drill s body", position: {x: 0, y: -1}, rotation: "down"}],
    left: [{name: "drill s head", position: {x: 0, y: 0}, rotation: "left"}, {name: "drill s body", position: {x: 1, y: 0}, rotation: "left"}],
    right: [{name: "drill s head", position: {x: 0, y: 0}, rotation: "right"}, {name: "drill s body", position: {x: -1, y: 0}, rotation: "right"}]
  }, isNonCentered: false},
  {name: "smelter", tiles: {
    up: [{name: "smelter info", position: {x: 0, y: 0}, rotation: "up"}, {name: "smelter input", position: {x: 0, y: -1}, rotation: "left"}, {name: "smelter input", position: {x: -1, y: 0}, rotation: "right"}, {name: "smelter output", position: {x: -1, y: -1}, rotation: "down"}],
    down: [{name: "smelter info", position: {x: 0, y: 0}, rotation: "down"}, {name: "smelter input", position: {x: 1, y: 0}, rotation: "left"}, {name: "smelter input", position: {x: 0, y: 1}, rotation: "right"}, {name: "smelter output", position: {x: 1, y: 1}, rotation: "up"}],
    left: [{name: "smelter info", position: {x: 0, y: 0}, rotation: "left"}, {name: "smelter input", position: {x: -1, y: 0}, rotation: "down"}, {name: "smelter input", position: {x: 0, y: 1}, rotation: "up"}, {name: "smelter output", position: {x: -1, y: 1}, rotation: "right"}],
    right: [{name: "smelter info", position: {x: 0, y: 0}, rotation: "right"}, {name: "smelter input", position: {x: 1, y: 0}, rotation: "up"}, {name: "smelter input", position: {x: 0, y: -1}, rotation: "down"}, {name: "smelter output", position: {x: 1, y: -1}, rotation: "left"}]
  }, isNonCentered: false},
  {name: "drill m", tiles: {
    up: [{name: "drill m battery", position: {x: 0, y: -1}, rotation: "down"}, {name: "drill m battery", position: {x: 1, y: 0}, rotation: "left"}, {name: "drill m body", position: {x: 0, y: 0}, rotation: "up"}],
    down: [{name: "drill m battery", position: {x: 0, y: 1}, rotation: "up"}, {name: "drill m battery", position: {x: -1, y: 0}, rotation: "right"}, {name: "drill m body", position: {x: 0, y: 0}, rotation: "down"}],
    left: [{name: "drill m battery", position: {x: 0, y: -1}, rotation: "down"}, {name: "drill m battery", position: {x: -1, y: 0}, rotation: "right"}, {name: "drill m body", position: {x: 0, y: 0}, rotation: "left"}],
    right: [{name: "drill m battery", position: {x: 0, y: 1}, rotation: "up"}, {name: "drill m battery", position: {x: 1, y: 0}, rotation: "left"}, {name: "drill m body", position: {x: 0, y: 0}, rotation: "right"}],
  }, isNonCentered: false},
  {name: "artillery", tiles: {
    up: [{name: "artillery", position: {x: 0, y: 0}, rotation: "up"}, {name: "artillery pointer cardinal", position: {x: 1, y: 0}, rotation: "left"}, {name: "artillery pointer cardinal", position: {x: 0, y: 1}, rotation: "up"}, {name: "artillery pointer diagonal", position: {x: 1, y: 1}, rotation: "up"}],
    down: [{name: "artillery", position: {x: 0, y: 0}, rotation: "up"}, {name: "artillery pointer cardinal", position: {x: 1, y: 0}, rotation: "left"}, {name: "artillery pointer cardinal", position: {x: 0, y: 1}, rotation: "up"}, {name: "artillery pointer diagonal", position: {x: 1, y: 1}, rotation: "up"}],
    left: [{name: "artillery", position: {x: 0, y: 0}, rotation: "up"}, {name: "artillery pointer cardinal", position: {x: 1, y: 0}, rotation: "left"}, {name: "artillery pointer cardinal", position: {x: 0, y: 1}, rotation: "up"}, {name: "artillery pointer diagonal", position: {x: 1, y: 1}, rotation: "up"}],
    right: [{name: "artillery", position: {x: 0, y: 0}, rotation: "up"}, {name: "artillery pointer cardinal", position: {x: 1, y: 0}, rotation: "left"}, {name: "artillery pointer cardinal", position: {x: 0, y: 1}, rotation: "up"}, {name: "artillery pointer diagonal", position: {x: 1, y: 1}, rotation: "up"}]
  }, isNonCentered: true}
];




var returnCompositeSet = function(name) {
  for(var dc = 0; dc < compositeSets.length; dc ++) {
    if (compositeSets[dc].name == name.item) {
      return(compositeSets[dc]);
    }
  }
  return(false);
}




var currentItems = 0;
var currentVariant = 1;
var place_phase = function() {
  if (activePlayer == 1) {
    currentItems = p1.items;
  } else {
    currentItems = p2.items;
  }
  for(var i = 0; i < currentItems.length; i++) {
    if (currentItems[i].amount <= 0) {
      currentItems.splice(i, 1);
    }
  }
	var pages = Math.ceil(currentItems.length / 6)
  //flip we gonna have to do pages :c
  ctx.fillStyle = "rgb(30, 100, 150)"
  ctx.fillRect(155 * sf, 400 * sf, 330 * sf, 85 * sf)
  
  ctx.fillStyle = "rgb(40, 70, 70)"
  //go left button
  ctx.fillRect(160 * sf, 405 * sf, 40 * sf, 75 * sf)
  //go right button
  ctx.fillRect(440 * sf, 405 * sf, 40 * sf, 75 * sf)
  
  //page info backdrop
  ctx.fillRect(205 * sf, 450 * sf, 110 * sf, 30 * sf)
  //part info backdrop
  ctx.fillRect(325 * sf, 450 * sf, 110 * sf, 30 * sf)
  
  ctx.fillStyle = "rgb(0, 20, 20)"
  //left arrow
  ctx.beginPath()
  ctx.moveTo(190 * sf, 410 * sf)
  ctx.lineTo(165 * sf, 442.5 * sf)
  ctx.lineTo(190 * sf, 475 * sf)
  ctx.fill()
  ctx.strokeStyle = "rgb(0, 0, 0)"
  ctx.lineWidth = 1
  if (mouseInside(160 * sf, 405 * sf, 40 * sf, 75 * sf)) {
  	ctx.lineWidth = 3
    if (md) {
    	md = false
      if (page > 1) {
      	page --;
      }
    }
  }
  ctx.strokeRect(160 * sf, 405 * sf, 40 * sf, 75 * sf)
  
  //right arrow
  ctx.beginPath()
  ctx.moveTo(450 * sf, 410 * sf)
  ctx.lineTo(475 * sf, 442.5 * sf)
  ctx.lineTo(450 * sf, 475 * sf)
  ctx.fill()
  
  ctx.strokeStyle = "rgb(0, 0, 0)"
  ctx.lineWidth = 1;
  if (mouseInside(440 * sf, 405 * sf, 40 * sf, 75 * sf)) {
  	ctx.lineWidth = 3;
    if (md) {
    	md = false;
    	if (page < pages) {
      	page ++
      }
    }
  }
  ctx.strokeRect(440 * sf, 405 * sf, 40 * sf, 75 * sf)
  
  //x button
 	ctx.fillStyle = "rgb(220, 40, 20)"
  ctx.fillRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
  
  ctx.strokeStyle = "rgb(0, 0, 0)"
  ctx.lineWidth = 3 * sf;
  ctx.beginPath()
  ctx.moveTo(455 * sf, 370 * sf)
  ctx.lineTo(475 * sf, 390 * sf)
  ctx.stroke()
  ctx.beginPath()
  ctx.moveTo(475 * sf, 370 * sf)
  ctx.lineTo(455 * sf, 390 * sf)
  ctx.stroke()
  ctx.lineWidth = 1 * sf
  if (mouseInside(450 * sf, 365 * sf, 30 * sf, 30 * sf)) {
  	ctx.lineWidth = 3 * sf
    if (md) {
    	mode = "none";
    }
  }
  ctx.strokeRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
  




  for(var i = 0; i < 6; i++) {
    var index = ((page - 1) * 6) + i;
    if (index < currentItems.length) {
      ctx.fillStyle = "rgb(200, 200, 200)"
  	  ctx.fillRect((205 + i * 39) * sf, 410 * sf, 35 * sf, 35 * sf)
      if ((index + 1) == itemSelected) {
     	  ctx.strokeStyle = "rgb(200, 255, 20)"
        ctx.lineWidth = 3 * sf;
        ctx.strokeRect((205 + i * 39) * sf, 410 * sf, 35 * sf, 35 * sf)
      }
      if (mouseInside((205 + i * 39) * sf, 410 * sf, 35 * sf, 35 * sf) && md) {
      	md = false
        itemSelected = i + 1 + (page - 1) * 6
      }
      if ((currentItems.length - 1) >= index) {
     	  drawIcon(currentItems[index].item, (222.5 + i * 39), 427.5);
        if ((index + 1) == itemSelected) {
         	ctx.font = (18 * sf) + "px Courier New";
          ctx.fillStyle = "rgb(200, 255, 255)"
          ctx.textAlign = "left"
          ctx.fillText(currentItems[index].item + ": " + currentItems[index].amount, 330 * sf, 468 * sf)
        }
      }
    } else {
      ctx.fillStyle = "rgb(70, 70, 70)"
  	  ctx.fillRect((205 + i * 39) * sf, 410 * sf, 35 * sf, 35 * sf)
    }
  }
  
  //text on thingy
  ctx.font = (18 * sf) + "px Courier New"
  ctx.fillStyle = "rgb(200, 255, 255)"
  ctx.textAlign = "left"
  ctx.fillText("Page: " + page, 210 * sf, 468 * sf)
  
  //functionality




  if (itemSelected >= currentItems.length) {
    itemSelected = currentItems.length;
  }
  if (itemSelected == 0) {
    itemSelected = "none";
  }
 	if (itemSelected != "none" && currentItems[itemSelected - 1].item != undefined && currentItems[itemSelected - 1].item != "none" && mouseInside(0, 0, 500 * sf, 350 * sf)) {
    var comp = returnCompositeSet(currentItems[itemSelected - 1]);
    if (tPress) {
    	tPress = false;
  		var f = 0;
      for(var i = 0; i < variants.length; i++) {
      	if (variants[i].name == currentItems[itemSelected - 1].item) {
        	f = i;
        }
      }
      var v = variants[f].contents;
      if (currentVariant >= v.length) {
      	currentVariant = 1;
      } else {
      	currentVariant ++;
      }
  	}
  	var x = Math.floor(mx / (25 * sf))
    var y = Math.floor(my / (25 * sf))
    var curPlayer = 0;
    if (activePlayer == 1) {
      curPlayer = p1;
    } else {
      curPlayer = p2;
    }
    if (comp == false) {
      var index = accessPoint(x + 1, y + 1, "main")
      if (index == 0 && index != null) {
        var temp = getCostAtPoint(currentItems[itemSelected - 1].item, getCoordsOnPlatform(x, y).x, getCoordsOnPlatform(x, y).y, activePlayer);
    	  ghost(x * 25, y * 25, currentItems[itemSelected - 1].item, currentVariant, rot)
        if (temp) {
          ctx.fillStyle = "rgb(40, 100, 180)";
          ctx.fillRect(mx, my, 100 * sf, 40 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (16 * sf) + "px Courier New";
          ctx.textAlign = "left";
          ctx.fillText("cost: " + temp.cost, mx + 5 * sf, my + 10 * sf);
          ctx.fillText("time: " + temp.time, mx + 5 * sf, my + 28 * sf);
        }
        if (md) {
          if (currentItems[itemSelected - 1].amount > 0) {
            if (curPlayer.scrap >= temp.cost) {
              curPlayer.scrap -= temp.cost;
        	    md = false;
              var selectedPlatform = getPlatform(x, y)
              var px = getCoordsOnPlatform(x, y).x;
              var py = getCoordsOnPlatform(x, y).y;
     		      selectedPlatform.grid[px][py] = new piece(x + 1, y + 1, currentItems[itemSelected - 1].item, currentVariant, rot, activePlayer, "main");
              currentItems[itemSelected - 1].amount --;
            }
          }
        }
      }
    } else {
      var offset = 0;
      if (comp.isNonCentered) {
        var x = Math.floor((mx - 12.5 * sf) / (25 * sf))
        var y = Math.floor((my - 12.5 * sf) / (25 * sf))
        offset = 0;
      }
      var works = true;
      var tiles = 0;
      if (rot == "up") {
        tiles = comp.tiles.up;
      } else if (rot == "down") {
        tiles = comp.tiles.down;
      } else if (rot == "left") {
        tiles = comp.tiles.left;
      } else {
        tiles = comp.tiles.right;
      }
      for(var i = 0; i < tiles.length; i++) {
        var index = accessPoint(x + tiles[i].position.x + 1, y + tiles[i].position.y + 1, "main");
        if (md) {
          console.log(index);
        }
        if (index != 0 || index == null) {
          works = false;
        }
      }
      if (works) {
        var temp = getCostAtPoint(currentItems[itemSelected - 1].item, getCoordsOnPlatform(x, y).x, getCoordsOnPlatform(x, y).y, activePlayer);
        if (temp) {
          ctx.fillStyle = "rgb(40, 100, 180)";
          ctx.fillRect(mx, my, 100 * sf, 40 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (16 * sf) + "px Courier New";
          ctx.textAlign = "left";
          ctx.fillText("cost: " + temp.cost, mx + 5 * sf, my + 10 * sf);
          ctx.fillText("time: " + temp.time, mx + 5 * sf, my + 28 * sf);
        }
        for(var i = 0; i < tiles.length; i++) {
          ghost((x + tiles[i].position.x) * 25 + offset, (y + tiles[i].position.y) * 25 + offset, tiles[i].name, currentVariant, tiles[i].rotation);
        }
        if (md) {
          if (currentItems[itemSelected - 1].amount > 0) {
            if (curPlayer.scrap >= temp.cost) {
              curPlayer.scrap -= temp.cost;
        	    md = false;
              for(var i = 0; i < tiles.length; i++) {
                var selectedPlatform = getPlatform(x, y)
                var px = getCoordsOnPlatform(x + tiles[i].position.x, y + tiles[i].position.y).x;
                var py = getCoordsOnPlatform(x + tiles[i].position.x, y + tiles[i].position.y).y;
     		        selectedPlatform.grid[px][py] = new piece(x + tiles[i].position.x + 1, y + tiles[i].position.y + 1, tiles[i].name, currentVariant, tiles[i].rotation, activePlayer, "main");
                console.log("new piece(" + (x + tiles[i].position.x + 1) + ", " + (y + tiles[i].position.y + 1) + ", " + tiles[i].name + ", " + currentVariant + ", " + tiles[i].rotation + ")");
              }
              currentItems[itemSelected - 1].amount --;
            }
          }
        }
      }
    }
  }
};




//25 x 25, centered.
var drawResourceIcon = function(x, y, type) {
  if (type == "organic matter") {
    ctx.fillStyle = "rgb(0, 120, 0)";
    ctx.beginPath();
    ctx.moveTo((x - 8) * sf, (y + 8) * sf);
    ctx.lineTo((x - 2) * sf, (y + 9) * sf);
    ctx.lineTo((x + 4) * sf, (y + 4) * sf);
    ctx.lineTo((x + 9) * sf, (y - 2) * sf);
    ctx.lineTo((x + 2) * sf, (y - 7) * sf);
    ctx.lineTo((x - 4) * sf, (y - 5) * sf);
    ctx.fill();
    ctx.fillStyle = "rgb(0, 150, 0)";
    ctx.beginPath();
    ctx.arc((x + 5) * sf, (y + 4) * sf, 3, 0, Math.PI * 2, false);
    ctx.fill();
    ctx.beginPath();
    ctx.arc((x - 3) * sf, (y - 5) * sf, 2, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (type == "stone") {
    ctx.fillStyle = "rgb(80, 80, 80)";
    ctx.beginPath();
    ctx.moveTo((x - 8) * sf, (y + 8) * sf);
    ctx.lineTo((x - 2) * sf, (y + 9) * sf);
    ctx.lineTo((x + 4) * sf, (y + 4) * sf);
    ctx.lineTo((x + 9) * sf, (y - 2) * sf);
    ctx.lineTo((x + 2) * sf, (y - 7) * sf);
    ctx.lineTo((x - 4) * sf, (y - 5) * sf);
    ctx.fill();
    ctx.fillStyle = "rgb(130, 130, 130)";
    ctx.beginPath();
    ctx.arc(x, (y + 4) * sf, 3, 0, Math.PI * 2, false);
    ctx.fill();
    ctx.beginPath();
    ctx.arc((x - 3) * sf, (y - 5) * sf, 2, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (type == "gold") {
    ctx.fillStyle = "rgb(255, 220, 0)";
    ctx.beginPath();
    ctx.moveTo((x - 8) * sf, (y + 8) * sf);
    ctx.lineTo((x - 2) * sf, (y + 9) * sf);
    ctx.lineTo((x + 4) * sf, (y + 4) * sf);
    ctx.lineTo((x + 9) * sf, (y - 2) * sf);
    ctx.lineTo((x + 2) * sf, (y - 7) * sf);
    ctx.lineTo((x - 4) * sf, (y - 5) * sf);
    ctx.fill();
    ctx.fillStyle = "rgb(200, 170, 0)";
    ctx.beginPath();
    ctx.arc((x + 3) * sf, (y + 1) * sf, 4, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (type == "alloy") {
    ctx.fillStyle = "rgb(200, 200, 200)";
    ctx.beginPath();
    ctx.moveTo((x - 8) * sf, (y + 8) * sf);
    ctx.lineTo((x - 2) * sf, (y + 9) * sf);
    ctx.lineTo((x + 4) * sf, (y + 4) * sf);
    ctx.lineTo((x + 9) * sf, (y - 2) * sf);
    ctx.lineTo((x + 2) * sf, (y - 7) * sf);
    ctx.lineTo((x - 4) * sf, (y - 5) * sf);
    ctx.fill();
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.beginPath();
    ctx.arc((x + 6) * sf, (y + 5) * sf, 2, 0, Math.PI * 2, false);
    ctx.fill();
    ctx.fillStyle = "rgb(255, 255, 255)";
    ctx.beginPath();
    ctx.arc((x - 3) * sf, (y - 2) * sf, 2, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (type == "energy") {
    ctx.fillStyle = "rgb(220, 250, 0)";
    ctx.beginPath();
    ctx.moveTo((x - 3) * sf, (y - 10) * sf);
    ctx.lineTo((x + 6) * sf, (y - 1) * sf);
    ctx.lineTo((x + 2) * sf, (y + 2) * sf);
    ctx.lineTo((x + 6) * sf, (y + 10) * sf);
    ctx.lineTo((x - 3) * sf, (y + 1) * sf);
    ctx.lineTo((x + 1) * sf, (y - 2) * sf);
    ctx.fill();
  } else {
    ctx.strokeStyle = "rgb(255, 0, 0)";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI * 2, false);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo((x + Math.cos(Math.PI * 0.75) * 10) * sf, (y + Math.sin(Math.PI * 0.75) * 10) * sf);
    ctx.lineTo((x - Math.cos(Math.PI * 0.75) * 10) * sf, (y - Math.sin(Math.PI * 0.75) * 10) * sf);
    ctx.stroke();
  }
}




var target = 0;
var locked = false;
var lock = {
	x: 1,
  y: 1
};




var drawingAction = false;
var actionTime = 0;




var bonusUi = 0;
var bonusUiPage = 0;
var isTargeting = false;
var scan = function() {
	//background
	ctx.fillStyle = "rgb(230, 120, 30)";
  ctx.fillRect(10 * sf, 10 * sf, 150 * sf, 340 * sf);
  //x button
 	ctx.fillStyle = "rgb(220, 40, 20)"
  ctx.fillRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
  
  ctx.strokeStyle = "rgb(0, 0, 0)"
  ctx.lineWidth = 3 * sf;
  ctx.beginPath()
  ctx.moveTo(455 * sf, 370 * sf)
  ctx.lineTo(475 * sf, 390 * sf)
  ctx.stroke()
  ctx.beginPath()
  ctx.moveTo(475 * sf, 370 * sf)
  ctx.lineTo(455 * sf, 390 * sf)
  ctx.stroke()
  ctx.lineWidth = 1 * sf;
  if (mouseInside(450 * sf, 365 * sf, 30 * sf, 30 * sf)) {
    ctx.lineWidth = 3 * sf;
    if (md) {
      mode = "none";
    }
  }
  ctx.strokeRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
  //info
  var ioffset = 10;
  ctx.fillStyle = "rgb(0, 0, 0)";
  ctx.font = (15 * sf) + "px Georgia";
  ctx.textAlign = "left";
  var ilist = []
  if (target) {
  	ctx.fillText("Current selection: ", 15 * sf, 25 * sf);
    ctx.fillText(target.type, 15 * sf, 42 * sf);
    ioffset += 60;
    if (target.inventory) {
    	ilist.push("inventory");
    }
    if (target.health) {
    	ilist.push("health");
    }
    if (target.energy != undefined) {
      ilist.push("energy");
    }
    if (target.resources != undefined) {
      ilist.push("resources");
    }
    if (target.canAutoOut && activePlayer == target.player) {
      ilist.push("autooutconfig")
    }
    if (target.hasAction && activePlayer == target.player) {
      ilist.push("action");
    }
    if (target.hasSell && activePlayer == target.player) {
      ilist.push("sell");
    }
    if (target.mode != undefined && activePlayer == target.player) {
      ilist.push("mode");
    }
    if (target.hasTargeting && activePlayer == target.player) {
      ilist.push("targeting");
    }
    if (target.nextDrop) {
      ilist.push("nextdrop");
    }




    for(var i = 0; i < ilist.length; i++) {
      if (true) { //waaayyy too lazy to delete this -n- ZZZZ
                  //                                \U/
    	  if (ilist[i] == "inventory") {
       	  var s = ""
          for(var j = 0; j < target.inventory.length; j++) {
          	s += target.inventory[j];
            s += ", ";
          }
          if (s == "") {
          	s = "Empty"
          }
          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.fillRect(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillText("View Inventory", 19 * sf, (ioffset + 13) * sf);
          ctx.fillText("(" + target.inventory.length + "/" + target.inventorySize + ")", 125 * sf, (ioffset + 13) * sf);
          ctx.lineWidth = 1 * sf;
          ctx.strokeStyle = "rgb(0, 0, 0)";
          var a = false;
          if (mouseInside(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf)) {
            ctx.lineWidth = 2 * sf;
            a = true;
          }
          ctx.strokeRect(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf);
          if (a) {
            for(var j = 0; j < target.inventory.length; j++) {
              ioffset += 15;
              ctx.fillText(target.inventory[j], 15 * sf, (ioffset + 13) * sf);
            } 
          }
          ioffset += 20;
        } else if (ilist[i] == "resources") {
          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.fillRect(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillText("View Resources", 19 * sf, (ioffset + 13) * sf);
          ctx.fillText("(" + target.resources.length + ")", 125 * sf, (ioffset + 13) * sf);
          ctx.lineWidth = 1 * sf;
          ctx.strokeStyle = "rgb(0, 0, 0)";
          var a = false;
          if (mouseInside(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf)) {
            ctx.lineWidth = 2 * sf;
            a = true;
          }
          ctx.strokeRect(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf);
          if (a) {
            for(var j = 0; j < target.resources.length; j++) {
              ioffset += 15;
              ctx.fillText(target.resources[j], 15 * sf, (ioffset + 13) * sf);
            } 
          }
          ioffset += 20;
        } else if (ilist[i] == "health") {
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillStyle = "rgb(0, 0, 0)";
        	ctx.fillText("Health: " + target.health, 15 * sf, (ioffset + 13) * sf);
          ioffset += 20;
        } else if (ilist[i] == "autooutconfig") {
          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.fillRect(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillText("Auto Config", 19 * sf, (ioffset + 13) * sf);
          ctx.lineWidth = 1 * sf;
          ctx.strokeStyle = "rgb(0, 0, 0)";
          if (mouseInside(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf)) {
            ctx.lineWidth = 3 * sf;
            if (md) {
              md = false;
              bonusUi = "autooutconfig";
              bonusUiPage = 0;
            }
          }
          ctx.strokeRect(15 * sf, (ioffset) * sf, 108 * sf, 18 * sf);
          ioffset += 20;
        } else if (ilist[i] == "sell") {
          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.fillRect(15 * sf, (ioffset) * sf, 60 * sf, 18 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillText("Selling", 19 * sf, (ioffset + 13) * sf);
          ctx.lineWidth = 1;
          ctx.strokeStyle = "rgb(0, 0, 0)";
          if (mouseInside(15 * sf, (ioffset) * sf, 60 * sf, 18 * sf)) {
            ctx.lineWidth = 3 * sf;
            if (md) {
              md = false;
              bonusUi = "selling";
              bonusUiPage = 0;
            }
          }
          ctx.strokeRect(15 * sf, (ioffset) * sf, 60 * sf, 18 * sf);
          ioffset += 20;
        } else if (ilist[i] == "action") {
          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.fillRect(15 * sf, (ioffset) * sf, 70 * sf, 18 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillText("Activate", 19 * sf, (ioffset + 13) * sf);
          ctx.lineWidth = 1;
          ctx.strokeStyle = "rgb(0, 0, 0)";
          if (mouseInside(15 * sf, (ioffset) * sf, 70 * sf, 18 * sf)) {
            ctx.lineWidth = 3 * sf;
            if (md) {
              md = false;
              target.action();
              drawingAction = true;
              actionTime = 0;
            }
          }
          ctx.strokeRect(15 * sf, (ioffset) * sf, 70 * sf, 18 * sf);




          if (drawingAction) {
            actionTime ++;
            target.actionDraw(actionTime, (target.x - 1) * 25, (target.y - 1) * 25);
          }
          ioffset += 20;
        } else if (ilist[i] == "energy") {
          ctx.fillStyle = "rgb(0, 0, 0)";      
          ctx.font = (15 * sf) + "px Georgia";      
        	ctx.fillText("Energy: " + target.energy, 15 * sf, (ioffset + 13) * sf);
          ioffset += 20;
        } else if (ilist[i] == "mode") {
          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.fillRect(15 * sf, (ioffset) * sf, 105 * sf, 18 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillText("Change Mode", 19 * sf, (ioffset + 13) * sf);
          ctx.lineWidth = 1;
          ctx.strokeStyle = "rgb(0, 0, 0)";
          if (mouseInside(15 * sf, (ioffset) * sf, 105 * sf, 18 * sf)) {
            ctx.lineWidth = 3 * sf;
            if (md) {
              md = false;
              if (target.mode < target.modeList.length ) {
                target.mode ++;
              } else {
                target.mode = 1;
              }
            }
          }
          ctx.strokeRect(15 * sf, (ioffset) * sf, 105 * sf, 18 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (12 * sf) + "px Georgia";
        	ctx.fillText("Current Mode: " + target.modeList[target.mode - 1], 15 * sf, (ioffset + 33) * sf);
          ioffset += 35;
        } else if (ilist[i] == "targeting") {
          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.fillRect(15 * sf, (ioffset) * sf, 80 * sf, 18 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillText("Targeting", 19 * sf, (ioffset + 13) * sf);
          ctx.lineWidth = 1 * sf;
          ctx.strokeStyle = "rgb(0, 0, 0)";
          if (mouseInside(15 * sf, (ioffset) * sf, 80 * sf, 18 * sf)) {
            ctx.lineWidth = 3 * sf;
            if (md) {
              md = false;
              bonusUi = "targeting";
            }
          }
          ctx.strokeRect(15 * sf, (ioffset) * sf, 80 * sf, 18 * sf);
          ioffset += 20;
        } else if (ilist[i] == "nextdrop") {
          ctx.font = (15 * sf) + "px Georgia";
          ctx.fillText("Next drop: " + target.nextDrop, 15 * sf, (ioffset + 13) * sf);
          ioffset += 20;
        }
        //too lazy to unindent :P
        if (bonusUi == "autooutconfig") {
          if (rotActivated) {
            rotActivated = false;
            if (target.autoOutConfig == "up") {
              target.autoOutConfig = "right";
            } else if (target.autoOutConfig == "right") {
              target.autoOutConfig = "down";
            } else if (target.autoOutConfig == "down") {
              target.autoOutConfig = "left";
            } else {
              target.autoOutConfig = "up";
            }
          }
          ctx.fillStyle = "rgb(130, 20, 0)";
          ctx.fillRect(160 * sf, 405 * sf, 320 * sf, 75 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (20 * sf) + "px Courier New";
          ctx.textAlign = "left";
          ctx.fillText("Auto Output Config Menu", 170 * sf, 425 * sf);
          ctx.strokeStyle = "rgb(0, 0, 0)";
          ctx.lineWidth = 1 * sf;




          ctx.fillStyle = "rgb(50, 0, 0)";
          ctx.fillRect(165 * sf, 430 * sf, 20 * sf, 20 * sf);
          if (target.isAutoOut) {
            ctx.lineWidth = 2 * sf;
            ctx.strokeStyle = "rgb(200, 200, 200)";
            ctx.beginPath();
            ctx.moveTo(170 * sf, 435 * sf);
            ctx.lineTo(180 * sf, 445 * sf);
            ctx.moveTo(170 * sf, 445 * sf);
            ctx.lineTo(180 * sf, 435 * sf);
            ctx.stroke();




            var x, y;
            x = target.x * 25 - 12.5;
            y = target.y * 25 - 12.5;




            if (target.autoOutConfig == "up") {
              y -= 25;
            } else if (target.autoOutConfig == "down") {
              y += 25;
            } else if (target.autoOutConfig == "left") {
              x -= 25;
            } else {
              x += 25;
            }




            ctx.fillStyle = "rgba(255, 255, 0, 0.25)";
            ctx.beginPath();
            ctx.arc(x * sf, y * sf, 6 * sf, 0, Math.PI * 2, false);
            ctx.fill();
            ctx.lineWidth = 1 * sf;
            ctx.strokeStyle = "rgba(0, 0, 0, 0.75)";
            ctx.beginPath();
            ctx.arc(x * sf, y * sf, 6 * sf, 0, Math.PI * 2, false);
            ctx.stroke();
          }
          
          if (mouseInside(165 * sf, 430 * sf, 20 * sf, 20 * sf) && md) {
            md = false;
            if (target.isAutoOut) {
              target.isAutoOut = false;
            } else {
              target.isAutoOut = true;
            }
          }




          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (16 * sf) + "px Courier New";
          ctx.fillText("Active", 195 * sf, 445 * sf);




          ctx.fillStyle = "rgb(150, 100, 0)";
          ctx.fillRect(350 * sf, 430 * sf, 20 * sf, 20 * sf);




          ctx.strokeStyle = "rgb(255, 255, 255)";
          ctx.lineWidth = 2 * sf;
          ctx.beginPath();
          ctx.arc(360 * sf, 440 * sf, 6 * sf, -Math.PI / 4, Math.PI / 4, true);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo((360 + Math.cos(-Math.PI / 4) * 9) * sf, (440 + Math.sin(-Math.PI / 4) * 9) * sf);
          ctx.lineTo((360 + Math.cos(-Math.PI / 4) * 4) * sf, (440 + Math.sin(-Math.PI / 4) * 4) * sf);
          ctx.lineTo(366 * sf, 438 * sf);
          ctx.lineTo((360 + Math.cos(-Math.PI / 4) * 9) * sf, (440 + Math.sin(-Math.PI / 4) * 9) * sf);
          ctx.stroke();




          ctx.strokeStyle = "rgb(0, 0, 0)";
          ctx.lineWidth = 1 * sf;
          if (mouseInside(350 * sf, 430 * sf, 20 * sf, 20 * sf)) {
            ctx.lineWidth = 2 * sf;
            if (md) {
              md = false;
              if (target.autoOutConfig == "up") {
                target.autoOutConfig = "right";
              } else if (target.autoOutConfig == "right") {
                target.autoOutConfig = "down";
              } else if (target.autoOutConfig == "down") {
                target.autoOutConfig = "left";
              } else {
                target.autoOutConfig = "up";
              }
            }
          }
          ctx.strokeRect(350 * sf, 430 * sf, 20 * sf, 20 * sf);
        } else if (bonusUi == "selling") {
          ctx.fillStyle = "rgb(70, 160, 200)";
          ctx.fillRect(160 * sf, 405 * sf, 320 * sf, 75 * sf);
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (20 * sf) * "px Courier New";
          ctx.textAlign = "left";
          ctx.fillText("Selling :3", 170 * sf, 422 * sf);
          //var testvar = 15;
          var pages = Math.ceil(target.inventory.length / 10);




          ctx.fillText("Page: " + (bonusUiPage + 1), 370 * sf, 425 * sf);




          ctx.fillStyle = "rgb(120, 120, 120)";
          ctx.fillRect(352 * sf, 412 * sf, 15 * sf, 15 * sf);
          ctx.fillRect(436 * sf, 412 * sf, 15 * sf, 15 * sf);




          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.beginPath();
          ctx.moveTo(363 * sf, 415 * sf);
          ctx.lineTo(363 * sf, 425 * sf);
          ctx.lineTo(356 * sf, 420 * sf);
          ctx.fill();
          ctx.beginPath();
          ctx.moveTo(440 * sf, 415 * sf);
          ctx.lineTo(440 * sf, 425 * sf);
          ctx.lineTo(447 * sf, 420 * sf);
          ctx.fill();




          ctx.strokeStyle = "rgb(0, 0, 0)";
          ctx.lineWidth = 1 * sf;
          if (mouseInside(352 * sf, 412 * sf, 15 * sf, 15 * sf)) {
            ctx.lineWidth = 2 * sf;
            if (md) {
              md = false;
              if ((bonusUiPage - 1) > 0) {
                bonusUiPage --;
              } else {
                bonusUiPage = pages - 1;
                console.log(pages)
              }
            }
          }
          ctx.strokeRect(352 * sf, 412 * sf, 15 * sf, 15 * sf);
          ctx.lineWidth = 1;
          if (mouseInside(436 * sf, 412 * sf, 15 * sf, 15 * sf)) {
            ctx.lineWidth = 2;
            if (md) {
              md = false;
              if ((bonusUiPage + 1) < pages) {
                bonusUiPage ++;
              } else {
                bonusUiPage = 0;
              }
              console.log(bonusUiPage)
            }
          }
          ctx.strokeRect(436 * sf, 412 * sf, 15 * sf, 15 * sf);




          var isHovering = false;




          if (bonusUiPage < 0) {
            bonusUiPage = 0;
          }
          if (pages > 0) {
            var isSelling = false;
            for(var g = 0; g < 10; g++) {
              if (bonusUiPage + 1 == pages) {
                var multi = g % 10;
                var ind = multi + ((page - 1) * 10);
                if (ind < target.inventory.length) {
                  ctx.fillStyle = "rgb(160, 160, 160)";
                  ctx.fillRect((171 + multi * 30) * sf, 450 * sf, 25 * sf, 25 * sf);
                  drawResourceIcon(183.5 + multi * 30, 462.5, target.inventory[ind]);
                  ctx.strokeStyle = "rgb(0, 0, 0)";
                  ctx.lineWidth = 1 * sf;
                  if (mouseInside((171 + multi * 30) * sf, 450 * sf, 25 * sf, 25 * sf)) {
                    ctx.lineWidth = 2 * sf;
                    isHovering = target.inventory[ind];
                    if (md) {
                      md = false;
                      isSelling = true;
                      target.inventory.splice(ind, 1);
                    }
                  }
                  ctx.strokeRect((171 + multi * 30) * sf, 450 * sf, 25 * sf, 25 * sf);
                }
              } else if (bonusUiPage >= 0) {
                var multi = g % 10;
                var ind = multi + ((page - 1) * 10);
                ctx.fillStyle = "rgb(160, 160, 160)";
                ctx.fillRect((171 + g * 30) * sf, 450 * sf, 25 * sf, 25 * sf);
                drawResourceIcon(183.5 + g * 30, 462.5, target.inventory[ind]);
                ctx.strokeStyle = "rgb(0, 0, 0)";
                ctx.lineWidth = 1 * sf;
                if (mouseInside((171 + g * 30) * sf, 450 * sf, 25 * sf, 25 * sf)) {
                  ctx.lineWidth = 2 * sf;
                  isHovering = target.inventory[ind];
                  if (md) {
                    md = false;
                    isSelling = true;
                    target.inventory.splice(ind, 1);
                  }
                }
                ctx.strokeRect((171 + g * 30) * sf, 450 * sf, 25 * sf, 25 * sf);
              }
            }
          }
          ctx.fillStyle = "rgb(0, 0, 0)";
          ctx.font = (15 * sf) + "px Courier New";
          if (!isHovering) {
            ctx.fillText("Click on resource to sell", 180 * sf, 443 * sf);
          } else {
            var value = 0;
            if (isHovering == "organic matter") {
              value = 24;
            } else if (isHovering == "stone") {
              value = 20;
            } else if (isHovering == "gold") {
              value = 34;
            } else if (isHovering == "alloy") {
              value = 50;
            }
            ctx.fillText(isHovering + ". Sell value: " + value, 180 * sf, 443 * sf);
            if (isSelling) {
              if (activePlayer == 1) {
                p1.scrap += value;
              } else {
                p2.scrap += value;
              }
            }
          }
        } else if (bonusUi == "targeting") {
          ctx.fillStyle = "rgb(40, 40, 80)";
          ctx.fillRect(160 * sf, 405 * sf, 320 * sf, 75 * sf);
          ctx.fillStyle = "rgb(255, 170, 170)";
          ctx.font = (40 * sf) * "px Sans Serif";
          ctx.textAlign = "left";
          ctx.fillText("TARGETING", 170 * sf, 422 * sf);
          if (!isTargeting) {
            ctx.fillStyle = "rgb(80, 80, 150)";
            ctx.fillRect(165 * sf, 450 * sf, 100 * sf, 25 * sf);
            ctx.fillStyle = "rgb(255, 170, 170)";
            ctx.font = (30 * sf) * "px Sans Serif";
            ctx.fillText("QUEUE NEW", 168 * sf, 467 * sf);
            ctx.fillText("(" + target.targets.length + "/" + target.maxTargets + ")", 168 * sf, 442 * sf);
            ctx.lineWidth = 1 * sf;
            if (mouseInside(165 * sf, 450 * sf, 100 * sf, 25 * sf)) {
              ctx.lineWidth = 2 * sf;
              if (md) {
                //if (target.targets.length < target.maxTargets) {
                  isTargeting = true;
                //}
              }
            }
            ctx.strokeStyle = "rgb(120, 120, 180)";
            ctx.strokeRect(165 * sf, 450 * sf, 100 * sf, 25 * sf);

            ctx.fillStyle = "rgb(80, 80, 150)";
            ctx.fillRect(305 * sf, 420 * sf, 90 * sf, 25 * sf);
            ctx.fillStyle = "rgb(255, 170, 170)";
            ctx.fillText("CLEAR", 324 * sf, 437 * sf);
            ctx.lineWidth = 1 * sf;
            if (mouseInside(305 * sf, 420 * sf, 90 * sf, 25 * sf)) {
              ctx.lineWidth = 2 * sf;
              if (md) {
                md = false;
                target.targets = [];
              }
            }
            ctx.strokeRect(305 * sf, 420 * sf, 90 * sf, 25 * sf);
          } else {
            //target symbol
            ctx.fillStyle = "rgb(255, 0, 0)";
            ctx.beginPath();
            ctx.arc(mx, my, 2 * sf, 0, Math.PI * 2, false);
            ctx.fill();
            ctx.strokeStyle = "rgb(255, 0, 0)";
            ctx.lineWidth = 1.5 * sf;
            ctx.beginPath();
            ctx.moveTo(mx - (10 * sf), my);
            ctx.lineTo(mx - (6) * sf, my);
            ctx.moveTo(mx + (10 * sf), my);
            ctx.lineTo(mx + (6) * sf, my);
            ctx.moveTo(mx, my - (10 * sf));
            ctx.lineTo(mx, my - (6) * sf);
            ctx.moveTo(mx, my + (10 * sf));
            ctx.lineTo(mx, my + (6) * sf);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(mx, my, 7 * sf, 0, Math.PI * 2, false);
            ctx.stroke();
            //cancel button
            ctx.fillStyle = "rgb(80, 80, 150)";
            ctx.fillRect(165 * sf, 430 * sf, 85 * sf, 25 * sf);
            ctx.fillStyle = "rgb(255, 170, 170)";
            ctx.font = (30 * sf) * "px Sans Serif";
            ctx.fillText("CANCEL", 177 * sf, 447 * sf);
            ctx.lineWidth = 1 * sf;
            if (mouseInside(165 * sf, 430 * sf, 85 * sf, 25 * sf)) {
              ctx.lineWidth = 2 * sf;
              if (md) {
                md = false;
                isTargeting = false;
              }
            }
            ctx.strokeStyle = "rgb(120, 120, 180)";
            ctx.strokeRect(165 * sf, 430 * sf, 85 * sf, 25 * sf);
            if (md) {
              md = false;
              var x = Math.floor((mx / (25 * sf)));
              var y = Math.floor((my / (25 * sf)));
              console.log(x + ", " + y);
              var p = getCoordsOnPlatform(x, y);
              if (p) {
                var found = false;
                for(var brick = 0; brick < target.targets.length; brick ++) {
                  if (target.targets[brick].x == x && target.targets[brick].y == y) {
                    target.targets[brick].a ++;
                    found = true;
                    isTargeting = false;
                    break;
                  }
                }
                if (!found) {
                  target.targets.push({x: x, y: y, a: 1});
                  isTargeting = false;
                }
              }
            }

          }
          
          for(var brick = 0; brick < target.targets.length; brick++) {
            ctx.fillStyle = "rgb(255, 0, 0)";
            ctx.beginPath();
            ctx.arc((target.targets[brick].x * 25 + 12.5) * sf, (target.targets[brick].y * 25 + 12.5) * sf, 2 * sf, 0, Math.PI * 2, false);
            ctx.fill();
            ctx.strokeStyle = "rgb(255, 0, 0)";
            ctx.lineWidth = 1.5 * sf;
            ctx.beginPath();
            ctx.moveTo((target.targets[brick].x * 25 + 2.5) * sf, (target.targets[brick].y * 25 + 12.5) * sf);
            ctx.lineTo((target.targets[brick].x * 25 + 6.5) * sf, (target.targets[brick].y * 25 + 12.5) * sf);
            ctx.moveTo((target.targets[brick].x * 25 + 22.5) * sf, (target.targets[brick].y * 25 + 12.5) * sf);
            ctx.lineTo((target.targets[brick].x * 25 + 18.5) * sf, (target.targets[brick].y * 25 + 12.5) * sf);
            ctx.moveTo((target.targets[brick].x * 25 + 12.5) * sf, (target.targets[brick].y * 25 + 2.5) * sf);
            ctx.lineTo((target.targets[brick].x * 25 + 12.5) * sf, (target.targets[brick].y * 25 + 6.5) * sf);
            ctx.moveTo((target.targets[brick].x * 25 + 12.5) * sf, (target.targets[brick].y * 25 + 22.5) * sf);
            ctx.lineTo((target.targets[brick].x * 25 + 12.5) * sf, (target.targets[brick].y * 25 + 18.5) * sf);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc((target.targets[brick].x * 25 + 12.5) * sf, (target.targets[brick].y * 25 + 12.5) * sf, 7 * sf, 0, Math.PI * 2, false);
            ctx.stroke();
            ctx.fillStyle = "rgb(0, 0, 0)";
            ctx.fillRect((target.targets[brick].x * 25 + 20) * sf, (target.targets[brick].y * 25 - 4) * sf, 11 * sf, 11 * sf);
            ctx.fillStyle = "rgb(255, 255, 0)";
            ctx.font = (12 * sf) + "px Courier New";
            ctx.fillText(target.targets[brick].a, (target.targets[brick].x * 25 + 22) * sf, (target.targets[brick].y * 25 + 6) * sf);
          }
        }
      }
    }
  } else {
  	ctx.fillText("Current selection: ", 15 * sf, 25 * sf);
    ctx.fillText("None", 15 * sf, 42 * sf);
    bonusUi = 0;
  }
  if (md && !(mouseInside(10 * sf, 10 * sf, 160 * sf, 340 * sf) || mouseInside(160 * sf, 405 * sf, 320 * sf, 75 * sf)) && bonusUi != 0) {
    md = false;
    bonusUi = 0;
  }
  //if locked
  if (locked) {
  	ctx.strokeStyle = "rgb(230, 210, 60)";
    ctx.lineWidth = 2 * sf;
    ctx.strokeRect(((lock.x - 1) * 25) * sf, ((lock.y - 1) * 25) * sf, 25 * sf, 25 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (15 * sf) + "px Georgia";
    ctx.fillText("X: " + lock.x + ", Y: " + lock.y, 15 * sf, 63 * sf);
  }
  //detection
  if (accessPoint(Math.ceil(mx / (25 * sf)), Math.ceil(my / (25 * sf))) != null && !locked && !bonusUi) {
  	var x = Math.ceil(mx / (25 * sf))
    var y = Math.ceil(my / (25 * sf))
    lock.x = x;
    lock.y = y;
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (15 * sf) + "px Georgia";
    ctx.fillText("X: " + x + ", Y: " + y, 15 * sf, 63 * sf);
    var object = accessPoint(lock.x, lock.y);
    if (object) {
      if (object.isPointer) {
        object = object.pointer;
      }
      target = object;
      if (md) {
       	md = false;
      	locked = true;
      }
    } else {
    	target = 0;
    }
  } else if (!locked) {
  	target = 0;
  } else if (md && !bonusUi) {
  	md = false;
    locked = false;
  }
};




//format = array of pointers to the different pieces that have end of turn abilities, in chronological order.
var currentSequence = [];
//is it sequenced? used to see if turn can be ended.
var isSequenced = false;




//variable that controls the flickering of the green selection marker color.
var seqCount1 = 0;




//state of sequencing activated by pressing green check mark
var cubey = {
  x: 75,
  y: 55,
  mx: 0,
  my: 0
}
var grabbing = false;
var coffset = {
  x: 0,
  y: 0
}
var prev = {
  x: 0,
  y: 0
}
//list of pointers in order that will happen during the end of the turn.
var tempSequence = [];
var eotSequence = [];




var sequencing = function() {
  //background
  ctx.fillStyle = "rgb(60, 230, 30)";
  ctx.fillRect(155 * sf, 400 * sf, 330 * sf, 85 * sf);




  ctx.fillStyle = "rgb(0, 0, 0)";
  ctx.font = (20 * sf) + "px Courier New";
  ctx.textAlign = "left";
  ctx.fillText("Sequencing", 160 * sf, 424 * sf);




  ctx.fillStyle = "rgb(0, 0, 0)";
  ctx.fillRect(305 * sf, 405 * sf, 125 * sf, 75 * sf);




  //cubey!
  var dampen = 0.05;
  var cutoff = 0.10;
  cubey.x += cubey.mx;
  cubey.y += cubey.my;
  if (cubey.y > 60) {
    cubey.y = 60;
    cubey.my = 0;
  }




  if (cubey.mx > 0) {
    cubey.mx -= dampen;
  } else if (cubey.mx < 0) {
    cubey.mx += dampen;
  }




  if (cubey.x > 110) {
    cubey.x = 110;
    cubey.mx *= -0.75;
  }
  if (cubey.x < 15) {
    cubey.x = 15;
    cubey.mx *= -0.75;
  }




  if (Math.abs(cubey.mx) < cutoff) {
    cubey.mx = 0;
  }
  
  if (mouseInside((cubey.x - 15 + 305) * sf, (cubey.y - 15 + 405) * sf, 30 * sf, 30 * sf) && !grabbing) {
    if (md) {
      coffset.x = mx - cubey.x;
      coffset.y = my - cubey.y;
      grabbing = true;
    }
  }




  if (grabbing) {
    cubey.x = mx - coffset.x;
    cubey.y = my - coffset.y;
    if (!md) {
      grabbing = false;
      cubey.mx = mx - prev.x;
      cubey.my = my - prev.y;
    }
  } else {
    cubey.my += 0.5;
  }




  ctx.fillStyle = "rgb(10, 70, 5)";
  ctx.fillRect((cubey.x - 15 + 305) * sf, (cubey.y - 15 + 405) * sf, 30 * sf, 30 * sf);




  prev.x = mx;
  prev.y = my;




  //buttons
  
  ctx.fillStyle = "rgb(30, 130, 10)";
  ctx.fillRect(165 * sf, 445 * sf, 60 * sf, 30 * sf);
  ctx.fillRect(235 * sf, 445 * sf, 60 * sf, 30 * sf);
  ctx.fillRect(435 * sf, 405 * sf, 45 * sf, 75 * sf);
  
  ctx.fillStyle = "rgb(0, 0, 0)";
  ctx.textAlign = "center";
  ctx.font = (18  * sf) + "px Courier New";
  ctx.fillText("Undo", 195 * sf, 465 * sf);
  ctx.fillText("Clear", 265 * sf, 465 * sf)
  ctx.strokeStyle = "rgb(0, 0, 0)";
  ctx.lineWidth = 5 * sf;
  ctx.beginPath();
  ctx.moveTo(475 * sf, 415 * sf);
  ctx.lineTo(455 * sf, 465 * sf);
  ctx.lineTo(440 * sf, 445 * sf);
  ctx.stroke();




  ctx.strokeStyle = "rgb(0, 0, 0)";
  ctx.lineWidth = 1 * sf;
  //undo button
  if (mouseInside(165 * sf, 445 * sf, 60 * sf, 30 * sf)) {
    ctx.lineWidth = 3 * sf;
    if (md) {
      currentSequence.pop();
      md = false;
    }
  }
  
  ctx.strokeRect(165 * sf, 445 * sf, 60 * sf, 30 * sf);




  ctx.lineWidth = 1 * sf;
  //clear button
  if (mouseInside(235 * sf, 445 * sf, 60 * sf, 30 * sf)) {
    ctx.lineWidth = 3 * sf;
    if (md) {
      currentSequence = []
      md = false;
    }
  }




  ctx.strokeRect(235 * sf, 445 * sf, 60 * sf, 30 * sf);




  //check mark button




  ctx.lineWidth = 1 * sf;
  if (mouseInside(435 * sf, 405 * sf, 45 * sf, 75 * sf)) {
    ctx.lineWidth = 3 * sf;
    if (md) {
      mode = "eoting";
      currentAction = 0;
      eotSequence = currentSequence;
      currentSequence = [];




    }
  }
  
  ctx.strokeRect(435 * sf, 405 * sf, 45 * sf, 75 * sf);
  //x button
 	ctx.fillStyle = "rgb(220, 40, 20)"
  ctx.fillRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
  
  ctx.strokeStyle = "rgb(0, 0, 0)"
  ctx.lineWidth = 3 * sf;
  ctx.beginPath()
  ctx.moveTo(455 * sf, 370 * sf)
  ctx.lineTo(475 * sf, 390 * sf)
  ctx.stroke()
  ctx.beginPath()
  ctx.moveTo(475 * sf, 370 * sf)
  ctx.lineTo(455 * sf, 390 * sf)
  ctx.stroke()
  ctx.lineWidth = 1 * sf
  if (mouseInside(450 * sf, 365 * sf, 30 * sf, 30 * sf)) {
  	ctx.lineWidth = 3 * sf
    if (md) {
    	mode = "none";
    }
  }
  ctx.strokeRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
  




  var eotPieces = [];
  //make list of every piece with an end of turn ability.
  for(var i = 0; i < platforms.length; i++) {
    for(var j = 0; j < platforms[i].w; j++) {
      for(var k = 0; k < platforms[i].h; k++) {
        if (platforms[i].grid[j][k].hasEot && !platforms[i].grid[j][k].hasDoneEot) {
          if (platforms[i].grid[j][k].player == activePlayer) {
            eotPieces.push(platforms[i].grid[j][k]);
          }
        }
      }
    }
  }




  seqCount1 += 0.05;
  for(var i = 0; i < eotPieces.length; i++) {
    ctx.strokeStyle = "rgb(0, " + (120 + (Math.sin(seqCount1) * 60)) + ", 0)";
    ctx.lineWidth = 3 * sf;




    var tileOffset = 5;




    ctx.strokeRect((tileOffset + (eotPieces[i].x - 1) * 25) * sf, (tileOffset + (eotPieces[i].y - 1) * 25) * sf, (25 - tileOffset * 2) * sf, (25 - tileOffset * 2) * sf);
    if (mouseInside(((eotPieces[i].x - 1) * 25) * sf, ((eotPieces[i].y - 1) * 25) * sf, 25 * sf, 25 * sf)) {
      var canBePlaced = true;
      for(var j = 0; j < currentSequence.length; j++) {
        if (currentSequence[j] == eotPieces[i]) {
          canBePlaced = false;
          break;
        }
      }
      if (md && canBePlaced) {
        currentSequence.push(eotPieces[i]);
      }
      
    }
  }
  for(var i = 0; i < currentSequence.length; i++) {
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.fillRect(((currentSequence[i].x - 1) * 25 - 8) * sf, ((currentSequence[i].y - 1) * 25 - 8) * sf, 16 * sf, 16 * sf);
    ctx.font = (16 * sf) + "px Courier New";
    ctx.fillStyle = "rgb(230, 80, 80)";
    ctx.textAlign = "center";
    ctx.fillText(i + 1, ((currentSequence[i].x - 1) * 25) * sf, ((currentSequence[i].y - 1) * 25 + 5) * sf);
  }




  /*maybe later >:3
  //mouse decal :3
  ctx.strokeStyle = "rgb(140, 0, 0)";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(mx, my);
  ctx.lineTo(mx, my + 12)
  ctx.lineTo(mx + 4, my + 12);
  ctx.lineTo(mx + 6, my + 10);
  ctx.lineTo(mx, my);
  ctx.stroke();
  */
};




//x = 0, y = 0 = centered.
var drawIcon = function(icon, x, y) {
  if (icon == "pipe") {
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.fillRect((x - 10) * sf, (y - 4) * sf, 20 * sf, 8 * sf);
  } else if (icon == "chest") {
    ctx.fillStyle = "rgb(20, 40, 170)";
    ctx.fillRect((x - 10) * sf, (y - 10) * sf, 20 * sf, 20 * sf);
    ctx.lineWidth = 1 * sf;
    ctx.strokeStyle = "rgb(160, 160, 160)";
    ctx.strokeRect((x - 10) * sf, (y - 10) * sf, 20 * sf, 20 * sf);
    ctx.fillStyle = "rgb(160, 160, 160)";
    ctx.fillRect((x - 4) * sf, (y - 2) * sf, 8 * sf, 4 * sf);
  } else if (icon == "generator") {
    ctx.fillStyle = "rgb(255, 100, 0)";
    ctx.fillRect((x - 10) * sf, (y - 10) * sf, 20 * sf, 20 * sf);
    ctx.strokeStyle = "rgb(40, 40, 40)";
    ctx.lineWidth = 1 * sf;
    ctx.strokeRect((x - 10) * sf, (y - 10) * sf, 20 * sf, 20 * sf);
    ctx.beginPath();
    ctx.moveTo((x - 3.33) * sf, (y - 10) * sf);
    ctx.lineTo((x - 3.33) * sf, (y + 10) * sf);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo((x + 3.33) * sf, (y - 10) * sf);
    ctx.lineTo((x + 3.33) * sf, (y + 10) * sf);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo((x - 10) * sf, y * sf);
    ctx.lineTo((x + 10) * sf, y * sf);
    ctx.stroke();
  } else if (icon == "devastator") {
    ctx.fillStyle = "rgb(70, 40, 160)";
    ctx.fillRect((x - 10) * sf, (y - 10) * sf, 20 * sf, 20 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.beginPath();
    ctx.moveTo((x - 10) * sf, (y - 10) * sf);
    ctx.lineTo((x + 10) * sf, (y - 10) * sf);
    ctx.lineTo(x * sf, y * sf);
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo((x - 10) * sf, (y + 10) * sf);
    ctx.lineTo((x - 5) * sf, (y + 10) * sf);
    ctx.lineTo((x - 5) * sf, (y + 4) * sf);
    ctx.lineTo((x - 10) * sf, (y - 2) * sf);
    ctx.fill();
    ctx.moveTo((x + 10) * sf, (y + 10) * sf);
    ctx.lineTo((x + 5) * sf, (y + 10) * sf);
    ctx.lineTo((x + 5) * sf, (y + 4) * sf);
    ctx.lineTo((x + 10) * sf, (y - 2) * sf);
    ctx.fill();
    ctx.fillStyle = "rgb(0, 0, 230)";
    ctx.beginPath();
    ctx.moveTo((x - 6) * sf, (y - 10) * sf);
    ctx.lineTo((x + 6) * sf, (y - 10) * sf);
    ctx.lineTo(x * sf, (y - 6) * sf);
    ctx.fill();
    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.lineWidth = 3 * sf;
    ctx.beginPath();
    ctx.moveTo(x * sf, (y + 10) * sf);
    ctx.lineTo(x * sf, y * sf);
    ctx.stroke();
  } else if (icon == "harvester") {
    ctx.fillStyle = "rgb(170, 40, 0)";
    ctx.fillRect((x - 9.5) * sf, (y - 9.5) * sf, 19 * sf, 19 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.fillRect((x - 5) * sf, (y - 9.5) * sf, 10 * sf, 3 * sf)
    ctx.fillStyle = "rgb(200, 200, 200)";
    ctx.beginPath();
    ctx.moveTo((x + Math.sin(0) * 10) * sf, (y + Math.sin(0) * 10) * sf);
    for(var i = 0; i < 16; i++) {
      ctx.lineTo((x + Math.cos(i * Math.PI / 4 - Math.PI / 8) * 4) * sf, (y + Math.sin(i * Math.PI / 4 - Math.PI / 8) * 4) * sf);
      ctx.lineTo((x + Math.cos(i * Math.PI / 4) * 10) * sf, (y + Math.sin(i * Math.PI / 4) * 10) * sf);
    }
    ctx.fill();
    ctx.fillStyle = "rgb(80, 80, 80)";
    ctx.beginPath();
    ctx.arc(x * sf, y * sf, 2 * sf, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (icon == "appraiser") {
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.fillRect((x - 9.5) * sf, (y + 3.5) * sf, 19 * sf, 9 * sf);
    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.lineWidth = 2 * sf;
    ctx.strokeRect((x - 9.5) * sf, (y - 9.5) * sf, 19 * sf, 12 * sf);
    ctx.fillStyle = "rgba(120, 200, 230, 0.4)";
    ctx.fillRect((x - 9.5) * sf, (y - 9.5) * sf, 19 * sf, 12 * sf);
  } else if (icon == "chipper") {
    ctx.fillStyle = "rgb(150, 150, 150)";
    ctx.fillRect((x - 8.5) * sf, (y - 8.5) * sf, 17 * sf, 17 * sf);
    ctx.strokeStyle = "rgb(255, 40, 30)";
    ctx.lineWidth = 2 * sf;
    ctx.beginPath();
    ctx.moveTo((x - 8.5) * sf, (y - 8.5) * sf);
    ctx.lineTo((x + 9.5) * sf, (y + 9.5) * sf);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo((x + 9.5) * sf, (y - 8.5) * sf);
    ctx.lineTo((x - 8.5) * sf, (y + 9.5) * sf);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo((x - 4.5) * sf, (y - 8.5) * sf);
    ctx.lineTo((x + 9.5) * sf, (y + 5.5) * sf);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo((x + 5.5) * sf, (y - 8.5) * sf);
    ctx.lineTo((x - 8.5) * sf, (y + 5.5) * sf);
    ctx.stroke();
    ctx.strokeStyle = "rgb(60, 60, 60)";
    ctx.strokeRect((x - 8.5) * sf, (y - 8.5) * sf, 17 * sf, 17 * sf);
    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.lineWidth = 2 * sf;
    ctx.beginPath();
    ctx.moveTo((x - 8.5) * sf, (y - 8.5) * sf);
    ctx.lineTo((x - 3.5) * sf, (y - 13.5) * sf);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo((x + 8.5) * sf, (y - 8.5) * sf);
    ctx.lineTo((x + 3.5) * sf, (y - 13.5) * sf);
    ctx.stroke();
  } else if (icon == "cannon") {
    ctx.strokeStyle = "rgb(60, 60, 60)";
    ctx.lineWidth = 9 * sf;
    var angle = Math.PI * -0.75;
    ctx.beginPath();
    ctx.moveTo((x) * sf, (y) * sf);
    ctx.lineTo((x + Math.cos(angle) * 14) * sf, (y + Math.sin(angle) * 14) * sf);
    ctx.stroke();
    
    ctx.fillStyle = "rgb(100, 100, 100)";
    ctx.beginPath();
    ctx.arc((x) * sf, (y) * sf, 8 * sf, 0, Math.PI * 2, false);
    ctx.fill();
  } else if (icon == "jumper") {
    ctx.fillStyle = "rgb(220, 120, 0)";
    var a = Math.PI * -0.5;
    ctx.beginPath();
    ctx.moveTo((x + Math.cos(a) * 10) * sf, (y + Math.sin(a) * 10) * sf);
    a += Math.PI / 1.5;
    ctx.lineTo((x + Math.cos(a) * 10) * sf, (y + Math.sin(a) * 10) * sf);
    a += Math.PI / 1.5;
    ctx.lineTo((x + Math.cos(a) * 10) * sf, (y + Math.sin(a) * 10) * sf);
    ctx.fill();
  } else if (icon == "drill s") {
    ctx.fillStyle = "rgb(0, 80, 0)";
    ctx.beginPath();
    ctx.moveTo((x - 12.5) * sf, (y - 12.5) * sf);
    ctx.lineTo((x + 12.5) * sf, (y - 12.5) * sf);
    ctx.lineTo((x + 12.5) * sf, (y + 12.5) * sf);
    ctx.lineTo((x - 12.5) * sf, (y + 12.5) * sf);
    ctx.lineTo((x - 12.5) * sf, (y - 12.5) * sf);
    ctx.arc(x * sf, y * sf, 9 * sf, 0, Math.PI * 2, false);
    ctx.fill();
      
    ctx.fillStyle = "rgb(130, 130, 130)";
    ctx.beginPath()
    ctx.arc(x * sf, y * sf, 9 * sf, 0, Math.PI * 2, false);
    ctx.fill();




    ctx.strokeStyle = "rgb(30, 30, 30)";
    ctx.lineWidth = 1.5 * sf;
    var a = 0;
    ctx.beginPath();
    ctx.moveTo((x + Math.cos(a) * 9) * sf, (y + Math.sin(a) * 9) * sf);
    for(var going = 0; going < 16; going ++) {
      a += Math.PI / 4;
      ctx.lineTo((x + Math.cos(a) * (9 - going / 2)) * sf, (y + Math.sin(a) * (9 - going / 2)) * sf);
    }
    ctx.stroke();
  } else if (icon == "smelter") {
    x -= 12.5;
    y -= 12.5;
    ctx.fillStyle = "rgb(220, 150, 80)";
    ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
    ctx.strokeStyle = "rgb(110, 75, 40)";
    ctx.lineWidth = 2 * sf;
    ctx.beginPath();
    ctx.moveTo(x * sf, y * sf);
    ctx.lineTo((x + 25) * sf, y * sf);
    ctx.lineTo((x + 25) * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, (y + 25) * sf);
    ctx.lineTo(x * sf, y * sf);
    ctx.stroke();
    ctx.fillStyle = "rgb(120, 120, 120)";
    ctx.beginPath();
    ctx.moveTo((x + 5) * sf, (y + 16) * sf);
    ctx.lineTo((x + 8) * sf, (y - 10) * sf);
    ctx.lineTo((x + 17) * sf, (y - 10) * sf);
    ctx.lineTo((x + 20) * sf, (y + 16) * sf);
    ctx.fill();
    ctx.strokeStyle = "rgb(60, 35, 20)";
    ctx.lineWidth = 1.5 * sf;
    ctx.beginPath();
    ctx.moveTo((x + 5) * sf, (y + 16) * sf);
    ctx.lineTo((x + 8) * sf, (y - 10) * sf);
    ctx.lineTo((x + 17) * sf, (y - 10) * sf);
    ctx.lineTo((x + 20) * sf, (y + 16) * sf);
    ctx.stroke();
    ctx.fillStyle = "rgb(20, 20, 20)";
    ctx.beginPath();
    ctx.ellipse((x + 12.5) * sf, (y - 10) * sf, 4.5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
    ctx.fill();
    ctx.beginPath();
    ctx.ellipse((x + 12.5) * sf, (y - 10) * sf, 4.5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
    ctx.stroke();
  } else if (icon == "piercer") {
    x -= 12.5;
    y -= 12.5;
    ctx.fillStyle = "rgb(180, 180, 180)";
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 23) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 23) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 13) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(20, 30, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 8.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 5) * sf);
        ctx.lineTo((x + 2) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 16.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 5) * sf);
        ctx.lineTo((x + 23) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.fillStyle = "rgb(200, 200, 255)";
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 4) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 2) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 4) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 8) * sf);
        ctx.lineTo((x + 23) * sf, (y + 8) * sf);
        ctx.fill();
        ctx.strokeStyle = "rgb(130, 230, 255)";
        ctx.lineWidth = 2 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 7.25) * sf, (y + 2) * sf);
        ctx.lineTo((x + 7.25) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo((x + 17.75) * sf, (y + 2) * sf);
        ctx.lineTo((x + 17.75) * sf, (y + 12) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 17) * sf);
        ctx.stroke();
        ctx.strokeStyle = "rgb(100, 130, 230)";
        ctx.lineWidth = 3 * sf;
        ctx.beginPath();
        ctx.moveTo((x + 12.5) * sf, (y + 23) * sf);
        ctx.lineTo((x + 12.5) * sf, (y + 2) * sf);
        ctx.stroke();
  } else if (icon == "alpha ray") {
    x -= 12.5;
    y -= 12.5;
    ctx.fillStyle = "rgb(150, 0, 0)";
      var a = Math.PI * -0.5;
      ctx.beginPath();
      ctx.arc((x + 12.5 - Math.cos(a) * 1.5) * sf, (y + 12.5 - Math.sin(a) * 1.5) * sf, 9 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(255, 50, 20)";
      ctx.font = (20 * sf) + "px Georgia";
      ctx.textAlign = "center";
      ctx.fillText("", (x + 12.5 - Math.cos(a) * 1.5) * sf, (y + 16.5 - Math.sin(a) * 1.5) * sf);




      ctx.fillStyle = "rgb(120, 120, 120)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 8 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 8 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 8 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 8 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 9.5 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 9.5 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 12 + Math.cos(a + Math.PI * -0.5) * 4) * sf, (y + 12.5 + Math.sin(a) * 12 + Math.sin(a + Math.PI * -0.5) * 4) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 13.5 + Math.cos(a + Math.PI * -0.5) * 1.5) * sf, (y + 12.5 + Math.sin(a) * 13.5 + Math.sin(a + Math.PI * -0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 11.5 + Math.cos(a + Math.PI * -0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 11.5 + Math.sin(a + Math.PI * -0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10 + Math.cos(a + Math.PI * -0.5) * 1) * sf, (y + 12.5 + Math.sin(a) * 10 + Math.sin(a + Math.PI * -0.5) * 1) * sf);
      ////////////////////////////////////////////////////////////////////
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10 + Math.cos(a + Math.PI * 0.5) * 1) * sf, (y + 12.5 + Math.sin(a) * 10 + Math.sin(a + Math.PI * 0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 11.5 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 11.5 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 13.5 + Math.cos(a + Math.PI * 0.5) * 1.5) * sf, (y + 12.5 + Math.sin(a) * 13.5 + Math.sin(a + Math.PI * 0.5) * 1) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 12 + Math.cos(a + Math.PI * 0.5) * 4) * sf, (y + 12.5 + Math.sin(a) * 12 + Math.sin(a + Math.PI * 0.5) * 4) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 9.5 + Math.cos(a + Math.PI * 0.5) * 2) * sf, (y + 12.5 + Math.sin(a) * 9.5 + Math.sin(a + Math.PI * 0.5) * 2) * sf);
      ctx.fill();
      ctx.fillStyle = "rgb(200, 0, 0)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 12) * sf, (y + 12.5 + Math.sin(a) * 12) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(250, 0, 0)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 14) * sf, (y + 12.5 + Math.sin(a) * 14) * sf, 1.5 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.fillStyle = "rgb(255, 90, 50)";
      ctx.beginPath();
      ctx.arc((x + 12.5 + Math.cos(a) * 16) * sf, (y + 12.5 + Math.sin(a) * 16) * sf, 1 * sf, 0, Math.PI * 2, false);
      ctx.fill();
  } else if (icon == "mosquito") {
    x -= 12.5;
    y -= 12.5;
    var a = Math.PI * -0.5;
      ctx.fillStyle = "rgb(200, 0, 0)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * -0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * -0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * 0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.5) * 8) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -10) * sf, (y + 12.5 + Math.sin(a) * -10) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(50, 50, 50)";
      ctx.lineWidth = 1 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * -0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * -0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a + Math.PI * 0.5) * 8) * sf, (y + 12.5 + Math.sin(a + Math.PI * 0.5) * 8) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5) * sf);
      ctx.stroke();
      ctx.strokeStyle = "rgb(255, 255, 255)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 3.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -10) * sf, (y + 12.5 + Math.sin(a) * -10) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 3.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 3.5) * sf);
      ctx.stroke();




      ctx.fillStyle = "rgb(180, 180, 180)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(80, 80, 80)";
      ctx.lineWidth = 1.6 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * -5.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * -5.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.stroke();
      ctx.fillStyle = "rgb(80, 80, 80)";
      if (this.armed) {
        ctx.fillStyle = "rgb(200, 0, 0)";
      }
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10.5) * sf, (y + 12.5 + Math.sin(a) * 10.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * 0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * 0.5) * 2.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * 0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * 0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 10.5) * sf, (y + 12.5 + Math.sin(a) * 10.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 7.5 + Math.cos(a + Math.PI * -0.5) * 4.5) * sf, (y + 12.5 + Math.sin(a) * 7.5 + Math.sin(a + Math.PI * -0.5) * 4.5) * sf);
      ctx.lineTo((x + 12.5 + Math.cos(a) * 4.5 + Math.cos(a + Math.PI * -0.5) * 2.5) * sf, (y + 12.5 + Math.sin(a) * 4.5 + Math.sin(a + Math.PI * -0.5) * 2.5) * sf);
      ctx.stroke();
  } else if (icon == "artillery") {
    x -= 12.5;
    y -= 12.5;
    x *= 2;
    y *= 2;
    sf /= 2;
    ctx.strokeStyle = "rgb(80, 80, 80)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 3) * sf, (y + 5) * sf);
      ctx.lineTo((x + 25) * sf, (y + 2) * sf);
      ctx.lineTo((x + 47) * sf, (y + 5) * sf);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 8) * sf, (y + 37) * sf);
      ctx.lineTo((x + 25) * sf, (y + 30) * sf);
      ctx.lineTo((x + 42) * sf, (y + 37) * sf);
      ctx.stroke();
      ctx.fillStyle = "rgb(100, 100, 100)";
      ctx.beginPath();
      ctx.moveTo((x + 13) * sf, (y + 25) * sf);
      ctx.lineTo((x + 20) * sf, (y + 37) * sf);
      ctx.lineTo((x + 20) * sf, (y + 45) * sf);
      ctx.lineTo((x + 30) * sf, (y + 45) * sf);
      ctx.lineTo((x + 30) * sf, (y + 37) * sf);
      ctx.lineTo((x + 37) * sf, (y + 25) * sf);
      ctx.lineTo((x + 30) * sf, (y - 10) * sf);
      ctx.lineTo((x + 20) * sf, (y - 10) * sf);
      ctx.fill();
      ctx.fillStyle = "rgb(60, 60, 60)";
      ctx.beginPath();
      ctx.moveTo((x + 20) * sf, (y - 10) * sf);
      ctx.lineTo((x + 25) * sf, (y - 10) * sf);
      ctx.lineTo((x + 13) * sf, (y + 25) * sf);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo((x + 30) * sf, (y - 10) * sf);
      ctx.lineTo((x + 25) * sf, (y - 10) * sf);
      ctx.lineTo((x + 37) * sf, (y + 25) * sf);
      ctx.fill();
      ctx.fillStyle = "rgb(40, 40, 40)";
      ctx.beginPath();
      ctx.ellipse((x + 25) * sf, (y - 10) * sf, 5 * sf, 3 * sf, 0, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(60, 60, 60)";
      ctx.lineWidth = 1.5 * sf;
      ctx.beginPath();
      ctx.ellipse((x + 25) * sf, (y - 10) * sf, 4.5 * sf, 2.5 * sf, 0, 0, Math.PI * 2, false);
      ctx.stroke();
      ctx.fillStyle = "rgb(75, 75, 75)";
      ctx.beginPath();
      ctx.moveTo((x + 18) * sf, (y + 25) * sf);
      ctx.lineTo((x + 32) * sf, (y + 25) * sf);
      ctx.lineTo((x + 27) * sf, (y + 8) * sf);
      ctx.lineTo((x + 23) * sf, (y + 8) * sf);
      ctx.fill();
      //wheels
      ctx.fillStyle = "rgb(130, 50, 0)";
      ctx.fillRect((x + 11) * sf, (y + 13) * sf, 4 * sf, 16 * sf);
      ctx.fillRect((x + 35) * sf, (y + 13) * sf, 4 * sf, 16 * sf);
      ctx.beginPath();
      ctx.arc((x + 13) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 13) * sf, (y + 29) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 37) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.beginPath();
      ctx.arc((x + 37) * sf, (y + 29) * sf, 2 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(60, 20, 0)";
      ctx.lineWidth = 1 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 11) * sf, (y + 13) * sf);
      ctx.lineTo((x + 11) * sf, (y + 29) * sf);
      ctx.arc((x + 13) * sf, (y + 29) * sf, 2 * sf, Math.PI, 0, true);
      ctx.lineTo((x + 15) * sf, (y + 13) * sf);
      ctx.arc((x + 13) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI, true);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((x + 35) * sf, (y + 13) * sf);
      ctx.lineTo((x + 35) * sf, (y + 29) * sf);
      ctx.arc((x + 37) * sf, (y + 29) * sf, 2 * sf, Math.PI, 0, true);
      ctx.lineTo((x + 39) * sf, (y + 13) * sf);
      ctx.arc((x + 37) * sf, (y + 13) * sf, 2 * sf, 0, Math.PI, true);
      ctx.stroke();
      sf *= 2;
  } else if (icon == "drill m") {
    x -= 12.5;
    y -= 12.5;
    ctx.fillStyle = "rgb(190, 195, 175)";
      ctx.fillRect(x * sf, y * sf, 25 * sf, 25 * sf);
      ctx.fillStyle = "rgb(160, 170, 140)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(40, 40, 40)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.stroke();




      ctx.lineWidth = 1 * sf;
      ctx.strokeStyle = "rgb(20, 20, 20)";
      ctx.beginPath();
      var a = 0;
      for(var gong = 0; gong < 16; gong ++) {
        var interior = 10 + gong * -0.625;
        if (gong == 0) {
          ctx.moveTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        }
        ctx.lineTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        a += Math.PI * 0.25;
      }
      ctx.stroke();
      ctx.beginPath();
      var a = Math.PI;
      for(var gong = 0; gong < 16; gong ++) {
        var interior = 10 + gong * -0.625;
        if (gong == 0) {
          ctx.moveTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        }
        ctx.lineTo((x + 12.5 + Math.cos(a) * interior) * sf, (y + 12.5 + Math.sin(a) * interior) * sf);
        a += Math.PI * 0.25;
      }
      ctx.stroke();
  } else if (icon == "passive healer") {
    x -= 12.5;
    y -= 12.5;
    ctx.fillStyle = "rgb(200, 200, 200)";
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.fill();
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.arc((x + 12.5) * sf, (y + 12.5) * sf, 10 * sf, 0, Math.PI * 2, false);
      ctx.stroke();
      ctx.strokeStyle = "rgb(255, 0, 0)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 7) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 18) * sf);
      ctx.moveTo((x + 7) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 18) * sf, (y + 12.5) * sf);
      ctx.stroke();
  } else if (icon == "alloy healer") {
    x -= 12.5;
    y -= 12.5;
    ctx.fillStyle = "rgb(130, 130, 130)";
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 22) * sf);
      ctx.lineTo((x + 3) * sf, (y + 12.5) * sf);
      ctx.fill();
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 2 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 3) * sf);
      ctx.lineTo((x + 22) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 22) * sf);
      ctx.lineTo((x + 3) * sf, (y + 12.5) * sf);
      ctx.stroke();
      ctx.strokeStyle = "rgb(255, 0, 0)";
      ctx.lineWidth = 4 * sf;
      ctx.beginPath();
      ctx.moveTo((x + 12.5) * sf, (y + 7) * sf);
      ctx.lineTo((x + 12.5) * sf, (y + 18) * sf);
      ctx.moveTo((x + 7) * sf, (y + 12.5) * sf);
      ctx.lineTo((x + 18) * sf, (y + 12.5) * sf);
      ctx.stroke();
  }
}




//player.shopPool
var shopPage = 1;
var showingInfo = false;
var hasMadePlatform = false;
var tempPlat = new platform(6, 1, 12, 12, "imaginary");
var actionList = [];
var actionCd = 0;
var currentAction = 0;
var drawingEot = false;
var drawingAction = false;
var infoXOffset = 0;
var infoYOffset = 0;
var displayInfo = function(type) {
  if (type == "pipe") {
    ctx.fillStyle = "rgb(170, 170, 170)";
    ctx.fillRect(160 * sf, 405 * sf, 330 * sf, 85 * sf);
    ctx.fillStyle = "rgb(255, 30, 20)";
    ctx.fillRect(225 * sf, 75 * sf, 112.5 * sf, 12.5 * sf);
    ctx.fillRect(225 * sf, 187.5 * sf, 125* sf, 12.5 * sf);
    ctx.fillRect(225 * sf, 75 * sf, 12.5 * sf, 112.5 * sf);
    ctx.fillRect(337.5 * sf, 75 * sf, 12.5 * sf, 125 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("Pipe info: 2HP, Tier 0, 10 scrap.", 170 * sf, 425 * sf);
    ctx.fillText("One of the basic components of", 170 * sf, 445 * sf);
    ctx.fillText("the game. Used to transport items", 170 * sf, 460 * sf);
    ctx.fillText("between pieces. Use efficiently.", 170 * sf, 475 * sf);

    if (drawingEot) {
      var a = actionList[currentAction - 1];
      tempPlat.grid[a.x - 11][a.y - 5].eotDraw(a.x * 25 - 25, a.y * 25 - 25);
    }
    if (!hasMadePlatform) {
      infoXOffset = 11;
      infoYOffset = 5;
      tempPlat = new platform(10, 4, 3, 3, "imaginary");
      platforms.push(tempPlat);
      hasMadePlatform = true;
      //"straight", "lturn", "rturn", "2meetcenter", "2meetl", "2meetr", "3meet", "end"
      actionList = [{action: "place", type: "p1 base storage", variant: 1, direction: "up", x: 12, y: 7, cd: 4},
      {action: "place", type: "p1 base info", variant: 1, direction: "up", x: 13, y: 7, cd: 4},
       {action: "place", type: "chest", variant: 1, direction: "up", x: 11, y: 5, cd: 40},
       {action: "place", type: "pipe", variant: 3, direction: "right", x: 12, y: 5, cd: 15},
       {action: "place", type: "pipe", variant: 1, direction: "down", x: 12, y: 6, cd: 30},
       {action: "end turn", x: 12, y: 5, cd: 15},
       {action: "end turn", x: 12, y: 6, cd: 15},
       {action: "wait", cd: 30}];
      currentAction = 0;
    }
  } else if (type == "chest") {
    ctx.fillStyle = "rgb(170, 170, 170)";
    ctx.fillRect(160 * sf, 405 * sf, 330 * sf, 85 * sf);
    ctx.fillStyle = "rgb(255, 30, 20)";
    ctx.fillRect(225 * sf, 50 * sf, 112.5 * sf, 12.5 * sf);
    ctx.fillRect(225 * sf, 187.5 * sf, 125* sf, 12.5 * sf);
    ctx.fillRect(225 * sf, 50 * sf, 12.5 * sf, 150 * sf);
    ctx.fillRect(337.5 * sf, 50 * sf, 12.5 * sf, 150 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("Chest info: 4HP, Tier 1, 25 scrap.", 163 * sf, 425 * sf);
    ctx.fillText("Can store up to 5 items. Useful", 170 * sf, 445 * sf);
    ctx.fillText("for storing gold and alloys.", 170 * sf, 460 * sf);
    if (!hasMadePlatform) {
      infoXOffset = 11;
      infoYOffset = 4;
      tempPlat = new platform(10, 3, 3, 4, "imaginary");
      platforms.push(tempPlat);
      hasMadePlatform = true;
      //"straight", "lturn", "rturn", "2meetcenter", "2meetl", "2meetr", "3meet", "end"
      actionList = [{action: "place", type: "rock", variant: 1, direction: "up", x: 13, y: 5, cd: 4},
      {action: "place", type: "chest", variant: 1, direction: "up", x: 12, y: 7, cd: 20},
      {action: "place", type: "harvester", variant: 1, direction: "right", x: 12, y: 5, cd: 15},
       {action: "place", type: "generator", variant: 1, direction: "up", x: 11, y: 6, cd: 25},
       {action: "place", type: "pipe", variant: 3, direction: "up", x: 11, y: 5, cd: 10},
       {action: "place", type: "pipe", variant: 1, direction: "down", x: 12, y: 6, cd: 40},
       {action: "end turn", x: 11, y: 6, cd: 15},
       {action: "end turn", x: 11, y: 5, cd: 15},
       {action: "end turn", x: 12, y: 5, cd: 15},
       {action: "end turn", x: 12, y: 6, cd: 15},
       {action: "wait", cd: 30},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 11, finalY: 5, height: -100, secondaryDmg: 1}, cd: 2},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 12, finalY: 5, height: -100, secondaryDmg: 1}, cd: 2},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 13, finalY: 5, height: -100, secondaryDmg: 1}, cd: 2},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 11, finalY: 6, height: -100, secondaryDmg: 1}, cd: 2},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 12, finalY: 6, height: -100, secondaryDmg: 1}, cd: 2},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 13, finalY: 6, height: -100, secondaryDmg: 1}, cd: 2},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 11, finalY: 7, height: -100, secondaryDmg: 1}, cd: 2},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 12, finalY: 7, height: -100, secondaryDmg: 1}, cd: 2},
       {action: "projectile", type: "artillery shell", x: 13, y: 5, dmg: 2, other: {finalX: 13, finalY: 7, height: -100, secondaryDmg: 1}, cd: 45},
       {action: "place", type: "p1 base storage", variant: 1, direction: "up", x: 12, y: 7, cd: 4},
       {action: "place", type: "p1 base info", variant: 1, direction: "up", x: 13, y: 7, cd: 12},
       {action: "place", type: "generator", variant: 1, direction: "up", x: 13, y: 5, cd: 4},
       {action: "place", type: "generator", variant: 1, direction: "up", x: 11, y: 5, cd: 12},
       {action: "place", type: "pipe", variant: 2, direction: "up", x: 13, y: 4, cd: 4},
       {action: "place", type: "pipe", variant: 3, direction: "up", x: 11, y: 4, cd: 12},
       {action: "place", type: "alpha ray", variant: 1, direction: "down", x: 12, y: 4, cd: 30},
       {action: "end turn", x: 13, y: 5, cd: 15},
       {action: "end turn", x: 13, y: 4, cd: 15},
       {action: "end turn", x: 11, y: 5, cd: 15},
       {action: "end turn", x: 11, y: 4, cd: 15},
       {action: "end turn", x: 12, y: 4, cd: 15},
       {action: "wait", cd: 30},
       {action: "place", type: "chest", x: 12, y: 6, cd: 25},
       {action: "action", x: 12, y: 4, cd: 120},
       {action: "wait", cd: 30}
       ];
      currentAction = 0;
    }
  } else if (type == "generator") {
    ctx.fillStyle = "rgb(170, 170, 170)";
    ctx.fillRect(160 * sf, 405 * sf, 330 * sf, 85 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("Generator: 3HP, Tier 0, 30 scrap.", 163 * sf, 425 * sf);
    ctx.fillText("One of the most useful tier 0", 170 * sf, 445 * sf);
    ctx.fillText("items. Produces 1 energy per", 170 * sf, 460 * sf);
    ctx.fillText("turn. Can auto-output.", 170 * sf, 475 * sf);
  } else if (type == "devastator") {
    ctx.fillStyle = "rgb(170, 170, 170)";
    ctx.fillRect(160 * sf, 405 * sf, 330 * sf, 85 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("Devast.: 5HP, Tier 1, 45 scrap.", 163 * sf, 425 * sf);
    ctx.fillText("The first heavy hitter. Consumes", 170 * sf, 445 * sf);
    ctx.fillText("3 energy to shoot a beam 8 tiles", 170 * sf, 460 * sf);
    ctx.fillText("ahead. 3 dmg, inf pierce.", 170 * sf, 475 * sf);
  } else if (type == "harvester") {
    ctx.fillStyle = "rgb(170, 170, 170)";
    ctx.fillRect(160 * sf, 405 * sf, 330 * sf, 85 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("Harvester: 4HP, Tier 1, 40 scrap.", 163 * sf, 425 * sf);
    ctx.fillText("@EOT: spend 1 energy to harvest", 170 * sf, 445 * sf);
    ctx.fillText("1 resource from the tile in front.", 170 * sf, 460 * sf);
    ctx.fillText("Can auto-output.", 170 * sf, 475 * sf);
  } else if (type == "appraiser") {
    ctx.fillStyle = "rgb(170, 170, 170)";
    ctx.fillRect(160 * sf, 405 * sf, 330 * sf, 85 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("App. info: 3HP, Tier 1, 35 scrap.", 163 * sf, 425 * sf);
    ctx.fillText("When an item is inside, it will", 170 * sf, 445 * sf);
    ctx.fillText("generate scrap at end of turn", 170 * sf, 460 * sf);
    ctx.fillText("based on the item's value.", 170 * sf, 475 * sf);
  } else if (type == "chipper") {
    ctx.fillStyle = "rgb(170, 170, 170)";
    ctx.fillRect(160 * sf, 405 * sf, 330 * sf, 85 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("Chipper: 2HP, Tier 0, 25 scrap.", 163 * sf, 425 * sf);
    ctx.fillText("When activated, uses one energy", 170 * sf, 445 * sf);
    ctx.fillText("to shoot a 1 damage laser with", 170 * sf, 460 * sf);
    ctx.fillText("3 tiles of range. Not great.", 170 * sf, 475 * sf);
  } else if (type == "cannon") {
    ctx.fillStyle = "rgb(100, 170, 220)";
    ctx.fillRect(160 * sf, 405 * sf, 330 * sf, 85 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("Cannon: 3HP, Tier 2, 45 scrap.", 163 * sf, 425 * sf);
    ctx.fillText("Consumes one stone to shoot a", 170 * sf, 445 * sf);
    ctx.fillText("2 damage cannonball. Can only", 170 * sf, 460 * sf);
    ctx.fillText("fire diagonally.", 170 * sf, 475 * sf);
  }
  if (drawingEot) {
    var a = actionList[currentAction - 1];
    tempPlat.grid[a.x - infoXOffset][a.y - infoYOffset].eotDraw(a.x * 25 - 25, a.y * 25 - 25);
  }
  if (drawingAction) {
    var a = actionList[currentAction - 1];
    tempPlat.grid[a.x - infoXOffset][a.y - infoYOffset].actionDraw(a.cd - actionCd, a.x * 25 - 25, a.y * 25 - 25, true);
  }
  if (actionCd <= 0) {
    if (currentAction >= actionList.length) {
      resetInfo(20);
    } else {
      var a = actionList[currentAction];
      actionCd = a.cd;
      if (a.action == "place") {
        if (tempPlat) {
          var p = new piece(a.x, a.y, a.type, a.variant, a.direction, "not applicable", "imaginary");
          tempPlat.grid[a.x - infoXOffset][a.y - infoYOffset] = p;
        }
      } else if (a.action == "projectile") {
        projs.push(new proj(a.x, a.y, a.dmg, a.type, "imaginary", a.other));
      }
      if (a.action == "end turn") {
        drawingEot = true;
      } else if (drawingEot) {
        drawingEot = false;
        tempPlat.grid[actionList[currentAction - 1].x - infoXOffset][actionList[currentAction - 1].y - infoYOffset].eot();
      }
      if (a.action == "action") {
        if (!drawingAction) {
          tempPlat.grid[a.x - infoXOffset][a.y - infoYOffset].action();
          drawingAction = true;
        }
      } else if (drawingAction) {
        drawingAction = false;
      }
      currentAction ++;
    }
  }
  actionCd --;
};

var resetInfo = function(amount) {
  actionCd = amount;
  currentAction = 0;
  hasMadePlatform = false;
  drawingEot = false;
  drawingAction = false;
  actionList = [];
  for(var dick = 0; dick < platforms.length; dick ++) {
    if (platforms[dick].level == "imaginary") {
      platforms.splice(dick, 1);
      dick --;
    }
  }
}
var currentInfo = 0;
//index of player.shopPool
var selectedItem = 0;
var shop = function() {
  ctx.fillStyle = "rgb(160, 20, 10)";
  ctx.fillRect(155 * sf, 400 * sf, 340 * sf, 95 * sf);
  
  var p;
  var s;
  if (activePlayer == 1) {
    p = p1;
    s = p1.shopPool;
  } else {
    p = p2;
    s = p2.shopPool;
  }




  ctx.fillStyle = "rgb(150, 100, 120)";
  //info
  ctx.fillRect(160 * sf, 405 * sf, 100 * sf, 85 * sf);




  //buttons
  ctx.fillStyle = "rgb(150, 100, 120)";
  ctx.fillRect(265 * sf, 405 * sf, 30 * sf, 85 * sf);
  ctx.strokeStyle = "rgb(0, 0, 0)";
  ctx.lineWidth = 1 * sf;
  var pages = Math.ceil(s.length / 8);
  if (mouseInside(265 * sf, 405 * sf, 30 * sf, 85 * sf)) {
    ctx.lineWidth = 3 * sf;
    if (md) {
      md = false;
      if (shopPage == 1) {
        shopPage = pages;
      } else {
        shopPage --;
      }
    }
  }
  ctx.strokeRect(265 * sf, 405 * sf, 30 * sf, 85 * sf);




  ctx.fillStyle = "rgb(150, 100, 120)";
  ctx.fillRect(460 * sf, 405 * sf, 30 * sf, 85 * sf);
  ctx.strokeStyle = "rgb(0, 0, 0)";
  ctx.lineWidth = 1 * sf;
  if (mouseInside(460 * sf, 405 * sf, 30 * sf, 85 * sf)) {
    ctx.lineWidth = 3 * sf;
    if (md) {
      md = false;
      if (shopPage == pages) {
        shopPage = 1;
      } else {
        shopPage ++;
      }
    }
  }
  ctx.strokeRect(460 * sf, 405 * sf, 30 * sf, 85 * sf);




  for(var i = 0; i < 4; i++) {
    for(var j = 0; j < 2; j++) {
      if (s.length > (i + (j * 4) + (shopPage - 1) * 8)) {
        ctx.fillStyle = "rgb(150, 100, 120)";
        ctx.fillRect((300 + i * 40) * sf, (410 + j * 40) * sf, 35 * sf, 35 * sf);
        if ((i + (j * 4) + (shopPage - 1) * 8) == selectedItem) {
          ctx.strokeStyle = "rgb(200, 160, 30)";
          ctx.lineWidth = 2 * sf;
          ctx.strokeRect((300 + i * 40) * sf, (410 + j * 40) * sf, 35 * sf, 35 * sf);
        } else {
          ctx.strokeStyle = "rgb(40, 40, 40)";
          ctx.lineWidth = 1 * sf;
          if (mouseInside((300 + i * 40) * sf, (410 + j * 40) * sf, 35 * sf, 35 * sf)) {
            ctx.lineWidth = 2 * sf;
            ctx.strokeStyle = "rgb(0, 0, 0)";
            if (md) {
             md = false;
             selectedItem = (i + (j * 4) + (shopPage - 1) * 8);
            }
          }
          ctx.strokeRect((300 + i * 40) * sf, (410 + j * 40) * sf, 35 * sf, 35 * sf);
        }
        drawIcon(s[(i + (j * 4) + (shopPage - 1) * 8)], 317.5 + i * 40, 427.5 + j * 40);
      } else {
        ctx.fillStyle = "rgb(40, 0, 0)";
        ctx.fillRect((300 + i * 40) * sf, (410 + j * 40) * sf, 35 * sf, 35 * sf);
      }




    }
  }




  if (s[selectedItem]) {
    var tempo = {cost: 0};
    if (s[selectedItem] == "pipe") {
      tempo.cost = 10;
    } else if (s[selectedItem] == "chest") {
      tempo.cost = 25;
    } else if (s[selectedItem] == "generator") {
      tempo.cost = 30;
    } else if (s[selectedItem] == "devastator") {
      tempo.cost = 70;
    } else if (s[selectedItem] == "harvester") {
      tempo.cost = 40;
    } else if (s[selectedItem] == "appraiser") {
      tempo.cost = 35;
    } else if (s[selectedItem] == "chipper") {
      tempo.cost = 25;
    } else if (s[selectedItem] == "cannon") {
      tempo.cost = 45;
    } else if (s[selectedItem] == "jumper") {
      tempo.cost = 15;
    } else if (s[selectedItem] == "drill s") {
      tempo.cost = 50;
    } else if (s[selectedItem] == "piercer") {
      tempo.cost = 40;
    } else if (s[selectedItem] == "alpha ray") {
      tempo.cost = 35;
    } else if (s[selectedItem] == "smelter") {
      tempo.cost = 60;
    } else if (s[selectedItem] == "mosquito") {
      tempo.cost = 20;
    } else if (s[selectedItem] == "drill m") {
      tempo.cost = 90;
    } else if (s[selectedItem] == "artillery") {
      tempo.cost = 150;
    } else if (s[selectedItem] == "passive healer") {
      tempo.cost = 30;
    } else if (s[selectedItem] == "alloy healer") {
      tempo.cost = 18;
    } else if (s[selectedItem] == "firing array bp") {
      tempo.cost = 30;
    } 
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "center";
    ctx.fillText(s[selectedItem], 207.5 * sf, 420 * sf);
    ctx.font = (14 * sf) + "px Courier New";
    ctx.textAlign = "left";
    if (p.scrap < tempo.cost) {
      ctx.fillStyle = "rgb(200, 0, 0)";
    }
    ctx.fillText("Cost: " + tempo.cost, 165 * sf, 435 * sf);




    ctx.fillStyle = "rgb(180, 120, 130)";
    ctx.fillRect(165 * sf, 440 * sf, 90 * sf, 20 * sf);
    ctx.fillRect(165 * sf, 465 * sf, 90 * sf, 20 * sf);




    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (16 * sf) + "px Courier New";
    ctx.textAlign = "center";
    ctx.fillText("Info", 210 * sf, 454 * sf);
    ctx.fillText("Buy", 210 * sf, 479 * sf);




    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.lineWidth = 1 * sf;
    if (mouseInside(165 * sf, 440 * sf, 90 * sf, 20 * sf)) {
      ctx.lineWidth = 2 * sf;
      if (md) {
        md = false;
        showingInfo = true;
        currentInfo = s[selectedItem];
      }
    }
    ctx.strokeRect(165 * sf, 440 * sf, 90 * sf, 20 * sf);




    ctx.lineWidth = 1 * sf;
    if (mouseInside(165 * sf, 465 * sf, 90 * sf, 20 * sf)) {
      ctx.lineWidth = 2 * sf;
      if (md) {
        md = false;
        if (p.scrap >= tempo.cost) {
          p.scrap -= tempo.cost;
          var found = false;
          for(var i = 0; i < p.items.length; i++) {
            if (p.items[i].item == s[selectedItem]) {
              found = true;
              p.items[i].amount ++;
              break;
            }
          }
          if (!found) {
            p.items.push({item: s[selectedItem], amount: 1});
          }
        }
      }
    }
    ctx.strokeRect(165 * sf, 465 * sf, 90 * sf, 20 * sf);




  }
  if (showingInfo) {
    if (md) {
      md = false;
      showingInfo = false;
      resetInfo(0);
    } else {
      displayInfo(currentInfo);
    }
  }




  //x button
  ctx.fillStyle = "rgb(220, 40, 20)"
  ctx.fillRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
  
  ctx.strokeStyle = "rgb(0, 0, 0)"
  ctx.lineWidth = 3 * sf;
  ctx.beginPath()
  ctx.moveTo(455 * sf, 370 * sf)
  ctx.lineTo(475 * sf, 390 * sf)
  ctx.stroke()
  ctx.beginPath()
  ctx.moveTo(475 * sf, 370 * sf)
  ctx.lineTo(455 * sf, 390 * sf)
  ctx.stroke()
  ctx.lineWidth = 1 * sf
  if (mouseInside(450 * sf, 365 * sf, 30 * sf, 30 * sf)) {
  	ctx.lineWidth = 3 * sf
    if (md) {
    	mode = "none";
    }
  }
  ctx.strokeRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
};




var selectedPiece = 0;
var hasSelected = false;
var rotPieces = [];
var rotTimeRotationFunction = 0;
var rotation = function() {
  rotTimeRotationFunction ++;
  ctx.fillStyle = "rgb(140, 80, 180)";
  ctx.fillRect(155 * sf, 400 * sf, 340 * sf, 95 * sf);




  ctx.fillStyle = "rgb(0, 0, 0)";
  ctx.font = (20 * sf) + "px Courier New";
  ctx.textAlign = "left";
  ctx.fillText("Rotation menu :3", 162 * sf, 422 * sf);




  if (activePlayer == 1) {
    rl = p1.rotationsLeft;
  } else {
    rl = p2.rotationsLeft;
  }
  //}




  //if locked
  if (locked) {
  	ctx.strokeStyle = "rgb(50, 20, 65)";
    ctx.lineWidth = 2 * sf;
    ctx.strokeRect(((lock.x - 1) * 25) * sf, ((lock.y - 1) * 25) * sf, 25 * sf, 25 * sf);




    var c = false;
    for(var i = 0; i < rotPieces.length; i++) {
      if (rotPieces[i].x == lock.x && rotPieces[i].y == lock.y) {
        c = true;
        break;
      }
    }




    if (c) {
      ctx.textAlign = "left";
      ctx.font = (16 * sf) + "px Courier New";
      ctx.fillText("Rotating!! :3", 162 * sf, 445 * sf);
      ctx.fillText("Current direction: " + target.direction, 162 * sf, 463 * sf);
      var v = returnVariant(target.type);
      if (!v) {
        v = "N/A";
      } else {
        v = v[target.variant - 1];
      }
      ctx.fillText("Current variant: " + v, 162 * sf, 481 * sf);
      var ao = rotTimeRotationFunction * Math.PI * 0.015;




      ctx.fillStyle = "rgb(200, 125, 240)";
      ctx.fillRect(405 * sf, 405 * sf, 85 * sf, 85 * sf);
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 8 * sf;
      ctx.beginPath();
      ctx.arc(447.5 * sf, 447.5 * sf, 30 * sf, Math.PI * 0.25 + ao, Math.PI * 1.75 + ao, false);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo((447.5 + Math.cos(Math.PI * 1.75 + ao) * 36) * sf, (447.5 + Math.sin(Math.PI * 1.75 + ao) * 36) * sf);
      ctx.lineTo((447.5 + Math.cos(Math.PI * 1.75 + ao) * 20) * sf, (447.5 + Math.sin(Math.PI * 1.75 + ao) * 20) * sf);
      ctx.lineTo((447.5 + Math.cos(Math.PI * 1.9 + ao) * 30) * sf, (447.5 + Math.sin(Math.PI * 1.9 + ao) * 30) * sf);
      //ctx.lineTo(447.5 + Math.cos(Math.PI * 1.75) * 40, 447.5 + Math.sin(Math.PI * 1.75) * 40);
      ctx.closePath();
      ctx.stroke();
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.beginPath();
      ctx.moveTo((447.5 + Math.cos(Math.PI * 1.75 + ao) * 36) * sf, (447.5 + Math.sin(Math.PI * 1.75 + ao) * 36) * sf);
      ctx.lineTo((447.5 + Math.cos(Math.PI * 1.75 + ao) * 20) * sf, (447.5 + Math.sin(Math.PI * 1.75 + ao) * 20) * sf);
      ctx.lineTo((447.5 + Math.cos(Math.PI * 1.9 + ao) * 30) * sf, (447.5 + Math.sin(Math.PI * 1.9 + ao) * 30) * sf);
      ctx.fill();




      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 1 * sf;
      if (mouseInside(405 * sf, 405 * sf, 85 * sf, 85 * sf)) {
        ctx.lineWidth = 3 * sf;
        if (md) {
          md = false;
          if (target.direction) {
            if (target.direction == "up") {
              target.direction = "right";
            } else if (target.direction == "right") {
              target.direction = "down";
            } else if (target.direction == "down") {
              target.direction = "left";
            } else {
              target.direction = "up";
            }
            if (target.hasSpecialRot != undefined) {
              if (target.hasSpecialRot) {
                target.specialRot();
              }
            }
          }
        }
      }
      ctx.strokeRect(405 * sf, 405 * sf, 85 * sf, 85 * sf);




      ctx.fillStyle = "rgb(160, 30, 90)";
      ctx.fillRect(360 * sf, 405 * sf, 40 * sf, 40 * sf);
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.beginPath();
      ctx.moveTo(365 * sf, 410 * sf);
      ctx.lineTo(371 * sf, 410 * sf);
      ctx.lineTo(380 * sf, 435 * sf);
      ctx.lineTo(389 * sf, 410 * sf);
      ctx.lineTo(395 * sf, 410 * sf);
      ctx.lineTo(385 * sf, 440 * sf);
      ctx.lineTo(375 * sf, 440 * sf);
      ctx.fill();




      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 1 * sf;
      if (mouseInside(360 * sf, 405 * sf, 40 * sf, 40 * sf)) {
        ctx.lineWidth = 2 * sf;
        if (md) {
          md = false;
          var v = returnVariant(target.type);
          console.log(target.variant);
          if (v) {
            if (target.variant < v.length) {
              target.variant ++;
            } else {
              target.variant = 1;
            }
            target.flashValues();
          }
        }
      }
      
      ctx.strokeRect(360 * sf, 405 * sf, 40 * sf, 40 * sf);












      
    } else if (rl > 0) {
      ctx.font = (16 * sf) + "px Courier New";
      ctx.fillText("Rotations left: " + rl, 162 * sf, 445 * sf);




      ctx.fillStyle = "rgb(200, 125, 240)";
      ctx.fillRect(165 * sf, 455 * sf, 140 * sf, 30 * sf);
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.font = (16 * sf) + "px Courier New";
      ctx.textAlign = "center";
      ctx.fillText("Rotate piece", 232 * sf, 472 * sf);
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 1 * sf;
      if (mouseInside(165 * sf, 455 * sf, 140 * sf, 30 * sf)) {
        ctx.lineWidth = 2 * sf;
        if (md) {
          if (activePlayer == 1) {
            p1.rotationsLeft --;
          } else {
            p2.rotationsLeft --;
          }
          md = false;
          rotPieces.push({x: lock.x, y: lock.y});
        }
      }
      ctx.strokeRect(165 * sf, 455 * sf, 140 * sf, 30 * sf);
    }
    ctx.fillStyle = "rgb(0, 0, 0)";
    
  }
  //detection
  if (accessPoint(Math.ceil(mx / (25 * sf)), Math.ceil(my / (25 * sf))) != null && !locked) {
  	var x = Math.ceil(mx / (25 * sf))
    var y = Math.ceil(my / (25 * sf))
    lock.x = x;
    lock.y = y;
    ctx.strokeStyle = "rgba(50, 20, 65, 0.6)";
    ctx.lineWidth = 2 * sf;
    ctx.strokeRect((x * 25 - 25) * sf, (y * 25 - 25) * sf, 25 * sf, 25 * sf);
    var object = accessPoint(lock.x, lock.y);
    if (object) {
    	target = object;
      if (md && object.player == activePlayer) {
      	md = false;
      	locked = true;
      }
    } else {
    	target = 0;
    }
  } else if (!locked) {
  	target = 0;
  } else if (md && mouseInside(0, 0, 500 * sf, 400 * sf)) {
  	md = false;
    locked = false;
  }




  //x button
  ctx.fillStyle = "rgb(220, 40, 20)"
  ctx.fillRect(450 * sf, 365 * sf, 30 * sf, 30 * sf);
  
  ctx.strokeStyle = "rgb(0, 0, 0)"
  ctx.lineWidth = 3 * sf;
  ctx.beginPath()
  ctx.moveTo(455 * sf, 370 * sf)
  ctx.lineTo(475 * sf, 390 * sf)
  ctx.stroke()
  ctx.beginPath()
  ctx.moveTo(475 * sf, 370 * sf)
  ctx.lineTo(455 * sf, 390 * sf)
  ctx.stroke()
  ctx.lineWidth = 1 * sf
  if (mouseInside(450 * sf, 365 * sf, 30 * sf, 30 * sf)) {
  	ctx.lineWidth = 3 * sf
    if (md) {
    	mode = "none";
    }
  }
  ctx.strokeRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
};




var deleting = function() {
  ctx.fillStyle = "rgb(80, 20, 30)";
  ctx.fillRect(155 * sf, 400 * sf, 340 * sf, 95 * sf);




  ctx.fillStyle = "rgb(255, 255, 0)";
  ctx.font = (20 * sf) + "px Courier New";
  ctx.textAlign = "left";
  ctx.fillText("Deleting menu", 162 * sf, 422 * sf);




  if (accessPoint(Math.ceil(mx / (25 * sf)), Math.ceil(my / (25 * sf))) != null && !locked) {
  	var x = Math.ceil(mx / (25 * sf))
    var y = Math.ceil(my / (25 * sf))
    lock.x = x;
    lock.y = y;
    ctx.strokeStyle = "rgba(80, 20, 10, 0.4)";
    ctx.lineWidth = 4 * sf;
    ctx.strokeRect((x * 25 - 25) * sf, (y * 25 - 25) * sf, 25 * sf, 25 * sf);
    var object = accessPoint(lock.x, lock.y);
    if (object) {
      if (object.isPointer) {
        object = object.pointer;
      }
    	target = object;
      if (md && object.player == activePlayer) {
      	md = false;
      	locked = true;
      }
    } else {
    	target = 0;
    }
  } else if (!locked) {
  	target = 0;
  } else if (md && mouseInside(0, 0, 500 * sf, 400 * sf)) {
  	md = false;
    locked = false;
  }




  if (locked) {
    ctx.strokeStyle = "rgb(50, 20, 65)";
    ctx.lineWidth = 3;
    ctx.strokeRect((lock.x * 25 - 25) * sf, (lock.y * 25 - 25) * sf, 25 * sf, 25 * sf);




    ctx.fillStyle = "rgb(160, 50, 100)";
    ctx.fillRect(160 * sf, 460 * sf, 100 * sf, 30 * sf);
    ctx.fillRect(265 * sf, 460 * sf, 100 * sf, 30 * sf);




    ctx.fillStyle = "rgb(255, 255, 0)";
    ctx.font = (15 * sf) + "px Courier New";
    ctx.textAlign = "left";
    ctx.fillText("Selected: " + target.type, 162 * sf, 440 * sf);
    ctx.textAlign = "center";
    ctx.fillText("Repackage", 210 * sf, 477 * sf);
    ctx.fillText("Demolish", 315 * sf, 477 * sf);


    if (rotActivated) {
      rotActivated = false;
      if (!target.isComposite && !target.hasBeenDamaged && target.player == activePlayer) {
        md = false;
        if (target.isRepackaging) {
          md = false;
          target.isRepackaging = false;
          target = 0;
          locked = false;
        } else {
          target.repackage();
        }
        target = 0;
        locked = false;
      }
    }

    ctx.strokeStyle = "rgb(200, 160, 20)";
    ctx.lineWidth = 1 * sf;
    if (mouseInside(160 * sf, 460 * sf, 100 * sf, 30 * sf)) {
      ctx.lineWidth = 2 * sf;
      ctx.fillStyle = "rgb(200, 70, 130)";
      ctx.fillRect(375 * sf, 450 * sf, 110 * sf, 40 * sf);
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.font = (12 * sf) + "px Courier New";
      ctx.textAlign = "left";
      ctx.fillText("Takes one turn,", 377 * sf, 460 * sf);
      ctx.fillText("but you get the", 377 * sf, 472 * sf);
      ctx.fillText("piece back.", 377 * sf, 484 * sf);




      if (md) {
        if (!target.isComposite && !target.hasBeenDamaged && target.player == activePlayer) {
          md = false;
          if (target.isRepackaging) {
            md = false;
            target.isRepackaging = false;
            target = 0;
            locked = false;
          } else {
            target.repackage();
          }
          target = 0;
          locked = false;
        }
      }
    }
    ctx.strokeRect(160 * sf, 460 * sf, 100 * sf, 30 * sf);




    ctx.strokeStyle = "rgb(200, 160, 20)";
    ctx.lineWidth = 1 * sf;
    if (mouseInside(265 * sf, 460 * sf, 100 * sf, 30 * sf)) {
      ctx.lineWidth = 2 * sf;
      ctx.fillStyle = "rgb(200, 70, 130)";
      ctx.fillRect(375 * sf, 450 * sf, 110 * sf, 40 * sf);
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.font = "12px Courier New";
      ctx.textAlign = "left";
      ctx.fillText("Instant, but", 377 * sf, 460 * sf);
      ctx.fillText("the piece is", 377 * sf, 472 * sf);
      ctx.fillText("not returned.", 377 * sf, 484 * sf);




      if (md && target.player == activePlayer) {
        for(var i = 0; i < 40; i++) {
          var angle = i * Math.PI / 20;
          particles.push(new particle(target.x * 25 - 12.5, target.y * 25 - 12.5, 4 + rand(4), 45, {velocity: {mx: Math.cos(angle) * (1 + rand(3)), my: Math.sin(angle) * (1 + rand(3))}, color: "rgb(" + (100 + ran(155)) + ", " + (50 + ran(105)) + ", " + (20 + ran(60)) + ")", shape: "circle"}))
        }
        md = false;
        target.demolish();
        target = 0;
        locked = false;
      }
    }
    ctx.strokeRect(265 * sf, 460 * sf, 100 * sf, 30 * sf);
  }
  
  //x button
  ctx.fillStyle = "rgb(220, 40, 20)"
  ctx.fillRect(450 * sf, 365 * sf, 30 * sf, 30 * sf);
  
  ctx.strokeStyle = "rgb(0, 0, 0)"
  ctx.lineWidth = 3 * sf;
  ctx.beginPath()
  ctx.moveTo(455 * sf, 370 * sf)
  ctx.lineTo(475 * sf, 390 * sf)
  ctx.stroke()
  ctx.beginPath()
  ctx.moveTo(475 * sf, 370 * sf)
  ctx.lineTo(455 * sf, 390 * sf)
  ctx.stroke()
  ctx.lineWidth = 1 * sf
  if (mouseInside(450 * sf, 365 * sf, 30 * sf, 30 * sf)) {
  	ctx.lineWidth = 3 * sf
    if (md) {
    	mode = "none";
    }
  }
  ctx.strokeRect(450 * sf, 365 * sf, 30 * sf, 30 * sf)
}




var playerStats = function() {
  ctx.fillStyle = "rgb(90, 80, 130)";
  ctx.fillRect(5 * sf, 405 * sf, 145 * sf, 90 * sf);
  var p;
  ctx.fillStyle = "rgb(0, 0, 0)";
  ctx.font = (15 * sf) + "px Courier New";
  ctx.textAlign = "left";
  if (activePlayer == 1) {
    p = p1 
    ctx.fillText("Player 1 Stats: ", 10 * sf, 420 * sf);




    ctx.fillText("Base Health: " + accessPoint(13, 11, "main").health, 10 * sf, 450 * sf);
  } else {
    p = p2
    ctx.fillText("Player 2 Stats: ", 10 * sf, 415 * sf);




    ctx.fillText("Base Health: " + accessPoint(12, 4, "main").health, 10 * sf, 450 * sf);
  }
  ctx.fillText("Scrap: " + p.scrap, 10 * sf, 435 * sf);




  ctx.textAlign = "center";
  ctx.fillText("Turn: " + turn, 77.5 * sf, 480 * sf);
}








var backgroundBalls = [];
var backgroundBall = function(x, y, mx, my, size, time) {
  this.x = x;
  this.y = y;
  this.mx = mx;
  this.my = my;
  this.size = size;
  this.time = time;




  this.canDie = false;
};




backgroundBall.prototype.lol = function() {
  this.time --;
  this.x += this.mx;
  this.y += this.my;
  var g = ctx.createRadialGradient(this.x * sf, this.y * sf, (this.size / 3.25) * sf, this.x * sf, this.y * sf, this.size * sf);
  g.addColorStop(0, "rgb(255, 255, 255)");
  g.addColorStop(0.5, "rgba(255, 255, 255, 0.2)")
  g.addColorStop(1, "rgba(255, 255, 255, 0)");
  ctx.fillStyle = g;
  ctx.beginPath();
  ctx.arc(this.x * sf, this.y * sf, this.size * sf, 0, Math.PI * 2, false);
  ctx.fill();




  if (this.time <= 0) {
    this.canDie = true;
  }
};




backgroundBall.prototype.die = function() {
  if (this.canDie) {
    backgroundBalls.splice(backgroundBalls.indexOf(this), 1)
  }
};




var backgroundSpark = function(x, y, mx, my, xMult, yMult, rotSpeed, size, time) {
  this.x = x;
  this.y = y;
  this.mx = mx;
  this.my = my;
  this.xMult = xMult;
  this.yMult = yMult;
  this.rotSpeed = rotSpeed;
  this.rot = 0;
  this.size = size;
  this.time = time;




  this.canDie = false;
};




backgroundSpark.prototype.lol = function() {
  this.x += this.mx;
  this.y += this.my;
  this.rot += this.rotSpeed;
  this.time --;




  if (ran(3) == 1) {
    ctx.fillStyle = "rgb(" + ran(255) + ", 0, 0)";
  } else if (ran(2) == 1) {
    ctx.fillStyle = "rgb(255, 255, 255)";
  } else {
    ctx.fillStyle = "rgb(0, 0, 0)";
  }
  ctx.fillRect(((this.x - (this.size / 2)) + Math.cos(this.rot) * this.xMult ) * sf, ((this.y - (this.size / 2)) + Math.sin(this.rot) * this.yMult) * sf, this.size * sf, this.size * sf);
  //:D (grin)




  if (this.time <= 0) {
    this.canDie = true;
  }
};




backgroundSpark.prototype.die = function() {
  if (this.canDie) {
    backgroundBalls.splice(backgroundBalls.indexOf(this), 1)
  }
};




var keyPresses = function() {
  if (directions.shift) {
    directions.shift = false;
    mode = "scan";
  }
  if (directions.z) {
    directions.z = false;
    mode = "sequencing";
  }
  if (directions.x) {
    directions.x = false;
    mode = "deleting";
  }
  if (directions.c) {
    directions.c = false;
    mode = "placing";
  }
  if (directions.a) {
    directions.a = false;
    mode = "rotation";
  }
  if (directions.s) {
    directions.s = false;
    mode = "shop";
  }
}




var bgbSpawnTime = 0;
var bgsSpawnTime = 0;
var backgroundType = "balls :3";
var wSunRot = -Math.PI / 4;




var sf;




var loop = function() {
  screenWidth = window.innerWidth
	screenHeight = window.innerHeight
	
	var size = 0
	
	
	if (screenWidth > screenHeight) {
		margin = screenHeight / 18
		
		size = screenHeight - margin * 2
	}
	if (screenWidth < screenHeight) {
		margin = screenWidth / 18
		
		size = screenWidth - margin * 2
	}
	
	
	canvas.width = size
	canvas.height = size
	
	
	sf = size / 500
  if (backgroundType == "balls :3") {
    ctx.fillStyle = "rgb(5, 10, 20)";
    ctx.fillRect(0, 0, 500 * sf, 400 * sf)




    if (bgbSpawnTime <= 0) {
      bgbSpawnTime = 5 + ran(5);
      if (ran(50) == 1) {
        backgroundBalls.push(new backgroundBall(650, ran(450) - 50, -1.5 + rand(0.5), 0.5 - rand(0.5), 100 + ran(30), 1000))
      } else {
        backgroundBalls.push(new backgroundBall(550, ran(450) - 50, -3 + rand(1), 1 - rand(1), 5 + ran(20), 350))
      }
    }
    bgbSpawnTime --;
  } else if (backgroundType === "WRATH") {
    ctx.fillStyle = "rgb(180, 0, 0)";
    ctx.fillRect(0, 0, 500 * sf, 400 * sf)




    var g = ctx.createRadialGradient((250 + Math.cos(wSunRot) * 200 - 5 + ran(10)) * sf, (175 + Math.sin(wSunRot) * 100 - 5 + ran(10)) * sf, 40 * sf, (250 + Math.cos(wSunRot) * 200 - 5 + ran(10)) * sf, (175 + Math.sin(wSunRot) * 100 - 5 + ran(10)) * sf, 100 * sf);
    g.addColorStop(0, "rgb(30, 0, 0)");
    g.addColorStop(0.4, "rgba(220, 0, 0, 0.6)");
    g.addColorStop(1, "rgba(255, 255, 255, 0)");
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc((250 + Math.cos(wSunRot) * 200) * sf, (175 + Math.sin(wSunRot) * 100) * sf, 100 * sf, 0, Math.PI * 2, false);
    ctx.fill();




    wSunRot -= Math.PI / 720;








    if (bgsSpawnTime <= 0) {
      bgsSpawnTime = 2 + ran(2);
      backgroundBalls.push(new backgroundSpark(ran(400) + 50, -50, rand(2) - 1, 2 + rand(1.5), 10 + rand(80), 6 + rand(50), -0.1 + rand(0.2), 5 + rand(2), 350));
    }
    bgsSpawnTime --;




  }
  for(var i = 0; i < backgroundBalls.length; i++) {
    backgroundBalls[i].lol();
  }




  for(var i = 0; i < backgroundBalls.length; i++) {
    backgroundBalls[i].die();
  }




  keyPresses();




  for(var i = 0; i < 5; i++) {
    ctx.fillStyle = "rgba(160, 140, 200, " + i * 0.2 + ")"
    ctx.fillRect(0, (350 + i * 10) * sf, 500 * sf, 10 * sf);
  }




	ctx.fillStyle = "rgb(160, 140, 200)"
  ctx.fillRect(0, 400 * sf, 500 * sf, 200 * sf)




  /*ctx.fillStyle = "rgb(50, 25, 0)"
  ctx.fillRect(125, 125, 250, 250)
  var checker = 0
  for(var i = 0; i < grid.length; i++) {
  	checker ++
  	for(var j = 0; j < grid[0].length; j++) {
   		checker ++
      var cvalue = checker % 2 * 150
    	ctx.fillStyle = "rgb(" + (cvalue + 60) + ", " + (cvalue - 20) + ", " + (cvalue - 40) + ")"
      ctx.fillRect(150 + i * 25, 150 + j * 25, 25, 25)
      var index = accessPoint(i + 1, j + 1)
      if (index) {
      	index.draw()
      }
    }
  }*/




  for(var i = 0; i < platforms.length; i++) {
    platforms[i].render()
    globalRRot += Math.PI * 0.01;
  }
  for(var i = 0; i < projs.length; i++) {
    projs[i].draw();
  }
  
  if (mode == "placing") {
  	place_phase();
    playerStats();
  } else if (mode == "scan") {
  	scan();
    playerStats();
  } else if (mode == "sequencing") {
    sequencing();
    playerStats();
  } else if (mode == "shop") {
    shop();
    playerStats();
  } else if (mode == "rotation") {
    rotation();
  } else if (mode == "deleting") {
    deleting();
  } else if (mode == "eoting") {
    drawSequence();
  } else if (mode == "none") {
    playerStats();
    //place button
  	ctx.fillStyle = "rgb(40, 70, 70)"
    ctx.fillRect(400 * sf, 460 * sf, 90 * sf, 30 * sf)
    ctx.font = (18 * sf) + "px Courier New"
    ctx.fillStyle = "rgb(100, 200, 200)"
    ctx.textAlign = "center"
    ctx.fillText("Place", 445 * sf, 480 * sf)
    ctx.strokeStyle = "rgb(0, 0, 0)"
    ctx.lineWidth = 1 * sf;
    if (mouseInside(400 * sf, 460 * sf, 90 * sf, 30 * sf)) {
    	ctx.lineWidth = 3 * sf;
      if (md) {
      	md = false;
        mode = "placing";
      }
    }
    ctx.strokeRect(400 * sf, 460 * sf, 90 * sf, 30 * sf)
    
    //magnifying glass button
    ctx.fillStyle = "rgb(220, 220, 220)";
    ctx.fillRect(360 * sf, 460 * sf, 30 * sf, 30 * sf);
    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.lineWidth = 3 * sf;
    ctx.beginPath();
    ctx.arc(370 * sf, 470 * sf, 7 * sf, Math.PI / 4, Math.PI * 2 + Math.PI / 4, false);
    ctx.lineTo(387 * sf, 487 * sf);
    ctx.stroke();
    ctx.fillStyle = "rgba(100, 200, 255, 0.6)";
    ctx.beginPath();
    ctx.arc(370 * sf, 470 * sf, 6 * sf, 0, Math.PI * 2, false);
    ctx.fill();
    ctx.lineWidth = 1 * sf;
    if (mouseInside(360 * sf, 460 * sf, 30 * sf, 30 * sf)) {
    	ctx.lineWidth = 3 * sf;
      if (md) {
      	md = false;
        mode = "scan"
      }
    }
    ctx.strokeRect(360 * sf, 460 * sf, 30 * sf, 30 * sf);




    ctx.fillStyle = "rgb(0, 200, 0)";
    ctx.fillRect(320 * sf, 460 * sf, 30 * sf, 30 * sf);
    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.lineWidth = 5 * sf;
    ctx.lineJoin = "round";
    ctx.beginPath();
    ctx.moveTo(344 * sf, 466 * sf);
    ctx.lineTo(332 * sf, 484 * sf);
    ctx.lineTo(326 * sf, 476 * sf);
    ctx.stroke();
    ctx.lineJoin = "miter"
    
    ctx.lineWidth = 1;
    if (mouseInside(320 * sf, 460 * sf, 30 * sf, 30 * sf)) {
      ctx.lineWidth = 3;
      if (md) {
        mode = "sequencing";
      }
    }
    ctx.strokeRect(320 * sf, 460 * sf, 30 * sf, 30 * sf);




    //shop button
    ctx.fillStyle = "rgb(120, 0, 0)";
    ctx.fillRect(400 * sf, 420 * sf, 90 * sf, 30 * sf)
    ctx.fillStyle = "rgb(240, 50, 30)";
    ctx.font = (20 * sf) + "px Courier New";
    ctx.textAlign = "center";
    ctx.fillText("Shop", 445 * sf, 440 * sf);
    ctx.strokeStyle = "rgb(40, 0, 0)";
    ctx.lineWidth = 1 * sf;
    if (mouseInside(400 * sf, 420 * sf, 90 * sf, 30 * sf)) {
      ctx.lineWidth = 3 * sf;
      if (md) {
        md = false;
        mode = "shop";
      }
    }
    ctx.strokeRect(400 * sf, 420 * sf, 90 * sf, 30 * sf);




    //rotate button (unlockable)
    ctx.fillStyle = "rgb(120, 20, 160)";
    ctx.fillRect(360 * sf, 420 * sf, 30 * sf, 30 * sf)
    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.lineWidth = 2 * sf;
    ctx.beginPath();
    ctx.arc(375 * sf, 435 * sf, 10 * sf, Math.PI * 0.25, Math.PI * 1.75, false);
    ctx.stroke();
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.beginPath();
    ctx.moveTo((375 + Math.cos(Math.PI * 1.75) * 13) * sf, (435 + Math.sin(Math.PI * 1.75) * 13) * sf);
    ctx.lineTo((375 + Math.cos(Math.PI * 1.75) * 6) * sf, (435 + Math.sin(Math.PI * 1.75) * 6) * sf);
    ctx.lineTo((375 + Math.cos(Math.PI * 1.92) * 10) * sf, (435 + Math.sin(Math.PI * 1.92) * 10) * sf);
    ctx.fill();
    ctx.strokeStyle = "rgb(40, 0, 60)";
    ctx.lineWidth = 1 * sf;
    if (mouseInside(360 * sf, 420 * sf, 30 * sf, 30 * sf)) {
      ctx.lineWidth = 3 * sf;
      if (md) {
        md = false;
        mode = "rotation";
      }
    }
    ctx.strokeRect(360 * sf, 420 * sf, 30 * sf, 30 * sf);




    //delete button (unlockable)
    ctx.fillStyle = "rgb(80, 20, 5)";
    ctx.fillRect(320 * sf, 420 * sf, 30 * sf, 30 * sf)
    ctx.strokeStyle = "rgb(200, 50, 60)";
    ctx.lineWidth = 4 * sf;
    ctx.beginPath();
    ctx.moveTo(325 * sf, 425 * sf);
    ctx.lineTo(345 * sf, 445 * sf);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(325 * sf, 445 * sf);
    ctx.lineTo(345 * sf, 425 * sf);
    ctx.stroke();
    ctx.strokeStyle = "rgb(40, 0, 60)";
    ctx.lineWidth = 1 * sf;
    if (mouseInside(320 * sf, 420 * sf, 30 * sf, 30 * sf)) {
      ctx.lineWidth = 3 * sf;
      if (md) {
        md = false;
        mode = "deleting";
      }
    }
    ctx.strokeRect(320 * sf, 420 * sf, 30 * sf, 30 * sf);

    //end turn btton :D
    ctx.fillStyle = "rgb(180, 90, 5)";
    ctx.fillRect(160 * sf, 425 * sf, 150 * sf, 60 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (30 * sf) + "px Georgia";
    ctx.textAlign = "center";
    ctx.fillText("End Turn", 235 * sf, 464 * sf);
    ctx.strokeStyle = "rgb(90, 45, 2.5)";
    ctx.lineWidth = 2 * sf;
    if (mouseInside(160 * sf, 425 * sf, 150 * sf, 60 * sf)) {
      ctx.lineWidth = 4 * sf;
      if (md) {
        md = false;
        endTurn();
        for(var i = 0; i < 20; i++) {
          backgroundBalls.push(new backgroundBall(i * 25 + 12.5, 500, rand(2) - 1, -5 + rand(1), 20 + ran(7), 300))
        }
      }
    }
    ctx.strokeRect(160 * sf, 425 * sf, 150 * sf, 60 * sf);



  }
  //drawing particles :3
  for(var i = 0; i < particles.length; i++) {
    particles[i].lol();
  }




  for(var i = 0; i < particles.length; i++) {
    particles[i].die();
  }
  if (activePlayer == 1) {
    var p = p1;
  } else {
    var p = p2;
  }
  if (isPicking) {
    ctx.fillStyle = "rgba(100, 100, 100, 0.4)";
    ctx.fillRect(0, 0, 500 * sf, 500 * sf);
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.font = (40 * sf) + "px Courier new";
    ctx.textAlign = "center";
    ctx.fillText("Pick:", 250 * sf, 100 * sf);
    for(var i = 0; i < pickOptions.length; i++) {
      ctx.fillStyle = "rgb(200, 200, 200)";
      ctx.fillRect(200 * sf, (200 + i * 50) * sf, 100 * sf, 30 * sf);
      ctx.font = (18 * sf) + "px Courier New";
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.fillText(pickOptions[i], 250 * sf, (219 + i * 50) * sf);
      ctx.strokeStyle = "rgb(0, 0, 0)";
      ctx.lineWidth = 1 * sf;
      if (mouseInside(200 * sf, (200 + i * 50) * sf, 100 * sf, 30 * sf)) {
        ctx.lineWidth = 2 * sf;
        if (md) {
          md = false;
          isPicking = false;
          p.shopPool.push(pickOptions[i]);
          pickOptionsPointer = removeAllFromArray(pickOptionsPointer, pickOptions[i]);
        }
      }
      ctx.strokeRect(200 * sf, (200 + i * 50) * sf, 100 * sf, 30 * sf);
    }
    if (md) {
      md = false;
      isPicking = false;
    }
  }
  
  
  
  
  requestAnimationFrame(loop)
}
requestAnimationFrame(loop)





















  </script>
</div>

